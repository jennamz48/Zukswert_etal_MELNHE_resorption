---
title: "N x P Foliar Chemistry and Resorption Spring 2024"
author: "Jenna Zukswert"
date: "2023-01-12" 
output: html_document
---

This R code is for "Changes in foliar chemistry and nutrient resorption in northern hardwood forests in response to long-term experimental nitrogen and phosphorus addition".

Data files:
MELNHE_FoliarChemistryTraits_2021to2022.csv
MELNHE_FoliarChemistry_2008to2016_ver2.csv
MELNHE_TreeDiameters_2023_02102024_jz.csv
MELNHE_post_treatment_litter_chemistry_2021-22_new2
MELNHE_pre_treatment_litter_chemistry_2009_jz.csv
MELNHE_pre_treatment_litter_chemistry_2010_v2_analysisjz.csv
final_pretreatment_litter_2023oct29.csv
MELNHE_post_treatment_litter_chemistry_2014_jz.csv
MELNHE_post_treatment_litter_chemistry_2015_jz.csv
MELNHE_post_treatment_litter_chemistry_2016_jz.csv
final_midtreatment_litter_2023sept3.csv

Data Libraries:
```{r}
library(tidyverse)
library(ggplot2) #for graphing
library(dplyr) #for data wrangling and manipulation
library(plyr)#for data wrangling and manipulation
library(lme4) # for mixed models
library(lmerTest) # to specify correct ANOVA
library(arm) #for getting standard errors of fixed effects
library(effects) # to make N:P effect plots 
library(emmeans) # for pairwise comparisons
library(sjPlot) # for convenient normality of residual tests 
library(lsmeans)
library(MuMIn) # for rsquareGLMM, which can be used to determine % variance explained by fixed effects alone and by both fixed and random effects
library(cowplot) #for combining multiple plots
```

Get Data:
```{r}
foliage_all<-read.csv("MELNHE_FoliarChemistryTraits_2021to2022.csv")
foliage_all<-foliage_all[c(1:505),]

NP_fol<-subset(foliage_all, Treatment == "N"|Treatment == "Control"|Treatment == "P"|Treatment =="NP")
NP_fol<-subset(NP_fol, Stand !="HBCa")
NP_fol<-subset(NP_fol, Species !="QA")
NP_fol<-subset(NP_fol, Species !="BA")

#Change Catrt to factor

NP_fol$Ntrt <- as.factor(NP_fol$Ntrt)
NP_fol$Ptrt <- as.factor(NP_fol$Ptrt)

#Add Age:

NP_fol$Age<-ifelse(NP_fol$Stand=="HBM"|NP_fol$Stand=="JBM"|NP_fol$Stand=="C6"|NP_fol$Stand=="C4"|NP_fol$Stand=="C2"|NP_fol$Stand=="C1","Successional","Mature")
NP_fol$Age<-as.factor(NP_fol$Age)
NP_fol$Year<-ifelse(NP_fol$Site=="HB"|NP_fol$Stand=="JB","2021","2022")
NP_fol$Year<-as.numeric(NP_fol$Year)
NP_fol<-subset(NP_fol, TagID !=1479)
```

Create ID for trees, plots, and stands:
```{r}
NP_fol$ID <- paste(NP_fol$Stand, NP_fol$Plot, NP_fol$Treatment, NP_fol$Species, NP_fol$TagID, sep = "_")
NP_fol$treeID<-paste(NP_fol$Stand, NP_fol$Plot, NP_fol$Species, NP_fol$TagID, sep="_")
NP_fol$plotID<-paste(NP_fol$Stand, NP_fol$Plot, sep="_")
```

Averages
```{r}
library(plyr)
names(NP_fol)
NP_fol$N<-as.numeric(NP_fol$N)
NP_fol_2122mean<-ddply(NP_fol, c("Site","Stand","plotID","Treatment", "Ntrt","Ptrt","Species","Year", "Age"), summarise,
      Ca = mean(Ca, na.rm=T),
      K = mean(K, na.rm=T),
      Mg = mean(Mg, na.rm=T),
      Mn = mean(Mn, na.rm=T),
      P = mean(P.178, na.rm=T),
      LDMC = mean(LDMC, na.rm=T),
      S = mean(S, na.rm=T),
      Sr = mean(Sr, na.rm=T),
      Fe = mean(Fe, na.rm=T),
      Zn = mean(Zn, na.rm=T),
      SLA = mean(SLA_m2_kg, na.rm=T),
      N = mean(N, na.rm=T),
      Area = mean(LA_per_Leaf, na.rm=T),
      StomDen = mean(Stomatal_Density, na.rm=T),
      Mass = sum(Total_Oven_Dry_Mass, na.rm=T),
      LeafNum = sum(Number_of_Leaves, na.rn=T),
      LeafMass = Mass/LeafNum)

NP_fol_2122mean$Treatment<-recode(NP_fol_2122mean$Treatment, "C"="Control")

NP_fol_2122mean_BE<-subset(NP_fol_2122mean, Species == "BE") #37
NP_fol_2122mean_PC<-subset(NP_fol_2122mean, Species == "PC") #8
NP_fol_2122mean_RM<-subset(NP_fol_2122mean, Species == "RM") #17
NP_fol_2122mean_SM<-subset(NP_fol_2122mean, Species == "SM") #24
NP_fol_2122mean_YB<-subset(NP_fol_2122mean, Species == "YB") #40
NP_fol_2122mean_WB<-subset(NP_fol_2122mean, Species == "WB") #2
```
Pre-treatment Data and 2014-16 data:
```{r}
MELNHEfol0816<-read.csv("MELNHE_FoliarChemistry_2008to2016_ver2.csv")
names(MELNHEfol0816)
```

Steps:
- for stats, merge the pre-treatment and 2021-22 files
```{r}
preMELNHEfol<-subset(MELNHEfol0816, pre_post == "pre")
```

Pre-treatment Averages
```{r}
preMELNHEfol<-subset(MELNHEfol0816, pre_post == "pre")

NP_fol_0810mean<-ddply(preMELNHEfol, c("Site","Stand","Plot","Species"), summarise,
      Capre = mean(Ca, na.rm=T),
      Kpre = mean(K, na.rm=T),
      Mgpre = mean(Mg, na.rm=T),
      Mnpre = mean(Mn, na.rm=T),
      Ppre = mean(P, na.rm=T),
      Spre = mean(S, na.rm=T),
      Srpre = mean(Sr, na.rm=T),
      CNpre = mean(C.N, na.rm=T),
      NPpre = mean(N.P, na.rm=T),
      Npre = mean(N, na.rm=T))
NP_fol_0810mean$plotID<-paste(NP_fol_0810mean$Stand, NP_fol_0810mean$Plot, sep="_")
```

Create a file with 2014-16 data with the same column names as 2021-22 data to combine for making figures
```{r}
names(NP_fol_2122mean)
postMELNHEfol<-subset(MELNHEfol0816, pre_post == "post")
names(postMELNHEfol)
postMELNHEfolsub<-subset(postMELNHEfol, select=c("Year","Site","Stand","Plot","Treatment","Species","TagID","Ntrt","Ptrt","Ca","K","Mg","Mn","P","Sr","S","N"))
postMELNHEfolsub$ID <- paste(postMELNHEfolsub$Stand, postMELNHEfolsub$Plot, postMELNHEfolsub$Treatment, postMELNHEfolsub$Species, postMELNHEfolsub$TagID, sep = "_")
postMELNHEfolsub$treeID<-paste(postMELNHEfolsub$Stand, postMELNHEfolsub$Plot, postMELNHEfolsub$Species, NP_fol$TagID, sep="_")
postMELNHEfolsub$plotID<-paste(postMELNHEfolsub$Stand, postMELNHEfolsub$Plot, sep="_")

NP_fol_1416mean<-ddply(postMELNHEfolsub, c("Site","Stand","plotID","Treatment","Species","Ntrt","Ptrt"), summarise,
      Ca = mean(Ca, na.rm=T),
      K = mean(K, na.rm=T),
      Mg = mean(Mg, na.rm=T),
      Mn = mean(Mn, na.rm=T),
      P = mean(P, na.rm=T),
      S = mean(S, na.rm=T),
      Sr = mean(Sr, na.rm=T),
      N = mean(N, na.rm=T))
```

```{r}
postMELNHEfol1422<-full_join(NP_fol_1416mean, NP_fol_2122mean)
postMELNHEfol1422NP<-subset(postMELNHEfol1422, Treatment !="Ca")
postMELNHEfol1422NP<-subset(postMELNHEfol1422NP, Stand !="HBCa")

postMELNHEfol1422NP$Treatment<-replace(postMELNHEfol1422NP$Treatment, postMELNHEfol1422NP$Treatment == "CONTROL","Control")
postMELNHEfol1422NP$Sampling<-ifelse(postMELNHEfol1422NP$Year == 2014|postMELNHEfol1422NP$Year==2015|postMELNHEfol1422NP$Year==2016,"First","Second")
```

Merge averages
```{r}
NPfol_prepost_means_graphs<-merge(NP_fol_0810mean, postMELNHEfol1422NP, by = c("Site","Stand", "plotID","Species"))
```

Graphs -1:1
```{r}
NPfol_prepost_means_graphs%>% ggplot(aes(x= Npre, y = N, col = Treatment, shape = Sampling))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2.5)+
  scale_shape_manual(values = c(20,21,22,23,24,25))+
#scale_y_continuous(expand=c(0,0), limits = c(0.5,4))+
 # scale_x_continuous(expand=c(0,0), limits = c(0.5,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Foliar N: Pre")+
  ylab("Foliar N: Now")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))

NPfol_prepost_means_graphs$Sampling<-ifelse(NPfol_prepost_means_graphs$Year == 2022|NPfol_prepost_means_graphs$Year==2021,"2021-22","2014-16")
```

### STATISTICS###

Create data file for stats

```{r}
NP_fol_prepost<-merge(NP_fol_0810mean, NP_fol_2122mean, by = c("Site","Stand", "plotID","Species"))
NP_fol_prepost$Age<-ifelse(NP_fol_prepost$Stand =="C8"|NP_fol_prepost$Stand =="C9"|NP_fol_prepost$Stand =="HBO"|NP_fol_prepost$Stand =="JBO","Mature","Mid")
```

```{r}
NP_fol_prepost_1416<-merge(NP_fol_0810mean, NP_fol_1416mean, by = c("Site","Stand", "plotID","Species"))
NP_fol_prepost_1416$Age<-ifelse(NP_fol_prepost_1416$Stand =="C8"|NP_fol_prepost_1416$Stand =="C9"|NP_fol_prepost_1416$Stand =="HBO"|NP_fol_prepost_1416$Stand =="JBO","Mature","Mid")
```

Species-Specific Models: Beech 2021-22
```{r}
NP_fol_prepostBE<- subset(NP_fol_prepost, Species == "BE")
NP_fol_prepostBE<- subset(NP_fol_prepostBE, Stand != "JBM")

BE_Pmt<-lmer(P~Ntrt*Ptrt+Age+Ppre+Site+ (1|Stand),data=NP_fol_prepostBE)
plot(BE_Pmt)
hist(resid(BE_Pmt))
shapiro.test(resid(BE_Pmt))
anova(BE_Pmt, type=3)
fixef(BE_Pmt)
se.fixef(BE_Pmt)
plot(allEffects(BE_Pmt))

BE_Camt<-lmer(Ca~Ntrt*Ptrt+Age+Capre + Site+ (1|Stand),data=NP_fol_prepostBE)
plot(BE_Camt)
hist(resid(BE_Camt))
shapiro.test(resid(BE_Camt))
fixef(BE_Camt)
se.fixef(BE_Camt)
anova(BE_Camt, type=3)
plot(allEffects(BE_Camt))
BE_Camt

#Site removed
BE_Kmt<-lmer(K~Ntrt*Ptrt+Age+Kpre + (1|Stand),data=NP_fol_prepostBE)
plot(BE_Kmt)
hist(resid(BE_Kmt))
shapiro.test(resid(BE_Kmt))
ranef(BE_Kmt)
fixef(BE_Kmt)
se.fixef(BE_Kmt)
anova(BE_Kmt, type=3)
plot(allEffects(BE_Kmt))

BE_Mgmt<-lmer(Mg~Ntrt*Ptrt+Age+Mgpre + Site+ (1|Stand),data=NP_fol_prepostBE)
plot(BE_Mgmt)
hist(resid(BE_Mgmt))
shapiro.test(resid(BE_Mgmt))
ranef(BE_Mgmt)
fixef(BE_Mgmt)
se.fixef(BE_Mgmt)
anova(BE_Mgmt, type=3)
plot(allEffects(BE_Mgmt))

BE_Nmt<-lmer(N~Ntrt*Ptrt+Age+Npre + Site+ (1|Stand),data=NP_fol_prepostBE)
plot(BE_Nmt)
hist(resid(BE_Nmt))
shapiro.test(resid(BE_Nmt))
ranef(BE_Nmt)
fixef(BE_Nmt)
se.fixef(BE_Nmt)
anova(BE_Nmt, type=3)
plot(allEffects(BE_Nmt))

BE_Mnmt<-lmer(Mn~Ntrt*Ptrt+Age+Mnpre + Site+ (1|Stand),data=NP_fol_prepostBE)
plot(BE_Mnmt)
hist(resid(BE_Mnmt))
shapiro.test(resid(BE_Mnmt))
ranef(BE_Mnmt)
fixef(BE_Mnmt)
se.fixef(BE_Mnmt)
anova(BE_Mnmt, type=3)
plot(allEffects(BE_Mnmt))

BE_Smt<-lmer(S~Ntrt*Ptrt+Age+Spre + Site+(1|Stand),data=NP_fol_prepostBE)
plot(BE_Smt)
hist(resid(BE_Smt))
shapiro.test(resid(BE_Smt))
anova(BE_Smt, type=3)
plot(allEffects(BE_Smt))

#Plot with treatment across stands
plot<-ggplot(NP_fol_prepostBE,aes(x=Stand, y = S, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("S")+
  theme_bw(base_size=16)
print(plot)
```

Species-Specific Models: Beech 2014-16
```{r}
NP_fol_1416_prepostBE<- subset(NP_fol_prepost_1416, Species == "BE")
NP_fol_1416_prepostBE
NP_fol_prepostBE<- subset(NP_fol_prepostBE, Stand != "JBM")

BE_Pmt1416<-lmer(P~Ntrt*Ptrt+Age+Ppre+Site+ (1|Stand),data=NP_fol_1416_prepostBE)
plot(BE_Pmt1416)
hist(resid(BE_Pmt1416))
shapiro.test(resid(BE_Pmt1416))
anova(BE_Pmt1416, type=3)
fixef(BE_Pmt1416)
se.fixef(BE_Pmt1416)
plot(allEffects(BE_Pmt1416))

BE_Camt1416<-lmer(Ca~Ntrt*Ptrt+Age+Capre + Site+ (1|Stand),data=NP_fol_1416_prepostBE)
plot(BE_Camt1416)
hist(resid(BE_Camt1416))
shapiro.test(resid(BE_Camt1416))
fixef(BE_Camt1416)
se.fixef(BE_Camt1416)
anova(BE_Camt1416, type=3)
plot(allEffects(BE_Camt1416))

#Site removed
NP_fol_1416_prepostBEnoC1<-subset(NP_fol_1416_prepostBE, Stand != "C1")
NP_fol_1416_prepostBE$logK<-log(NP_fol_1416_prepostBE$K)

BE_Kmt1416<-lmer(K~Ntrt*Ptrt+Age+Kpre + Site+(1|Stand),data=NP_fol_1416_prepostBE)
plot(BE_Kmt1416)
hist(resid(BE_Kmt1416))
resid(BE_Kmt1416)
shapiro.test(resid(BE_Kmt1416))
ranef(BE_Kmt1416)
fixef(BE_Kmt1416)
se.fixef(BE_Kmt1416)
anova(BE_Kmt1416, type=3)
plot(allEffects(BE_Kmt1416))

NP_fol_1416_prepostBEnoJBO<-subset(NP_fol_1416_prepostBE, Stand != "JBO")
BE_Kmt1416noJ<-lmer(K~Ntrt*Ptrt+Age+Kpre+ +(1|Stand),data=NP_fol_1416_prepostBEnoJBO)
plot(BE_Kmt1416noJ)
hist(resid(BE_Kmt1416noJ))
resid(BE_Kmt1416noJ)
shapiro.test(resid(BE_Kmt1416noJ))
ranef(BE_Kmt1416noJ)
fixef(BE_Kmt1416noJ)
se.fixef(BE_Kmt1416noJ)
anova(BE_Kmt1416noJ, type=3)
plot(allEffects(BE_Kmt1416noJ))

NP_fol_1416_prepostBE$logMg<-log(NP_fol_1416_prepostBE$Mg)
BE_Mgmt1416<-lmer(Mg~Ntrt*Ptrt+Age+Mgpre + Site+ (1|Stand),data=NP_fol_1416_prepostBE)
plot(BE_Mgmt1416)
hist(resid(BE_Mgmt1416))
shapiro.test(resid(BE_Mgmt1416))
ranef(BE_Mgmt1416)
fixef(BE_Mgmt1416)
se.fixef(BE_Mgmt1416)
anova(BE_Mgmt1416, type=3)
plot(allEffects(BE_Mgmt1416))

BE_Nmt1416<-lmer(N~Ntrt*Ptrt+Age+Npre + Site+ (1|Stand),data=NP_fol_1416_prepostBE)
plot(BE_Nmt1416)
hist(resid(BE_Nmt1416))
resid(BE_Nmt1416)
shapiro.test(resid(BE_Nmt1416))
ranef(BE_Nmt1416)
fixef(BE_Nmt1416)
se.fixef(BE_Nmt1416)
anova(BE_Nmt1416, type=3)
plot(allEffects(BE_Nmt1416))

NP_fol_1416_prepostBEnoC1<-subset(NP_fol_1416_prepostBE, Stand != "C1")
BE_Nmt1416noC1<-lmer(N~Ntrt*Ptrt+Age+Npre + Site+ (1|Stand),data=NP_fol_1416_prepostBEnoC1)
plot(BE_Nmt1416noC1)
hist(resid(BE_Nmt1416noC1))
resid(BE_Nmt1416noC1)
shapiro.test(resid(BE_Nmt1416noC1))
ranef(BE_Nmt1416noC1)
fixef(BE_Nmt1416noC1)
se.fixef(BE_Nmt1416noC1)
anova(BE_Nmt1416noC1, type=3)
plot(allEffects(BE_Nmt1416noC1))
```

Species-Specific Models: Sugar Maple 2021-22
```{r}
NP_fol_prepostSM<- subset(NP_fol_prepost, Species == "SM")
NP_fol_prepostSM$lnP<-log(NP_fol_prepostSM$P)

SM_Pmt<-lmer(P~Ntrt*Ptrt+Age+Ppre + (1|Stand),data=NP_fol_prepostSM)
plot(SM_Pmt)
hist(resid(SM_Pmt))
shapiro.test(resid(SM_Pmt))
ranef(SM_Pmt)
fixef(SM_Pmt)
se.fixef(SM_Pmt)
anova(SM_Pmt, type=3)
plot(allEffects(SM_Pmt))

SM_Pmln<-lmer(lnP~Ntrt*Ptrt+Age+Ppre+ (1|Stand),data=NP_fol_prepostSM)
plot(SM_Pmln)
hist(resid(SM_Pmln))
shapiro.test(resid(SM_Pmln))
anova(SM_Pmln, type=3)
plot(allEffects(SM_Pmln))
fixef(SM_Pmln)
se.fixef(SM_Pmln)
ranef(SM_Pmln)

SM_Camt<-lmer(Ca~Ntrt*Ptrt+Age+Capre+ Site+ (1|Stand),data=NP_fol_prepostSM)
plot(SM_Camt)
hist(resid(SM_Camt))
shapiro.test(resid(SM_Camt))
fixef(SM_Camt)
se.fixef(SM_Camt)
anova(SM_Camt, type=3)
plot(allEffects(SM_Camt))

SM_Kmt<-lmer(K~Ntrt*Ptrt+Age+Kpre +Site+ (1|Stand),data=NP_fol_prepostSM)
plot(SM_Kmt)
hist(resid(SM_Kmt))
shapiro.test(resid(SM_Kmt))
fixef(SM_Kmt)
se.fixef(SM_Kmt)
anova(SM_Kmt, type=3)
plot(allEffects(SM_Kmt))
difflsmeans(SM_Kmt)

SM_Mgmt<-lmer(Mg~Ntrt*Ptrt+Age+Mgpre + Site+ (1|Stand),data=NP_fol_prepostSM)
plot(SM_Mgmt)
hist(resid(SM_Mgmt))
shapiro.test(resid(SM_Mgmt))
fixef(SM_Mgmt)
se.fixef(SM_Mgmt)
anova(SM_Mgmt, type=3)
plot(allEffects(SM_Mgmt))

SM_Nmt<-lmer(N~Ntrt*Ptrt+Age+Npre +Site+(1|Stand),data=NP_fol_prepostSM)
plot(SM_Nmt)
hist(resid(SM_Nmt))
shapiro.test(resid(SM_Nmt))
fixef(SM_Nmt)
se.fixef(SM_Nmt)
anova(SM_Nmt, type=3)
plot(allEffects(SM_Nmt))
ranef(SM_Nmt)

SM_Mnmt<-lmer(Mn~Ntrt*Ptrt+Age+Mnpre + Site+(1|Stand),data=NP_fol_prepostSM)
plot(SM_Mnmt)
hist(resid(SM_Mnmt))
shapiro.test(resid(SM_Mnmt))
fixef(SM_Mnmt)
se.fixef(SM_Mnmt)
anova(SM_Mnmt, type=3)
plot(allEffects(SM_Mnmt))

SM_Smt<-lmer(S~Ntrt*Ptrt+Age+Spre + (1|Site/Stand),data=NP_fol_prepostSM)
plot(SM_Smt)
hist(resid(SM_Smt))
shapiro.test(resid(SM_Smt))
anova(SM_Smt, type=3)
plot(allEffects(SM_Smt))

#Plot with treatment across stands
plot<-ggplot(NP_fol_prepostSM,aes(x=Stand, y = N, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("N")+
  theme_bw(base_size=16)
print(plot)
```

Species-Specific Models: Sugar Maple 2014-16
```{r}
NP_fol_1416_prepostSM<- subset(NP_fol_prepost_1416, Species == "SM")
NP_fol_1416_prepostSM$lnP<-log(NP_fol_1416_prepostSM$P)

SM_Pmt1416<-lmer(P~Ntrt*Ptrt+Age+Ppre +Site+ (1|Stand),data=NP_fol_1416_prepostSM)
plot(SM_Pmt1416)
hist(resid(SM_Pmt1416))
shapiro.test(resid(SM_Pmt1416))
ranef(SM_Pmt1416)
fixef(SM_Pmt1416)
se.fixef(SM_Pmt1416)
anova(SM_Pmt1416, type=3)
plot(allEffects(SM_Pmt1416))

SM_Pmln<-lmer(lnP~Ntrt*Ptrt+Age+Ppre+Site+ (1|Stand),data=NP_fol_1416_prepostSM)
plot(SM_Pmln)
hist(resid(SM_Pmln))
shapiro.test(resid(SM_Pmln))
anova(SM_Pmln, type=3)
plot(allEffects(SM_Pmln))
fixef(SM_Pmln)
se.fixef(SM_Pmln)
ranef(SM_Pmln)

SM_Camt1416<-lmer(Ca~Ntrt*Ptrt+Age+Capre+ (1|Stand),data=NP_fol_1416_prepostSM)
plot(SM_Camt1416)
hist(resid(SM_Camt1416))
shapiro.test(resid(SM_Camt1416))
fixef(SM_Camt1416)
se.fixef(SM_Camt1416)
anova(SM_Camt1416, type=3)
plot(allEffects(SM_Camt1416))

NP_fol_1416_prepostSM$logK<-log(NP_fol_1416_prepostSM$K)
SM_Kmt1416<-lmer(K~Ntrt*Ptrt+Age+Kpre+ (1|Stand),data=NP_fol_1416_prepostSM)
plot(SM_Kmt1416)
hist(resid(SM_Kmt1416))
resid(SM_Kmt1416)
shapiro.test(resid(SM_Kmt1416))
fixef(SM_Kmt1416)
se.fixef(SM_Kmt1416)
anova(SM_Kmt1416, type=3)
plot(allEffects(SM_Kmt1416))

SM_Mgmt1416<-lmer(Mg~Ntrt*Ptrt+Age+Mgpre + (1|Stand),data=NP_fol_1416_prepostSM)
plot(SM_Mgmt1416)
hist(resid(SM_Mgmt1416))
shapiro.test(resid(SM_Mgmt1416))
fixef(SM_Mgmt1416)
se.fixef(SM_Mgmt1416)
anova(SM_Mgmt1416, type=3)
plot(allEffects(SM_Mgmt1416))

SM_Nmt1416<-lmer(N~Ntrt*Ptrt+Age+Npre +Site+(1|Stand),data=NP_fol_1416_prepostSM)
plot(SM_Nmt1416)
hist(resid(SM_Nmt1416))
shapiro.test(resid(SM_Nmt1416))
fixef(SM_Nmt1416)
se.fixef(SM_Nmt1416)
anova(SM_Nmt1416, type=3)
plot(allEffects(SM_Nmt1416))
ranef(SM_Nmt1416)
```

Species-Specific Models: Yellow Birch 2021-22
```{r}
NP_fol_prepostYB<- subset(NP_fol_prepost, Species == "YB")
NP_fol_prepostYB$lnP<-log(NP_fol_prepostYB$P)

YB_Pmt<-lmer(P~Ntrt*Ptrt+Age+Ppre+(1|Stand),data=NP_fol_prepostYB)
plot(YB_Pmt)
hist(resid(YB_Pmt))
shapiro.test(resid(YB_Pmt))
fixef(YB_Pmt)
se.fixef(YB_Pmt)
anova(YB_Pmt, type=3)
plot(allEffects(YB_Pmt))
YB_Pmt

YB_Camt<-lmer(Ca~Ntrt*Ptrt+Age+Capre+Site+(1|Stand),data=NP_fol_prepostYB)
plot(YB_Camt)
hist(resid(YB_Camt))
shapiro.test(resid(YB_Camt))
fixef(YB_Camt)
se.fixef(YB_Camt)
anova(YB_Camt, type=3)
ranef(YB_Camt)
plot(allEffects(YB_Camt))

YB_Kmt<-lmer(K~Ntrt*Ptrt+Age+Kpre + Site+ (1|Stand),data=NP_fol_prepostYB)
plot(YB_Kmt)
hist(resid(YB_Kmt))
shapiro.test(resid(YB_Kmt))
ranef(YB_Kmt)
fixef(YB_Kmt)
se.fixef(YB_Kmt)
anova(YB_Kmt, type=3)
plot(allEffects(YB_Kmt))

YB_Mgmt<-lmer(Mg~Ntrt*Ptrt+Age+Mgpre+(1|Stand),data=NP_fol_prepostYB)
plot(YB_Mgmt)
hist(resid(YB_Mgmt))
shapiro.test(resid(YB_Mgmt))
fixef(YB_Mgmt)
se.fixef(YB_Mgmt)
anova(YB_Mgmt, type=3)
plot(allEffects(YB_Mgmt))

NP_fol_prepostYB$lnN<-log(NP_fol_prepostYB$N)
YB_Nmt<-lmer(lnN~Ntrt*Ptrt+Age+Npre+Site+(1|Stand),data=NP_fol_prepostYB)
plot(YB_Nmt)
hist(resid(YB_Nmt))
shapiro.test(resid(YB_Nmt))
fixef(YB_Nmt)
se.fixef(YB_Nmt)
anova(YB_Nmt, type=3)
plot(allEffects(YB_Nmt))

YB_Mnmt<-lmer(Mn~Ntrt*Ptrt+Age+Mnpre + (1|Site/Stand),data=NP_fol_prepostYB)
plot(YB_Mnmt)
hist(resid(YB_Mnmt))
shapiro.test(resid(YB_Mnmt))
anova(YB_Mnmt, type=3)
plot(allEffects(YB_Mnmt))

YB_Smt<-lmer(S~Ntrt*Ptrt+Age+Spre + (1|Site/Stand),data=NP_fol_prepostYB)
plot(YB_Smt)
hist(resid(YB_Smt))
shapiro.test(resid(YB_Smt))
anova(YB_Smt, type=3)
plot(allEffects(YB_Smt))

#Plot with treatment across stands
plot<-ggplot(NP_fol_prepostYB,aes(x=Stand, y = S, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("S")+
  theme_bw(base_size=16)
print(plot)
```

Species-Specific Models: Yellow Birch 2014-16
```{r}
NP_fol_1416_prepostYB<- subset(NP_fol_prepost_1416, Species == "YB")
NP_fol_1416_prepostYB$lnP<-log(NP_fol_1416_prepostYB$P)

YB_Pmt1416<-lmer(P~Ntrt*Ptrt+Age+Ppre+Site+(1|Stand),data=NP_fol_1416_prepostYB)
plot(YB_Pmt1416)
hist(resid(YB_Pmt1416))
shapiro.test(resid(YB_Pmt1416))
fixef(YB_Pmt1416)
se.fixef(YB_Pmt1416)
anova(YB_Pmt1416, type=3)
plot(allEffects(YB_Pmt1416))
YB_Pmt

NP_fol_1416_prepostYB$logCa<-log(NP_fol_1416_prepostYB$Ca)
YB_Camt1416<-lmer(logCa~Ntrt*Ptrt+Age+Capre+(1|Stand),data=NP_fol_1416_prepostYB)
plot(YB_Camt1416)
hist(resid(YB_Camt1416))
shapiro.test(resid(YB_Camt1416))
fixef(YB_Camt1416)
se.fixef(YB_Camt1416)
anova(YB_Camt1416, type=3)
ranef(YB_Camt1416)
plot(allEffects(YB_Camt1416))

YB_Kmt1416<-lmer(K~Ntrt*Ptrt+Age+Kpre +Site+ (1|Stand),data=NP_fol_1416_prepostYB)
plot(YB_Kmt1416)
hist(resid(YB_Kmt1416))
shapiro.test(resid(YB_Kmt1416))
ranef(YB_Kmt1416)
fixef(YB_Kmt1416)
se.fixef(YB_Kmt1416)
anova(YB_Kmt1416, type=3)
plot(allEffects(YB_Kmt1416))

NP_fol_1416_prepostYB$logMg<-log(NP_fol_1416_prepostYB$Mg)
YB_Mgmt1416<-lmer(logMg~Ntrt*Ptrt+Age+Mgpre+Site+(1|Stand),data=NP_fol_1416_prepostYB)
plot(YB_Mgmt1416)
hist(resid(YB_Mgmt1416))
shapiro.test(resid(YB_Mgmt1416))
fixef(YB_Mgmt1416)
se.fixef(YB_Mgmt1416)
anova(YB_Mgmt1416, type=3)
plot(allEffects(YB_Mgmt1416))

NP_fol_prepostYB$lnN<-log(NP_fol_prepostYB$N)
YB_Nmt1416<-lmer(N~Ntrt*Ptrt+Age+Npre+Site+(1|Stand),data=NP_fol_1416_prepostYB)
plot(YB_Nmt1416)
hist(resid(YB_Nmt1416))
shapiro.test(resid(YB_Nmt1416))
fixef(YB_Nmt1416)
se.fixef(YB_Nmt1416)
anova(YB_Nmt1416, type=3)
plot(allEffects(YB_Nmt1416))
```

Species-Specific Models: White  Birch
```{r}
NP_fol_prepostWB<- subset(NP_fol_prepost, Species == "WB")

WB_Nmt<-lmer(N~Ntrt*Ptrt+Npre+Site+ (1|Stand),data=NP_fol_prepostWB)
plot(WB_Nmt)
hist(resid(WB_Nmt))
shapiro.test(resid(WB_Nmt))
fixef(WB_Nmt)
se.fixef(WB_Nmt)
ranef(WB_Nmt)
anova(WB_Nmt, type=3)
plot(allEffects(WB_Nmt))

WB_Pmt<-lmer(P~Ntrt*Ptrt+Ppre+Site+ (1|Stand),data=NP_fol_prepostWB)
plot(WB_Pmt)
hist(resid(WB_Pmt))
shapiro.test(resid(WB_Pmt))
fixef(WB_Pmt)
se.fixef(WB_Pmt)
anova(WB_Pmt, type=3)
plot(allEffects(WB_Pmt))

WB_Camt<-lmer(Ca~Ntrt*Ptrt+Capre+Site+(1|Stand),data=NP_fol_prepostWB)
plot(WB_Camt)
hist(resid(WB_Camt))
shapiro.test(resid(WB_Camt))
fixef(WB_Camt)
se.fixef(WB_Camt)
anova(WB_Camt, type=3)
ranef(WB_Camt)
plot(allEffects(WB_Camt))

WB_Kmt<-lmer(K~Ntrt*Ptrt+Kpre +(1|Stand),data=NP_fol_prepostWB)
plot(WB_Kmt)
hist(resid(WB_Kmt))
shapiro.test(resid(WB_Kmt))
ranef(WB_Kmt)
fixef(WB_Kmt)
se.fixef(WB_Kmt)
anova(WB_Kmt, type=3)
plot(allEffects(WB_Kmt))

WB_Mgmt<-lmer(Mg~Ntrt*Ptrt+Mgpre +Site+(1|Stand),data=NP_fol_prepostWB)
plot(WB_Mgmt)
hist(resid(WB_Mgmt))
shapiro.test(resid(WB_Mgmt))
fixef(WB_Mgmt)
se.fixef(WB_Mgmt)
anova(WB_Mgmt)
ranef(WB_Mgmt)
plot(allEffects(WB_Mgmt))

WB_Mnmt<-lmer(Mn~Ntrt*Ptrt+Mnpre + (1|Site/Stand),data=NP_fol_prepostWB)
plot(WB_Mnmt)
hist(resid(WB_Mnmt))
shapiro.test(resid(WB_Mnmt))
anova(WB_Mnmt, type=3)
plot(allEffects(WB_Mnmt))

WB_Smt<-lmer(S~Ntrt*Ptrt+Spre + (1|Site/Stand),data=NP_fol_prepostWB)
plot(WB_Smt)
hist(resid(WB_Smt))
shapiro.test(resid(WB_Smt))
anova(WB_Smt, type=3)
plot(allEffects(WB_Smt))

#Plot with treatment across stands
plot<-ggplot(NP_fol_prepostWB,aes(x=Stand, y = S, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("S")+
  theme_bw(base_size=16)
print(plot)
```

Species-Specific Models: White  Birch 2014-16
```{r}
NP_fol_prepost_1416_WB<- subset(NP_fol_prepost_1416, Species == "WB")

WB_Nmt1416<-lmer(N~Ntrt*Ptrt+Npre+Site+ (1|Stand),data=NP_fol_prepost_1416_WB)
plot(WB_Nmt1416)
hist(resid(WB_Nmt1416))
shapiro.test(resid(WB_Nmt1416))
fixef(WB_Nmt1416)
se.fixef(WB_Nmt1416)
ranef(WB_Nmt1416)
anova(WB_Nmt1416, type=3)
plot(allEffects(WB_Nmt1416))

WB_Pmt1416<-lmer(P~Ntrt*Ptrt+Ppre+Site+ (1|Stand),data=NP_fol_prepost_1416_WB)
plot(WB_Pmt1416)
hist(resid(WB_Pmt1416))
shapiro.test(resid(WB_Pmt1416))
fixef(WB_Pmt1416)
se.fixef(WB_Pmt1416)
anova(WB_Pmt1416, type=3)
plot(allEffects(WB_Pmt1416))

NP_fol_prepost_1416_WB$logCa<-log(NP_fol_prepost_1416_WB$Ca)
WB_Camt1416<-lmer(logCa~Ntrt*Ptrt+Capre+Site+(1|Stand),data=NP_fol_prepost_1416_WB)
plot(WB_Camt1416)
hist(resid(WB_Camt1416))
shapiro.test(resid(WB_Camt1416))
fixef(WB_Camt1416)
se.fixef(WB_Camt1416)
anova(WB_Camt1416, type=3)
ranef(WB_Camt1416)
plot(allEffects(WB_Camt1416))

WB_Kmt1416<-lmer(K~Ntrt*Ptrt+Kpre +Site+(1|Stand),data=NP_fol_prepost_1416_WB)
plot(WB_Kmt1416)
hist(resid(WB_Kmt1416))
shapiro.test(resid(WB_Kmt1416))
ranef(WB_Kmt1416)
fixef(WB_Kmt1416)
se.fixef(WB_Kmt1416)
anova(WB_Kmt1416, type=3)
plot(allEffects(WB_Kmt1416))

WB_Mgmt1416<-lmer(Mg~Ntrt*Ptrt+Mgpre +Site+(1|Stand),data=NP_fol_prepost_1416_WB)
plot(WB_Mgmt1416)
hist(resid(WB_Mgmt1416))
shapiro.test(resid(WB_Mgmt1416))
fixef(WB_Mgmt1416)
se.fixef(WB_Mgmt1416)
anova(WB_Mgmt1416)
ranef(WB_Mgmt1416)
plot(allEffects(WB_Mgmt1416))
```

Species-Specific Models: Red Maple
```{r}
NP_fol_prepostRM<- subset(NP_fol_prepost, Species == "RM")
NP_fol_prepostRM<- subset(NP_fol_prepostRM, Stand != "HBO")
NPfol_prepost_means_graphsRM<-subset(NPfol_prepost_means_graphs, Species == "RM")
NPfol_prepost_means_graphsRM<-subset(NPfol_prepost_means_graphsRM, Stand != "HBO")
NP_fol_prepostRM1416<- subset(NP_fol_prepost_1416, Species == "RM")

#Plot with treatment across stands
plot<-ggplot(NP_fol_prepostRM1416,aes(x=Npre, y = N, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("N")+
  theme_bw(base_size=16)
print(plot)

#Plot with treatment across stands
plot<-ggplot(NP_fol_prepostRM,aes(x=Stand, y = Ca, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("")+
  theme_bw(base_size=16)
print(plot)

plotRMfolN<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Npre, y = N, col = Treatment, shape = Sampling))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  #scale_shape_manual(values = c(20,21,22,23,24,25))+
scale_y_continuous(expand=c(0,0), limits = c(14,25))+
 scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar N (mg/g)")+
  ylab("Post-treatment Foliar N (mg/g)")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolN)

plotRMfolP<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Ppre, y = P, col = Treatment, shape = Site))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  #scale_shape_manual(values = c(20,21,22,23,24,25))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar P (mg/g)")+
  ylab("Post-treatment Foliar P (mg/g)")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolP)

plotRMfolCa<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Capre, y = Ca, col = Treatment, shape = Site))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  #scale_shape_manual(values = c(20,21,22,23,24,25))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Ca (mg/g)")+
  ylab("Post-treatment Foliar Ca (mg/g)")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolCa)

plotRMfolK<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Kpre, y = K, col = Treatment, shape = Site))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  #scale_shape_manual(values = c(20,21,22,23,24,25))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar K (mg/g)")+
  ylab("Post-treatment Foliar K (mg/g)")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolK)
```

Species-Specific Models: Pin Cherry
```{r}
NP_fol_prepostPC<- subset(NP_fol_prepost, Species == "PC")
NP_fol_prepostPC1416<- subset(NP_fol_prepost_1416, Species == "PC")

#Plot with treatment across stands
plot<-ggplot(NP_fol_prepostPC1416,aes(x=Stand, y = P, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("P")+
  theme_bw(base_size=16)
print(plot)
```

Merge averages
```{r}
NPfol_prepost_means_graphs<-merge(NP_fol_0810mean, postMELNHEfol1422NP, by = c("Site","Stand", "plotID","Species"))

NPfol_prepost_means_graphs$changeP<-((NPfol_prepost_means_graphs$P-NPfol_prepost_means_graphs$Ppre)/NPfol_prepost_means_graphs$Ppre)*100
```

Bring in basal area data:

Import Data:
```{r}
treedbhMELNHE<-read.csv("MELNHE_TreeDiameters_2023_02102024_jz.csv")
unique(treedbhMELNHE$Treatment)
treedbhMELNHE$Treatment<-recode_factor(treedbhMELNHE$Treatment, "Con"="Control")

```

Create a data file summarizing basal area by species 
```{r}
#Subset of study species only:
treedbhMELNHEsub<-subset(treedbhMELNHE, Species == "YB"| Species == "PC" | Species == "WB" | Species == "BE" | Species == "SM" | Species =="RM")

treedbhMELNHEsub$Age<-ifelse(treedbhMELNHEsub$Stand=="C8"|treedbhMELNHEsub$Stand=="C9"|treedbhMELNHEsub$Stand=="HBO"|treedbhMELNHEsub$Stand=="JBO", "Mature","Mid")

#Calculate basal area
plot_sumba<-ddply(treedbhMELNHEsub, .(Site, Age, Stand, Plot, Treatment, Species), summarize,
      BA2019m2sum = sum(BA2019, na.rm=T),
      BA2015m2sum = sum(BA2015, na.rm=T),
      BA2011m2sum = sum(BA2011, na.rm=T))

NP_fol_prepost$Treatment<-as.factor(NP_fol_prepost$Treatment)
NP_fol_prepost$Treatment<-recode(NP_fol_prepost$Treatment, "C" = "Control")
plot_sumba$Age<-recode(plot_sumba$Age, "Old" = "Mature")
NP_fol_1416mean$Treatment<-recode(NP_fol_1416mean$Treatment, "CONTROL" = "Control")

#Merge with different datasets
CWM_NP_chem_species_2022<-merge(plot_sumba, NP_fol_prepost)
CWM_chem_species_2015<-merge(plot_sumba,NP_fol_1416mean)
CWM_NP_chem_species_2015<-subset(CWM_chem_species_2015, Plot !="5")
CWM_chem_species_pre<-merge(plot_sumba,NP_fol_0810mean)
CWM_NP_chem_species_pre<-subset(CWM_chem_species_pre, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")

#Calculate total basal area given the species sampled
total_sumba_2022<-ddply(CWM_NP_chem_species_2022,.(Site, Age, Stand, Plot,Treatment), summarize,
        BA2019tot = sum(BA2019m2sum, na.rm=T))
total_sumba_2015<-ddply(CWM_NP_chem_species_2015,.(Site, Age, Stand, Plot,Treatment), summarize,
        BA2015tot = sum(BA2015m2sum, na.rm=T))
total_sumba_pre<-ddply(CWM_NP_chem_species_pre,.(Site, Age, Stand, Plot,Treatment), summarize,
        BA2011tot = sum(BA2011m2sum, na.rm=T))

#Calculate proportion of basal area per species given the species sampled
CWM_NP_chem_species_2022_ba<-full_join(total_sumba_2022, CWM_NP_chem_species_2022)
CWM_NP_chem_species_2022_ba$prop2019<-CWM_NP_chem_species_2022_ba$BA2019m2sum/CWM_NP_chem_species_2022_ba$BA2019tot

CWM_NP_chem_species_2015_ba<-full_join(total_sumba_2015, CWM_NP_chem_species_2015)
CWM_NP_chem_species_2015_ba<-subset(CWM_NP_chem_species_2015_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chem_species_2015_ba<-subset(CWM_NP_chem_species_2015_ba, Plot !="7")
CWM_NP_chem_species_2015_ba$prop2015<-CWM_NP_chem_species_2015_ba$BA2015m2sum/CWM_NP_chem_species_2015_ba$BA2015tot

CWM_NP_chem_species_pre_ba<-full_join(total_sumba_pre, CWM_NP_chem_species_pre)
CWM_NP_chem_species_pre_ba<-subset(CWM_NP_chem_species_pre_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chem_species_pre_ba$prop2011<-CWM_NP_chem_species_pre_ba$BA2011m2sum/CWM_NP_chem_species_pre_ba$BA2011tot

write.csv(CWM_NP_chem_species_2022_ba, "basal_area_2024.csv")

#Check to make sure proportions add up to 1
propcheck_2022<-ddply(CWM_NP_chem_species_2022_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2019, na.rm=T))
propcheck_2015<-ddply(CWM_NP_chem_species_2015_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2015, na.rm=T))
propcheck_pre<-ddply(CWM_NP_chem_species_pre_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2011, na.rm=T))
```

Calculate CWM:
```{r}
#2022
CWM_NP_chem<-ddply(CWM_NP_chem_species_2022_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
     Ncwm= sum(N*prop2019, na.rm=T),
     Pcwm = sum(P*prop2019, na.rm=T),
     Cacwm=sum(Ca*prop2019, na.rm=T),
     Kcwm = sum(K*prop2019, na.rm=T),
     Mgcwm = sum(Mg*prop2019, na.rm=T),
     Mncwm = sum(Mn*prop2019, na.rm=T),
     Scwm = sum(S*prop2019, na.rm=T))

CWM_NP_chem_mid<-ddply(CWM_NP_chem_species_2015_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
     Nmidcwm= sum(N*prop2015, na.rm=T),
     Pmidcwm = sum(P*prop2015, na.rm=T),
     Camidcwm=sum(Ca*prop2015, na.rm=T),
     Kmidcwm = sum(K*prop2015, na.rm=T),
     Mgmidcwm = sum(Mg*prop2015, na.rm=T),
     Mnmidcwm = sum(Mn*prop2015, na.rm=T),
     Smidcwm = sum(S*prop2015, na.rm=T))

CWM_NP_chem_pre<-ddply(CWM_NP_chem_species_pre_ba, c("Site","Stand","Plot"),summarize,
     Nprecwm= sum(Npre*prop2011, na.rm=T),
     Pprecwm = sum(Ppre*prop2011, na.rm=T),
     Caprecwm=sum(Capre*prop2011, na.rm=T),
     Kprecwm = sum(Kpre*prop2011, na.rm=T),
     Mgprecwm = sum(Mgpre*prop2011, na.rm=T),
     Mnprecwm = sum(Mnpre*prop2011, na.rm=T),
     Sprecwm = sum(Spre*prop2011, na.rm=T))
    
CWM_NP_chem$Sampling<-"Second"
CWM_NP_chem$Age<-ifelse(CWM_NP_chem$Stand=="JBO"|CWM_NP_chem$Stand=="HBO"|CWM_NP_chem$Stand=="C8"|CWM_NP_chem$Stand=="C8","Mature","Successional")

CWM_NP_chem_model<-merge(CWM_NP_chem_pre, CWM_NP_chem)
CWM_NP_chem_model$Age<-ifelse(CWM_NP_chem_model$Stand=="C8"|CWM_NP_chem_model$Stand=="C9"|CWM_NP_chem_model$Stand=="HBO"|CWM_NP_chem_model$Stand=="JBO","Mature","Mid")

CWM_NP_chem_model_mid<-merge(CWM_NP_chem_pre, CWM_NP_chem_mid)
CWM_NP_chem_model_mid$Age<-ifelse(CWM_NP_chem_model_mid$Stand=="C8"|CWM_NP_chem_model_mid$Stand=="C9"|CWM_NP_chem_model_mid$Stand=="HBO"|CWM_NP_chem_model_mid$Stand=="JBO","Mature","Mid")

#Recode as factors
CWM_NP_chem_model_mid$Ntrt<-as.factor(CWM_NP_chem_model_mid$Ntrt)
CWM_NP_chem_model_mid$Ptrt<-as.factor(CWM_NP_chem_model_mid$Ptrt)
CWM_NP_chem_model_mid$Site<-as.factor(CWM_NP_chem_model_mid$Site)
CWM_NP_chem_model$Site<-as.factor(CWM_NP_chem_model$Site)
```

Models:
```{r}
#N
CWM_Nm<-lmer(Ncwm~Ntrt*Ptrt+Age+Nprecwm +Site+(1|Stand),data=CWM_NP_chem_model)
plot(CWM_Nm)
hist(resid(CWM_Nm))
shapiro.test(resid(CWM_Nm))
fixef(CWM_Nm)
se.fixef(CWM_Nm)
anova(CWM_Nm, type=3)
difflsmeans(CWM_Nm, specs=pairwise~Ntrt,ddf="Satterthwaite")
lsmeans(CWM_Nm, specs=pairwise~Ntrt,ddf="Satterthwaite")

#N 2014-16
CWM_N_mid<-lmer(Nmidcwm~Ntrt*Ptrt+Age+Nprecwm +Site+(1|Stand),data=CWM_NP_chem_model_mid)
plot(CWM_N_mid)
hist(resid(CWM_N_mid))
shapiro.test(resid(CWM_N_mid))
fixef(CWM_N_mid)
se.fixef(CWM_N_mid)
anova(CWM_N_mid, type=3)
difflsmeans(CWM_N_mid, specs=pairwise~Ntrt)
lsmeans(CWM_N_mid, specs=pairwise~Ntrt)

#P
CWM_Pm<-lmer(Pcwm~Ntrt*Ptrt+Age+Pprecwm +Site+(1|Stand),data=CWM_NP_chem_model)
plot(CWM_Pm)
hist(resid(CWM_Pm))
shapiro.test(resid(CWM_Pm))
fixef(CWM_Pm)
se.fixef(CWM_Pm)
anova(CWM_Pm, type=3)
CWM_Pm
ranef(CWM_Pm)
plot(allEffects(CWM_Pm))
difflsmeans(CWM_Pm, specs=pairwise~Ntrt:Ptrt, ddf = "Satterthwaite")
lsmeans(CWM_Pm, specs=~Ptrt, ddf = "Satterthwaite")
emmeans(CWM_Pm, specs=~Site, ddf = "Satterthwaite")

#P 2014-16
CWM_P_mid<-lmer(Pmidcwm~Ntrt*Ptrt+Age+Pprecwm +Site+(1|Stand),data=CWM_NP_chem_model_mid)
plot(CWM_P_mid)
hist(resid(CWM_P_mid))
shapiro.test(resid(CWM_P_mid))
fixef(CWM_P_mid)
se.fixef(CWM_P_mid)
anova(CWM_P_mid, type=3)
difflsmeans(CWM_P_mid, specs=pairwise~Site, ddf = "Satterthwaite")
ls<-lsmeans(CWM_P_mid, specs=~Ntrt, ddf = "Satterthwaite")
contrast(ls)
lsmeans(CWM_P_mid, specs=~Ptrt, ddf = "Satterthwaite")
#Ca
CWM_Cam<-lmer(Cacwm~Ntrt*Ptrt+Age+Caprecwm +Site+ (1|Stand),data=CWM_NP_chem_model)
plot(CWM_Cam)
hist(resid(CWM_Cam))
shapiro.test(resid(CWM_Cam))
CWM_Cam
fixef(CWM_Cam)
se.fixef(CWM_Cam)
ranef(CWM_Cam)
anova(CWM_Cam, type=3)
lsmeans(CWM_Cam, specs=pairwise~Ptrt, ddf = "Satterthwaite")
difflsmeans(CWM_Cam, specs=pairwise~Ptrt, ddf = "Satterthwaite")

#Ca 2014-16
CWM_Ca_mid<-lmer(Camidcwm~Ntrt*Ptrt+Age+Caprecwm +Site+(1|Stand),data=CWM_NP_chem_model_mid)
plot(CWM_Ca_mid)
hist(resid(CWM_Ca_mid))
shapiro.test(resid(CWM_Ca_mid))
fixef(CWM_Ca_mid)
se.fixef(CWM_Ca_mid)
anova(CWM_Ca_mid, type=3)
difflsmeans(CWM_Ca_mid, specs=pairwise~Ptrt, ddf = "Satterthwaite")
lsmeans(CWM_Ca_mid, specs=pairwise~Ptrt, ddf = "Satterthwaite")
lsmeans(CWM_Ca_mid, specs=~Site, ddf = "Satterthwaite")

#K
CWM_Km<-lmer(Kcwm~Ntrt*Ptrt+Age+Kprecwm+Site+(1|Stand),data=CWM_NP_chem_model)
plot(CWM_Km)
hist(resid(CWM_Km))
shapiro.test(resid(CWM_Km))
fixef(CWM_Km)
se.fixef(CWM_Km)
anova(CWM_Km, type=3)
CWM_Km
fixef(CWM_Km)
ranef(CWM_Km)
resid(CWM_Km)
difflsmeans(CWM_Km, specs=pairwise~Ntrt, ddf = "Satterthwaite")
lsmeans(CWM_Km, specs=~Site, ddf = "Satterthwaite")

#K 2014-16
CWM_K_mid<-lmer(Kmidcwm~Ntrt*Ptrt+Age+Kprecwm +Site+(1|Stand),data=CWM_NP_chem_model_mid)
plot(CWM_K_mid)
hist(resid(CWM_K_mid))
shapiro.test(resid(CWM_K_mid))
fixef(CWM_K_mid)
se.fixef(CWM_K_mid)
anova(CWM_K_mid, type=3)
lsmeans(CWM_Km, specs=~Site, ddf = "Satterthwaite")

#Mg
CWM_Mgm<-lmer(Mgcwm~Ntrt*Ptrt+Age+Mgprecwm +Site+(1|Stand),data=CWM_NP_chem_model)
plot(CWM_Mgm)
hist(resid(CWM_Mgm))
shapiro.test(resid(CWM_Mgm))
fixef(CWM_Mgm)
se.fixef(CWM_Mgm)
anova(CWM_Mgm, type=3)
CWM_Mgm
ranef(CWM_Mgm)
lsmeans(CWM_Mgm, specs=~Site, ddf = "Satterthwaite")

#Mg 2014-16
CWM_Mg_mid<-lmer(Mgmidcwm~Ntrt*Ptrt+Age+Mgprecwm +Site+(1|Stand),data=CWM_NP_chem_model_mid)
plot(CWM_Mg_mid)
hist(resid(CWM_Mg_mid))
shapiro.test(resid(CWM_Mg_mid))
fixef(CWM_Mg_mid)
se.fixef(CWM_Mg_mid)
anova(CWM_Mg_mid, type=3)
lsmeans(CWM_Mg_mid, specs=pairwise~Ntrt:Ptrt, ddf = "Satterthwaite")
lsmeans(CWM_Mg_mid, specs=~Site, ddf = "Satterthwaite")

plot(allEffects(CWM_Mg_mid))

#Plots
plot<-ggplot(CWM_NP_chem_model,aes(x=Stand, y = Kcwm, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("Community-Weighted K")+
  theme_bw(base_size=16)
print(plot)

CWM_NP_chem_model%>% ggplot(aes(x= Kprecwm, y = Kcwm, col = Treatment, shape = Site))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "red", "blue","purple"))+
  xlab("Foliar S: Pre")+
  ylab("Foliar S: Now")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```

Graphs including mid information (pre vs. mid + now)
```{r}
#Create a file merging 2022 and 2015 data

CWM_NP_chem_mid$Sampling = "First"

CWM_NP_chem_mid$Ncwm <-CWM_NP_chem_mid$Nmidcwm
CWM_NP_chem_mid$Pcwm <-CWM_NP_chem_mid$Pmidcwm
CWM_NP_chem_mid$Cacwm <-CWM_NP_chem_mid$Camidcwm
CWM_NP_chem_mid$Kcwm <-CWM_NP_chem_mid$Kmidcwm
CWM_NP_chem_mid$Mgcwm <-CWM_NP_chem_mid$Mgmidcwm
CWM_NP_chem_mid$Mncwm <-CWM_NP_chem_mid$Mnmidcwm
CWM_NP_chem_mid$Scwm <-CWM_NP_chem_mid$Smidcwm
CWM_NP_chem_mid$Ntrt<-recode(CWM_NP_chem_mid$Ntrt, "No" = "0")
CWM_NP_chem_mid$Ntrt<-recode(CWM_NP_chem_mid$Ntrt, "Yes" = "1")
CWM_NP_chem_mid$Ptrt<-recode(CWM_NP_chem_mid$Ptrt, "No" = "0")
CWM_NP_chem_mid$Ptrt<-recode(CWM_NP_chem_mid$Ptrt, "Yes" = "1")

CWM_NP_chem_mid2<-CWM_NP_chem_mid[,c(1:6,14:21)]

CWM_NP_chem_graph<-full_join(CWM_NP_chem, CWM_NP_chem_mid2)

CWM_NP_chem_prepost_graph<-merge(CWM_NP_chem_graph, CWM_NP_chem_pre)
CWM_NP_chem_prepost_graph$Treatment<-factor(CWM_NP_chem_prepost_graph$Treatment, levels = c("Control","N","P","NP"), ordered=T)
CWM_NP_chem_prepost_graph$Shape<-paste(CWM_NP_chem_prepost_graph$Site, CWM_NP_chem_prepost_graph$Sampling, sep="_")
CWM_NP_chem_prepost_graph$Sampling<-recode(CWM_NP_chem_prepost_graph$Sampling, "First" = "2014-16")
CWM_NP_chem_prepost_graph$Sampling<-recode(CWM_NP_chem_prepost_graph$Sampling, "Second" = "2021-22")
CWM_NP_chem_prepost_graph$Shape<-paste(CWM_NP_chem_prepost_graph$Site, CWM_NP_chem_prepost_graph$Sampling, sep="_")

```

Graphs:
```{r}
#Foliar N
folcwmN<-CWM_NP_chem_prepost_graph%>% ggplot(aes(x= Nprecwm, y = Ncwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(15,31.5))+
 scale_x_continuous(expand=c(0,0), limits = c(15,31.5))+
   scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre N (mg/g)")+
  ylab("Post N (mg/g)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(folcwmN)

#Foliar P
folcwmP<-CWM_NP_chem_prepost_graph%>% ggplot(aes(x= Pprecwm, y = Pcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0.75,2.6))+
 scale_x_continuous(expand=c(0,0), limits = c(0.75,2.6))+
    scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre P (mg/g)")+
  ylab("Post P (mg/g)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(folcwmP)

#Foliar Ca
folcwmCa<-CWM_NP_chem_prepost_graph%>% ggplot(aes(x= Caprecwm, y = Cacwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(4,12.5))+
 scale_x_continuous(expand=c(0,0), limits = c(4,12.5))+
    scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre Ca (mg/g)")+
  ylab("Post Ca (mg/g)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(folcwmCa)

#Foliar Mg
folcwmMg<-CWM_NP_chem_prepost_graph%>% ggplot(aes(x= Mgprecwm, y = Mgcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0.8,2.6))+
 scale_x_continuous(expand=c(0,0), limits = c(0.8,2.6))+
    scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre Mg (mg/g)")+
  ylab("Post Mg (mg/g)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(folcwmMg)

#Foliar K
folcwmK<-CWM_NP_chem_prepost_graph%>% ggplot(aes(x= Kprecwm, y = Kcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
 scale_y_continuous(expand=c(0,0), limits = c(5,12.5))+
 scale_x_continuous(expand=c(0,0), limits = c(5,12.5))+
  scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre K (mg/g)")+
  ylab("Post K (mg/g)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(folcwmK)

library(cowplot)
#plot_grid(folcwmN, folcwmP, folcwmCa, folcwmK, folcwmMg, labels = "auto")

TreatmentLabel <- c(
                    `Control` = "Control",
                    `N` = "N",
                    `P` = "P",
                    `NP` = "N+P"
                    )

facetfolN<-folcwmN+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetfolP<-folcwmP+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetfolCa<-folcwmCa+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetfolK<-folcwmK+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetfolMg<-folcwmMg+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))

plot_grid(facetfolN, facetfolP,facetfolCa, facetfolK, facetfolMg, nrow=5)
```

CWM inter models for N, P, Ca, and K
```{r}
NP_fol_2122mean_fixed<-ddply(NP_fol, c("Species"), summarise,
      Nf= mean(N, na.rm=T),
      Pf = mean(P.178, na.rm=T),
      Caf = mean(Ca, na.rm=T),
      Mgf = mean(Mg, na.rm=T),
      Kf = mean(K, na.rm=T))

NP_fol_1416mean_fixed<-ddply(NP_fol_1416mean, c("Species"), summarise,
      Nmidf= mean(N, na.rm=T),
      Pmidf = mean(P, na.rm=T),
      Camidf = mean(Ca, na.rm=T),
      Mgmidf = mean(Mg, na.rm=T),
      Kmidf = mean(K, na.rm=T))

NP_fol_0810_mean_fixed<-ddply(NP_fol_0810mean, c("Species"), summarise,
      Npref = mean(Npre, na.rm=T),
      Ppref = mean(Ppre, na.rm=T),
      Capref = mean(Capre, na.rm=T),
      Mgpref = mean(Mgpre, na.rm=T),
      Kpref = mean(Kpre, na.rm=T))

CWM_NP_chem_species_2022f<-merge(plot_sumba, NP_fol_2122mean_fixed)
CWM_NP_chem_species_2022f<-subset(CWM_NP_chem_species_2022f, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chem_species_2022f<-subset(CWM_NP_chem_species_2022f, Treatment !="Ca")
CWM_NP_chem_species_2022f<-subset(CWM_NP_chem_species_2022f, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_NP_chem_species_2022f$ID<-paste(CWM_NP_chem_species_2022f$Site,CWM_NP_chem_species_2022f$Stand, CWM_NP_chem_species_2022f$Plot, CWM_NP_chem_species_2022f$Species, sep = "_")
CWM_NP_chem_species_2022$ID<-paste(CWM_NP_chem_species_2022$Site,CWM_NP_chem_species_2022$Stand, CWM_NP_chem_species_2022$Plot, CWM_NP_chem_species_2022$Species, sep = "_")
CWM_NP_chem_species_2022f_merge<-merge(CWM_NP_chem_species_2022, CWM_NP_chem_species_2022f, by = c("Site","Stand","Plot","Species","Age","ID","Treatment","BA2019m2sum","BA2015m2sum","BA2011m2sum"))
CWM_NP_chem_species_2022f<-CWM_NP_chem_species_2022f_merge[,c(1:11,22:24, 42:46)]

#2015
CWM_NP_chem_species_2015f<-merge(plot_sumba, NP_fol_1416mean_fixed)
CWM_NP_chem_species_2015f<-subset(CWM_NP_chem_species_2015f, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chem_species_2015f<-subset(CWM_NP_chem_species_2015f, Treatment !="Ca")
CWM_NP_chem_species_2015f<-subset(CWM_NP_chem_species_2015f, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_NP_chem_species_2015f$ID<-paste(CWM_NP_chem_species_2015f$Site,CWM_NP_chem_species_2015f$Stand, CWM_NP_chem_species_2015f$Plot, CWM_NP_chem_species_2015f$Species, sep = "_")
CWM_NP_chem_species_2015$ID<-paste(CWM_NP_chem_species_2015$Site,CWM_NP_chem_species_2015$Stand, CWM_NP_chem_species_2015$Plot, CWM_NP_chem_species_2015$Species, sep = "_")
CWM_NP_chem_species_2015f<-merge(CWM_NP_chem_species_2015, CWM_NP_chem_species_2015f, by = c("Site","Stand","Plot","Species","Age","ID","Treatment","BA2019m2sum","BA2015m2sum","BA2011m2sum"))
CWM_NP_chem_species_2015f<-CWM_NP_chem_species_2015f[,c(1:13,22:26)]

CWM_chem_species_pref<-merge(plot_sumba,NP_fol_0810mean)
CWM_chem_species_pref<-merge(CWM_chem_species_pref, NP_fol_0810_mean_fixed)
CWM_NP_chem_species_pref<-subset(CWM_chem_species_pref, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chem_species_pref<-subset(CWM_NP_chem_species_pref, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_chem_species_pref$ID<-paste(CWM_chem_species_pref$Site,CWM_chem_species_pref$Stand, CWM_chem_species_pref$Plot, CWM_chem_species_pref$Species, sep = "_")
CWM_chem_species_pre$ID<-paste(CWM_chem_species_pre$Site,CWM_chem_species_pre$Stand, CWM_chem_species_pre$Plot, CWM_chem_species_pre$Species, sep = "_")
CWM_NP_chem_species_pref_merge<-merge(CWM_NP_chem_species_pre, CWM_NP_chem_species_pref)
CWM_chem_species_pref<-CWM_NP_chem_species_pref_merge[,c(1:9,20:25)]

#Calculate proportion of basal area per species given the species sampled
CWM_NP_chem_species_2022f_ba<-full_join(total_sumba_2022, CWM_NP_chem_species_2022f)
CWM_NP_chem_species_2022f_ba$prop2019<-CWM_NP_chem_species_2022f_ba$BA2019m2sum/CWM_NP_chem_species_2022f_ba$BA2019tot

CWM_NP_chem_species_2015f_ba<-full_join(total_sumba_2015, CWM_NP_chem_species_2015f)
CWM_NP_chem_species_2015f_ba$prop2015<-CWM_NP_chem_species_2015f_ba$BA2015m2sum/CWM_NP_chem_species_2015f_ba$BA2015tot
names(CWM_NP_chem_species_2015f_ba)
CWM_NP_chem_species_pref_ba<-full_join(total_sumba_pre, CWM_NP_chem_species_pref)
CWM_NP_chem_species_pref_ba<-subset(CWM_NP_chem_species_pref_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chem_species_pref_ba$prop2011<-CWM_NP_chem_species_pref_ba$BA2011m2sum/CWM_NP_chem_species_pref_ba$BA2011tot

#Check to make sure proportions add up to 1
propcheck_2022f<-ddply(CWM_NP_chem_species_2022f_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2019, na.rm=T))
propcheck_2015f<-ddply(CWM_NP_chem_species_2015f_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2015, na.rm=T))
propcheck_pref<-ddply(CWM_NP_chem_species_pref_ba,.(Site, Age, Stand, Plot), summarize,
        Check = sum(prop2011, na.rm=T))
```

Calculate CWMinter:
```{r}
#2022
CWM_NP_chemf<-ddply(CWM_NP_chem_species_2022f_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
     Ncwmf= sum(Nf*prop2019, na.rm=T),
     Pcwmf = sum(Pf*prop2019, na.rm=T),
     Cacwmf=sum(Caf*prop2019, na.rm=T),
     Kcwmf = sum(Kf*prop2019, na.rm=T),
     Mgcwmf = sum(Mgf*prop2019, na.rm=T))

CWM_NP_chem_midf<-ddply(CWM_NP_chem_species_2015f_ba, c("Site","Stand","Plot","Treatment","Ntrt","Ptrt"),summarize,
     Nmidcwmf= sum(Nmidf*prop2015, na.rm=T),
     Pmidcwmf = sum(Pmidf*prop2015, na.rm=T),
     Camidcwmf=sum(Camidf*prop2015, na.rm=T),
     Kmidcwmf = sum(Kmidf*prop2015, na.rm=T),
     Mgmidcwmf = sum(Mgmidf*prop2015, na.rm=T))

CWM_NP_chem_pref<-ddply(CWM_NP_chem_species_pref_ba, c("Site","Stand","Plot"),summarize,
     Nprecwmf= sum(Npref*prop2011, na.rm=T),
     Pprecwmf = sum(Ppref*prop2011, na.rm=T),
     Caprecwmf=sum(Capref*prop2011, na.rm=T),
     Kprecwmf = sum(Kpref*prop2011, na.rm=T),
     Mgprecwmf = sum(Mgpref*prop2011, na.rm=T))
  
CWM_NP_chemf$Age<-ifelse(CWM_NP_chemf$Stand=="JBO"|CWM_NP_chemf$Stand=="HBO"|CWM_NP_chemf$Stand=="C8"|CWM_NP_chemf$Stand=="C8","Mature","Successional")
CWM_NP_chem_midf$Age<-ifelse(CWM_NP_chem_midf$Stand=="JBO"|CWM_NP_chem_midf$Stand=="HBO"|CWM_NP_chem_midf$Stand=="C8"|CWM_NP_chem_midf$Stand=="C8","Mature","Successional")
CWM_NP_chem_midf<-subset(CWM_NP_chem_midf, Plot !=7)
CWM_NP_chem_midf<-subset(CWM_NP_chem_midf, Stand !="HBCa")

CWM_NP_chem_modelf<-merge(CWM_NP_chem_pref, CWM_NP_chemf)
CWM_NP_chem_modelf$Age<-ifelse(CWM_NP_chem_modelf$Stand=="C8"|CWM_NP_chem_modelf$Stand=="C9"|CWM_NP_chem_modelf$Stand=="HBO"|CWM_NP_chem_modelf$Stand=="JBO","Mature","Mid")

CWM_NP_chem_modelmidf<-merge(CWM_NP_chem_pref, CWM_NP_chem_midf)
CWM_NP_chem_modelmidf$Age<-ifelse(CWM_NP_chem_modelmidf$Stand=="C8"|CWM_NP_chem_modelmidf$Stand=="C9"|CWM_NP_chem_modelmidf$Stand=="HBO"|CWM_NP_chem_modelmidf$Stand=="JBO","Mature","Mid")

CWM_NP_chem_modelmidf$Ptrt<-as.factor(CWM_NP_chem_modelmidf$Ptrt)
CWM_NP_chem_modelmidf$Site<-as.factor(CWM_NP_chem_modelmidf$Site)
```

CWM inter models for N, P, Ca
```{r}
#N
CWM_Nmf<-lmer(Ncwmf~Ntrt*Ptrt+Age +Nprecwmf+Site+(1|Stand),data=CWM_NP_chem_modelf)
plot(CWM_Nmf)
hist(resid(CWM_Nmf))
shapiro.test(resid(CWM_Nmf))
fixef(CWM_Nmf)
se.fixef(CWM_Nmf)
anova(CWM_Nmf, type=3)

#N 2014-16
CWM_Nmidmf<-lmer(Nmidcwmf~Ntrt*Ptrt+Age +Nprecwmf+Site+(1|Stand),data=CWM_NP_chem_modelmidf)
plot(CWM_Nmidmf)
plot(resid(CWM_Nmidmf))
hist(resid(CWM_Nmidmf))
shapiro.test(resid(CWM_Nmidmf))
fixef(CWM_Nmidmf)
se.fixef(CWM_Nmidmf)
anova(CWM_Nmidmf, type=3)

#N ln
CWM_NP_chem_modelf$logNcwmf<-log(CWM_NP_chem_modelf$Ncwmf)
CWM_Nmfln<-lmer(logNcwmf~Ntrt*Ptrt+Age +Nprecwmf+Site+(1|Stand),data=CWM_NP_chem_modelf)
plot(CWM_Nmfln)
hist(resid(CWM_Nmfln))
shapiro.test(resid(CWM_Nmfln))
fixef(CWM_Nmfln)
se.fixef(CWM_Nmfln)
anova(CWM_Nmfln, type=3)

#N ln 2014-16
CWM_NP_chem_modelmidf$logNmidcwmf<-log(CWM_NP_chem_modelmidf$Nmidcwmf)
CWM_Nmidmfln<-lmer(logNmidcwmf~Ntrt*Ptrt+Age +Nprecwmf+Site+(1|Stand),data=CWM_NP_chem_modelmidf)
plot(CWM_Nmidmfln)
hist(resid(CWM_Nmidmfln))
shapiro.test(resid(CWM_Nmidmfln))
fixef(CWM_Nmidmfln)
se.fixef(CWM_Nmidmfln)
anova(CWM_Nmidmfln, type=3)

#P:
CWM_Pmf<-lmer(Pcwmf~Ntrt*Ptrt+Age+Pprecwmf+Site +(1|Stand),data=CWM_NP_chem_modelf)
plot(CWM_Pmf)
hist(resid(CWM_Pmf))
shapiro.test(resid(CWM_Pmf))
fixef(CWM_Pmf)
se.fixef(CWM_Pmf)
anova(CWM_Pmf, type=3)
CWM_Pmf
ranef(CWM_Pmf)

#P 2014-16 
CWM_Pmidmf<-lmer(Pmidcwmf~Ntrt*Ptrt+Age +Pprecwmf+Site+(1|Stand),data=CWM_NP_chem_modelmidf)
plot(CWM_Pmidmf)
hist(resid(CWM_Pmidmf))
shapiro.test(resid(CWM_Pmidmf))
fixef(CWM_Pmidmf)
se.fixef(CWM_Pmidmf)
anova(CWM_Pmidmf, type=3)
difflsmeans(CWM_Pmidmf)

#P 2014-16 ln
CWM_NP_chem_modelmidf$logPmidcwmf<-log(CWM_NP_chem_modelmidf$Pmidcwmf)
CWM_Pmidmf<-lmer(logPmidcwmf~Ntrt*Ptrt+Age +Pprecwmf+Site+(1|Stand),data=CWM_NP_chem_modelmidf)
plot(CWM_Pmidmf)
hist(resid(CWM_Pmidmf))
shapiro.test(resid(CWM_Pmidmf))
fixef(CWM_Pmidmf)
se.fixef(CWM_Pmidmf)
anova(CWM_Pmidmf, type=3)

#Ca
CWM_Camf<-lmer(Cacwmf~Ntrt*Ptrt+Age+Caprecwmf + Site+ (1|Stand),data=CWM_NP_chem_modelf)
plot(CWM_Camf)
hist(resid(CWM_Camf))
shapiro.test(resid(CWM_Camf))
CWM_Camf
fixef(CWM_Camf)
se.fixef(CWM_Camf)
anova(CWM_Camf, type=3)
lsmeans(CWM_Camf, specs=~Age)

#Ca 2014-16 
CWM_Camidmf<-lmer(Camidcwmf~Ntrt*Ptrt+Age+Caprecwmf + Site+ (1|Stand),data=CWM_NP_chem_modelmidf)
plot(CWM_Camidmf)
hist(resid(CWM_Camidmf))
shapiro.test(resid(CWM_Camidmf))
CWM_Camidmf
fixef(CWM_Camidmf)
se.fixef(CWM_Camidmf)
anova(CWM_Camidmf, type=3)
plot(allEffects(CWM_Camidmf))
difflsmeans(CWM_Camidmf, specs=~Site)

#K
CWM_Kmf<-lmer(Kcwmf~Ntrt*Ptrt+Age+Kprecwmf + Site+ (1|Stand),data=CWM_NP_chem_modelf)
plot(CWM_Kmf)
hist(resid(CWM_Kmf))
shapiro.test(resid(CWM_Kmf))
CWM_Kmf
fixef(CWM_Kmf)
se.fixef(CWM_Kmf)
anova(CWM_Kmf, type=3)

#K 2014-16 
CWM_Kmidmf<-lmer(Kmidcwmf~Ntrt*Ptrt+Age+Kprecwmf + Site+ (1|Stand),data=CWM_NP_chem_modelmidf)
plot(CWM_Kmidmf)
hist(resid(CWM_Kmidmf))
shapiro.test(resid(CWM_Kmidmf))
CWM_Kmidmf
fixef(CWM_Kmidmf)
se.fixef(CWM_Kmidmf)
anova(CWM_Kmidmf, type=3)
plot(allEffects(CWM_Kmidmf))

#Mg
CWM_Mgmf<-lmer(Mgcwmf~Ntrt*Ptrt+Age+Mgprecwmf + Site+ (1|Stand),data=CWM_NP_chem_modelf)
plot(CWM_Mgmf)
hist(resid(CWM_Mgmf))
shapiro.test(resid(CWM_Mgmf))
CWM_Mgmf
fixef(CWM_Mgmf)
se.fixef(CWM_Mgmf)
anova(CWM_Mgmf, type=3)

#Mg 2014-16
CWM_NP_chem_modelmidf$Mgmidcwmf<-as.numeric(CWM_NP_chem_modelmidf$Mgmidcwmf)
CWM_Mgmidmf<-lmer(Mgmidcwmf~Ntrt*Ptrt+Age+Mgprecwmf + Site+ (1|Stand),data=CWM_NP_chem_modelmidf)
plot(CWM_Mgmidmf)
hist(resid(CWM_Mgmidmf))
shapiro.test(resid(CWM_Mgmidmf))
CWM_Mgmidmf
fixef(CWM_Mgmidmf)
se.fixef(CWM_Mgmidmf)
anova(CWM_Mgmidmf, type=3)
plot(allEffects(CWM_Mgmidmf))
difflsmeans(CWM_Mgmidmf, specs=~Site)

CWM_NP_chem_modelf%>% ggplot(aes(x= Caprecwmf, y = Cacwmf, col = Treatment, shape = Site))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Pre")+
  ylab("Now")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))

CWM_NP_chem_modelmidf%>% ggplot(aes(x=Mgprecwmf, y = Mgmidcwmf, col = Treatment, shape = Site))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "red", "blue","purple"))+
  xlab("Pre")+
  ylab("Now")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```
CWM intra models for N, P, and Ca

Consolidate data
```{r}
CWM_NP_chem_intra<-merge(CWM_NP_chem_model, CWM_NP_chem_modelf)
CWM_NP_chem_intra$Ncwmint<-CWM_NP_chem_intra$Ncwm-CWM_NP_chem_intra$Ncwmf
CWM_NP_chem_intra$Pcwmint<-CWM_NP_chem_intra$Pcwm-CWM_NP_chem_intra$Pcwmf
CWM_NP_chem_intra$Cacwmint<-CWM_NP_chem_intra$Cacwm-CWM_NP_chem_intra$Cacwmf
CWM_NP_chem_intra$Kcwmint<-CWM_NP_chem_intra$Kcwm-CWM_NP_chem_intra$Kcwmf
CWM_NP_chem_intra$Mgcwmint<-CWM_NP_chem_intra$Mgcwm-CWM_NP_chem_intra$Mgcwmf

CWM_NP_chem_intramid<-merge(CWM_NP_chem_model_mid, CWM_NP_chem_modelmidf)
CWM_NP_chem_intramid$Ncwmint<-CWM_NP_chem_intramid$Nmidcwm-CWM_NP_chem_intramid$Nmidcwmf
CWM_NP_chem_intramid$Pcwmint<-CWM_NP_chem_intramid$Pmidcwm-CWM_NP_chem_intramid$Pmidcwmf
CWM_NP_chem_intramid$Cacwmint<-CWM_NP_chem_intramid$Camidcwm-CWM_NP_chem_intramid$Camidcwmf
CWM_NP_chem_intramid$Kcwmint<-CWM_NP_chem_intramid$Kmidcwm-CWM_NP_chem_intramid$Kmidcwmf
CWM_NP_chem_intramid$Mgcwmint<-CWM_NP_chem_intramid$Mgmidcwm-CWM_NP_chem_intramid$Mgmidcwmf

CWM_NP_chem_intra$Ncwmintpre<-CWM_NP_chem_intra$Nprecwm-CWM_NP_chem_intra$Nprecwmf
CWM_NP_chem_intra$Pcwmintpre<-CWM_NP_chem_intra$Pprecwm-CWM_NP_chem_intra$Pprecwmf
CWM_NP_chem_intra$Cacwmintpre<-CWM_NP_chem_intra$Caprecwm-CWM_NP_chem_intra$Caprecwmf
CWM_NP_chem_intra$Kcwmintpre<-CWM_NP_chem_intra$Kprecwm-CWM_NP_chem_intra$Kprecwmf
CWM_NP_chem_intra$Mgcwmintpre<-CWM_NP_chem_intra$Mgprecwm-CWM_NP_chem_intra$Mgprecwmf

CWM_NP_chem_intramid$Ncwmintpre<-CWM_NP_chem_intra$Nprecwm-CWM_NP_chem_intra$Nprecwmf
CWM_NP_chem_intramid$Pcwmintpre<-CWM_NP_chem_intra$Pprecwm-CWM_NP_chem_intra$Pprecwmf
CWM_NP_chem_intramid$Cacwmintpre<-CWM_NP_chem_intra$Caprecwm-CWM_NP_chem_intra$Caprecwmf
CWM_NP_chem_intramid$Kcwmintpre<-CWM_NP_chem_intra$Kprecwm-CWM_NP_chem_intra$Kprecwmf
CWM_NP_chem_intramid$Mgcwmintpre<-CWM_NP_chem_intra$Mgprecwm-CWM_NP_chem_intra$Mgprecwmf
```

Make Models:
```{r}
CWM_NP_chem_intra$Site<-as.factor(CWM_NP_chem_intra$Site)
CWM_NP_chem_intramid$Site<-as.factor(CWM_NP_chem_intramid$Site)

#N
CWM_Nmint<-lmer(Ncwmint~Ntrt*Ptrt+Age+Ncwmintpre+(1|Stand),data=CWM_NP_chem_intra)
plot(CWM_Nmint)
hist(resid(CWM_Nmint))
shapiro.test(resid(CWM_Nmint))
fixef(CWM_Nmint)
se.fixef(CWM_Nmint)
anova(CWM_Nmint, type=3)
plot(allEffects(CWM_Nmint))

#N 2014-16
CWM_Nmintmid<-lmer(Ncwmint~Ntrt*Ptrt+Age+Ncwmintpre+Site+(1|Stand),data=CWM_NP_chem_intramid)
plot(CWM_Nmintmid)
hist(resid(CWM_Nmintmid))
shapiro.test(resid(CWM_Nmintmid))
fixef(CWM_Nmintmid)
se.fixef(CWM_Nmintmid)
anova(CWM_Nmintmid, type=3)

#P:
CWM_Pmint<-lmer(Pcwmint~Ntrt*Ptrt+Age+Pcwmintpre+(1|Stand),data=CWM_NP_chem_intra)
plot(CWM_Pmint)
hist(resid(CWM_Pmint))
shapiro.test(resid(CWM_Pmint))
fixef(CWM_Pmint)
se.fixef(CWM_Pmint)
anova(CWM_Pmint, type=3)
CWM_Pmint
ranef(CWM_Pmint)
plot(allEffects(CWM_Pmint))

#P mid:
CWM_Pmintmid<-lmer(Pcwmint~Ntrt*Ptrt+Age+Pcwmintpre +Site+(1|Stand),data=CWM_NP_chem_intramid)
plot(CWM_Pmintmid)
hist(resid(CWM_Pmintmid))
shapiro.test(resid(CWM_Pmintmid))
fixef(CWM_Pmintmid)
se.fixef(CWM_Pmintmid)
anova(CWM_Pmintmid, type=3)
CWM_Pmintmid
ranef(CWM_Pmintmid)
lsmeans(CWM_Pmintmid, specs=~Site)

#Ca
CWM_Camint<-lmer(Cacwmint~Ntrt*Ptrt+Age+Cacwmintpre+Site+(1|Stand),data=CWM_NP_chem_intra)
plot(CWM_Camint)
hist(resid(CWM_Camint))
shapiro.test(resid(CWM_Camint))
CWM_Camint
fixef(CWM_Camint)
se.fixef(CWM_Camint)
anova(CWM_Camint, type=3)
difflsmeans(CWM_Camint, specs=~Ntrt:Ptrt)

#Ca mid
CWM_Camintmid<-lmer(Cacwmint~Ntrt*Ptrt+Age+Cacwmintpre+Site+(1|Stand),data=CWM_NP_chem_intramid)
plot(CWM_Camintmid)
hist(resid(CWM_Camintmid))
shapiro.test(resid(CWM_Camintmid))
CWM_Camintmid
fixef(CWM_Camintmid)
se.fixef(CWM_Camintmid)
anova(CWM_Camintmid, type=3)
difflsmeans(CWM_Camintmid, specs=~Site)

CWM_Kmint<-lmer(Kcwmint~Ntrt*Ptrt+Age+Kcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intra)
plot(CWM_Kmint)
hist(resid(CWM_Kmint))
shapiro.test(resid(CWM_Kmint))
CWM_Kmint
fixef(CWM_Kmint)
se.fixef(CWM_Kmint)
anova(CWM_Kmint, type=3)
lsmeans(CWM_Kmint, specs=~Ntrt)

#K mid
CWM_Kmintmid<-lmer(Kcwmint~Ntrt*Ptrt+Age+Kcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intramid)
plot(CWM_Kmintmid)
hist(resid(CWM_Kmintmid))
shapiro.test(resid(CWM_Kmintmid))
CWM_Kmintmid
fixef(CWM_Kmintmid)
se.fixef(CWM_Kmintmid)
anova(CWM_Kmintmid, type=3)

#Mg
CWM_Mgmint<-lmer(Mgcwmint~Ntrt*Ptrt+Age+Mgcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intra)
plot(CWM_Mgmint)
hist(resid(CWM_Mgmint))
shapiro.test(resid(CWM_Mgmint))
CWM_Mgmint
fixef(CWM_Mgmint)
se.fixef(CWM_Mgmint)
anova(CWM_Mgmint, type=3)
difflsmeans(CWM_Mgmint, specs=~Site)

#Mg mid
CWM_Mgmintmid<-lmer(Mgcwmint~Ntrt*Ptrt+Age+Mgcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intramid)
plot(CWM_Mgmintmid)
hist(resid(CWM_Mgmintmid))
shapiro.test(resid(CWM_Mgmintmid))
CWM_Mgmintmid
fixef(CWM_Mgmintmid)
se.fixef(CWM_Mgmintmid)
anova(CWM_Mgmintmid, type=3)
lsmeans(CWM_Mgmintmid, specs=~Ntrt)

CWM_NP_chem_intranoHBO<-subset(CWM_NP_chem_intra, Stand!="HBO")
CWM_Kmint2<-lmer(Kcwmint~Ntrt*Ptrt+Age+Kcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intranoHBO)
plot(CWM_Kmint2)
hist(resid(CWM_Kmint2))
shapiro.test(resid(CWM_Kmint2))
CWM_Kmint2
fixef(CWM_Kmint2)
se.fixef(CWM_Kmint2)
anova(CWM_Kmint2, type=3)
```

Litter Data
```{r}
MELNHElit<-read.csv("MELNHE_post_treatment_litter_chemistry_2021-22_new2.csv")
MELNHElit$Treatment<-recode_factor(MELNHElit$Treatment, "C"="Control")

MELNHElit$Ntrt<-as.factor(MELNHElit$Ntrt)
MELNHElit$Ptrt<-as.factor(MELNHElit$Ptrt)

litNP<-subset(MELNHElit, Treatment != "Ca")
litNP<-subset(litNP, Stand != "HBCa")
litNP$Age<-ifelse(litNP$Stand=="HBM"|litNP$Stand=="JBM"|litNP$Stand=="C6"|litNP$Stand=="C4"|litNP$Stand=="C2"|litNP$Stand=="C1","Successional","Mature")

plot<-ggplot(litNP,aes(x=Stand, y = N, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray", "blue","purple","red"))+
       scale_shape_manual(values =c(1,2,3,4,5,6,7,8))+
   ylab("N")+
  theme_bw(base_size=16)
print(plot)
```

Pre-treatment litter data
```{r}
pretreat2009<-read.csv("MELNHE_pre_treatment_litter_chemistry_2009_jz.csv")
pretreat2010<-read.csv("MELNHE_pre_treatment_litter_chemistry_2010_v2_analysisjz.csv")
pretreat2009$Year<-2009
pretreat2010$Year<-2010

pretreatlit<-full_join(pretreat2009, pretreat2010, by = c("Site","Stand","Plot","Species","N","C","Ca","K","Mg","Mn","P","Year"))

pretreatstudspec<-subset(pretreatlit, Species == "BE"|Species=="PC"|Species=="RM"| Species == "SM" | Species == "WB" | Species == "YB")

pretreat0910litmean<-ddply(pretreatstudspec, c("Site","Stand","Plot","Species"), summarise,
      Nlitpre = mean(N, na.rm=T),
      Calitpre = mean(Ca, na.rm=T),
      Klitpre = mean(K, na.rm=T),
      Mglitpre = mean(Mg, na.rm=T),
      Plitpre = mean(P, na.rm=T),
      Mnlitpre = mean(Mn, na.rm=T))

library(mice)
pretreat0910litmean$PlotID<-paste(pretreat0910litmean$Stand, pretreat0910litmean$Plot, sep="_")
pretreat0910litmean2<-pretreat0910litmean[,c(1:2,4:11)]
#write.csv(pretreat0910litmean2,"pretreat0910litmean2_2024.csv")
pretreat0910litmeanimp<-mice(pretreat0910litmean2)
pretreat0910litmeanimp$imp$Plitpre
pretreat0910litmeanic<-complete(pretreat0910litmeanimp, 1)

pretreat0910litmeansub<-pretreat0910litmean[,c(1:4,11)]
pretreat0910litmeani<-merge(pretreat0910litmeanic,pretreat0910litmeansub)

#write.csv(pretreat0910litmeani, "final_pretreatment_litter_2023oct29.csv")
```


Statistics: Merge averages
```{r}
pretreat0910litmeani2<-read.csv("final_pretreatment_litter_2023oct29.csv")

NPlit_prepost_means<-merge(pretreat0910litmeani2, MELNHElit, by = c("Site","Stand", "Plot","Species"))

NPlit_prepost_means$Age<-ifelse(NPlit_prepost_means$Stand=="HBM"|NPlit_prepost_means$Stand=="JBM"|NPlit_prepost_means$Stand=="C6"|NPlit_prepost_means$Stand=="C4"|NPlit_prepost_means$Stand=="C2"|NPlit_prepost_means$Stand=="C1","Successional","Mature")
NPlit_prepost_means$Age<-as.factor(NPlit_prepost_means$Age)
```


Graphs -1:1

```{r}
NPlit_prepost_means%>% ggplot(aes(x= Calitpre, y = Ca, col = Treatment, shape = Species))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,3.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,3.5))+
  scale_color_manual(values = c("gray", "red", "blue","purple"))+
  xlab("Litter Ca: Pre")+
  ylab("Litter Ca: Now")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```


Litter Chemistry and Proficiency Models:

Species-Specific Models: Beech
```{r}
NPlit_prepost_BE<- subset(NPlit_prepost_means, Species == "BE")
NPlit_prepost_BE<- subset(NPlit_prepost_BE, Stand != "JBM")

BE_Nlit<-lmer(N~Ntrt*Ptrt+Age+Nlitpre + Site +(1|Stand),data=NPlit_prepost_BE)
plot(BE_Nlit)
hist(resid(BE_Nlit))
shapiro.test(resid(BE_Nlit))
anova(BE_Nlit, type=3)
fixef(BE_Nlit)
se.fixef(BE_Nlit)
plot(allEffects(BE_Nlit))

NPlit_prepost_BE$logP<-log(NPlit_prepost_BE$P)
BE_Plit<-lmer(logP~Ntrt*Ptrt+Age + Plitpre+Site+(1|Stand),data=NPlit_prepost_BE)
plot(BE_Plit)
hist(resid(BE_Plit))
shapiro.test(resid(BE_Plit))
anova(BE_Plit, type=3)
fixef(BE_Plit)
se.fixef(BE_Plit)
ranef(BE_Plit)
plot(allEffects(BE_Plit))

BE_Calit<-lmer(Ca~Ntrt*Ptrt+Age+ Calitpre+Site+ (1|Stand),data=NPlit_prepost_BE)
plot(BE_Calit)
hist(resid(BE_Calit))
shapiro.test(resid(BE_Calit))
fixef(BE_Calit)
se.fixef(BE_Calit)
anova(BE_Calit, type=3)
ranef(BE_Calit)
plot(allEffects(BE_Calit))

BE_K_lit<-lmer(K~Ntrt*Ptrt+Age+Klitpre+(1|Stand),data=NPlit_prepost_BE)
plot(BE_K_lit)
hist(resid(BE_K_lit))
shapiro.test(resid(BE_K_lit))
fixef(BE_K_lit)
se.fixef(BE_K_lit)
anova(BE_K_lit, type=3)
plot(allEffects(BE_K_lit))

BE_Mglit<-lmer(Mg~Ntrt*Ptrt+Age +Mglitpre+ Site+ (1|Stand),data=NPlit_prepost_BE)
plot(BE_Mglit)
hist(resid(BE_Mglit))
shapiro.test(resid(BE_Mglit))
fixef(BE_Mglit)
se.fixef(BE_Mglit)
anova(BE_Mglit, type=3)
plot(allEffects(BE_Mglit))

#Plot with treatment across stands
plot<-ggplot(NPlit_prepost_BE,aes(x=Stand, y = N, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("N")+
  theme_bw(base_size=16)
print(plot)
```

Species-Specific Models: Sugar Maple
```{r}
NPlit_prepost_SM<- subset(NPlit_prepost_means, Species == "SM")
NPlit_prepost_SM$logN<-log(NPlit_prepost_SM$N)

SM_Nlit<-lmer(logN~Ntrt*Ptrt+Age+Nlitpre +(1|Stand),data=NPlit_prepost_SM)
plot(SM_Nlit)
hist(resid(SM_Nlit))
shapiro.test(resid(SM_Nlit))
anova(SM_Nlit, type=3)
fixef(SM_Nlit)
se.fixef(SM_Nlit)
plot(allEffects(SM_Nlit))

SM_Plit<-lmer(P~Ntrt*Ptrt+Age +Plitpre+Site+  (1|Stand),data=NPlit_prepost_SM)
plot(SM_Plit)
hist(resid(SM_Plit))
shapiro.test(resid(SM_Plit))
anova(SM_Plit, type=3)
fixef(SM_Plit)
se.fixef(SM_Plit)
plot(allEffects(SM_Plit))

SM_Calit<-lmer(Ca~Ntrt*Ptrt+Age+Calitpre+Site+ (1|Stand),data=NPlit_prepost_SM)
plot(SM_Calit)
hist(resid(SM_Calit))
shapiro.test(resid(SM_Calit))
fixef(SM_Calit)
se.fixef(SM_Calit)
ranef(SM_Calit)
anova(SM_Calit, type=3)
plot(allEffects(SM_Calit))

SM_K_lit<-lmer(K~Ntrt*Ptrt+Age+Klitpre+ (1|Stand),data=NPlit_prepost_SM)
plot(SM_K_lit)
hist(resid(SM_K_lit))
shapiro.test(resid(SM_K_lit))
fixef(SM_K_lit)
se.fixef(SM_K_lit)
anova(SM_K_lit, type=3)
plot(allEffects(SM_K_lit))

SM_Mglit<-lmer(Mg~Ntrt*Ptrt+Age+Mglitpre+(1|Stand),data=NPlit_prepost_SM)
plot(SM_Mglit)
hist(resid(SM_Mglit))
shapiro.test(resid(SM_Mglit))
fixef(SM_Mglit)
se.fixef(SM_Mglit)
anova(SM_Mglit, type=3)
plot(allEffects(SM_Mglit))

#Plot with treatment across stands
plot<-ggplot(NPlit_prepost_SM,aes(x=Stand, y = N, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("N")+
  theme_bw(base_size=16)
print(plot)
```

Species-Specific Models: Yellow Birch
```{r}
NPlit_prepost_YB<- subset(NPlit_prepost_means, Species == "YB")

NPlit_prepost_YB$lnN<-log(NPlit_prepost_YB$N)
YB_Nlit<-lmer(lnN~Ntrt*Ptrt+Age+ Nlitpre+Site+(1|Stand),data=NPlit_prepost_YB)
plot(YB_Nlit)
hist(resid(YB_Nlit))
shapiro.test(resid(YB_Nlit))
fixef(YB_Nlit)
se.fixef(YB_Nlit)
anova(YB_Nlit, type=3)
plot(allEffects(YB_Nlit))

YB_Plit<-lmer(P~Ntrt*Ptrt+Age +Plitpre+(1|Stand),data=NPlit_prepost_YB)
plot(YB_Plit)
hist(resid(YB_Plit))
shapiro.test(resid(YB_Plit))
anova(YB_Plit, type=3)
fixef(YB_Plit)
se.fixef(YB_Plit)
ranef(YB_Plit)
plot(allEffects(YB_Plit))

YB_Calit<-lmer(Ca~Ntrt*Ptrt+Age +Calitpre+(1|Stand),data=NPlit_prepost_YB)
plot(YB_Calit)
hist(resid(YB_Calit))
shapiro.test(resid(YB_Calit))
fixef(YB_Calit)
se.fixef(YB_Calit)
ranef(YB_Calit)
anova(YB_Calit, type=3)
plot(allEffects(YB_Calit))

YB_K_lit<-lmer(K~Ntrt*Ptrt+Age +Klitpre + Site+(1|Stand),data=NPlit_prepost_YB)
plot(YB_K_lit)
hist(resid(YB_K_lit))
shapiro.test(resid(YB_K_lit))
fixef(YB_K_lit)
se.fixef(YB_K_lit)
anova(YB_K_lit, type=3)
plot(allEffects(YB_K_lit))

YB_Mglit<-lmer(Mg~Ntrt*Ptrt+Age +Mglitpre +Site+(1|Stand),data=NPlit_prepost_YB)
plot(YB_Mglit)
hist(resid(YB_Mglit))
shapiro.test(resid(YB_Mglit))
fixef(YB_Mglit)
se.fixef(YB_Mglit)
anova(YB_Mglit, type=3)
plot(allEffects(YB_Mglit))

#Plot with treatment across stands
plot<-ggplot(NPlit_prepost_YB,aes(x=Stand, y = N, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("N")+
  theme_bw(base_size=16)
print(plot)
```

Species-Specific Models: White Birch
```{r}
NPlit_prepost_WB<- subset(NPlit_prepost_means, Species == "WB")

WB_Nlit<-lmer(N~Ntrt*Ptrt+Site + Nlitpre+(1|Stand),data=NPlit_prepost_WB)
plot(WB_Nlit)
hist(resid(WB_Nlit))
shapiro.test(resid(WB_Nlit))
anova(WB_Nlit, type=3)
fixef(WB_Nlit)
se.fixef(WB_Nlit)
plot(allEffects(WB_Nlit))

WB_Plit<-lmer(P~Ntrt*Ptrt + Plitpre+Site+(1|Stand),data=NPlit_prepost_WB)
plot(WB_Plit)
hist(resid(WB_Plit))
shapiro.test(resid(WB_Plit))
fixef(WB_Plit)
se.fixef(WB_Plit)
anova(WB_Plit, type=3)
ranef(WB_Plit)
plot(allEffects(WB_Plit))

WB_Calit<-lmer(Ca~Ntrt*Ptrt+Calitpre + Site+ (1|Stand),data=NPlit_prepost_WB)
plot(WB_Calit)
hist(resid(WB_Calit))
shapiro.test(resid(WB_Calit))
fixef(WB_Calit)
se.fixef(WB_Calit)
anova(WB_Calit, type=3)
plot(allEffects(WB_Calit))

WB_K_lit<-lmer(K~Ntrt*Ptrt+Klitpre  +Site+ (1|Stand),data=NPlit_prepost_WB)
plot(WB_K_lit)
hist(resid(WB_K_lit))
shapiro.test(resid(WB_K_lit))
fixef(WB_K_lit)
se.fixef(WB_K_lit)
anova(WB_K_lit, type=3)
plot(allEffects(WB_K_lit))

WB_Mglit<-lmer(Mg~Ntrt*Ptrt+Mglitpre + Site+ (1|Stand),data=NPlit_prepost_WB)
plot(WB_Mglit)
hist(resid(WB_Mglit))
shapiro.test(resid(WB_Mglit))
fixef(WB_Mglit)
se.fixef(WB_Mglit)
anova(WB_Mglit, type=3)
plot(allEffects(WB_Mglit))

#Plot with treatment across stands
plot<-ggplot(NPlit_prepost_WB,aes(x=Stand, y = N, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("N")+
  theme_bw(base_size=16)
print(plot)
```

Species Graphs: Red Maple
```{r}
NPlit_prepost_RM<- subset(litNP, Species == "RM")
NPlit_prepost_RM<- subset(NPlit_prepost_RM, Stand != "HBO")

#Plot with treatment across stands
plot<-ggplot(NPlit_prepost_RM,aes(x=Stand, y = Mg, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("")+
  theme_bw(base_size=16)
print(plot)
```

Species Graphs: Pin Cherry
```{r}
NPlit_prepost_PC<- subset(litNP, Species == "PC")

#Plot with treatment across stands
plot<-ggplot(NPlit_prepost_PC,aes(x=Stand, y = Ca, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("Mg")+
  theme_bw(base_size=16)
print(plot)
```

Merge the litter and basal area files:
```{r}
lit2014<-read.csv("MELNHE_post_treatment_litter_chemistry_2014_jz.csv")
lit2015<-read.csv("MELNHE_post_treatment_litter_chemistry_2015_jz.csv")
lit2016<-read.csv("MELNHE_post_treatment_litter_chemistry_2016_jz.csv")

lit2016means<-ddply(lit2016, c("Site","Stand","Plot","Treatment","Species"), summarise,
      N = mean(N, na.rm=T),
      Ca = mean(Ca, na.rm=T),
      K = mean(K, na.rm=T),
      Mg = mean(Mg, na.rm=T),
      P = mean(P, na.rm=T))

Karalit<-full_join(lit2014, lit2015)

midlit<-full_join(Karalit, lit2016means)

midlitmeans<-ddply(midlit, c("Site","Stand","Plot","Treatment","Species"), summarise,
      Nmid = mean(N, na.rm=T),
      Camid = mean(Ca, na.rm=T),
      Kmid = mean(K, na.rm=T),
      Mgmid = mean(Mg, na.rm=T),
      Pmid = mean(P, na.rm=T))

midlitmeans<-subset(midlitmeans, Stand !="HBCa")
midlitmeansNP<-subset(midlitmeans, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")

midlitmeansNP$PlotID<-paste(midlitmeansNP$Stand, midlitmeansNP$Plot, sep="_")
midlitmeansNP2<-midlitmeansNP[,c(1:2,4:11)]
write.csv(midlitmeansNP2, "midlitmeansNP2_2024.csv")
library(mice)
midlitmeansNPimp<-mice(midlitmeansNP2)
midlitmeansNPimpic<-complete(midlitmeansNPimp, 1)

midlitmeansNPsub<-midlitmeansNP[,c(1:5,11)]
midlitmeansNPi<-merge(midlitmeansNPimpic,midlitmeansNPsub)
#write.csv(midlitmeansNPi,"final_midtreatment_litter_2023sept3.csv")
midlitmeansNPi2<-read.csv("final_midtreatment_litter_2023sept3.csv")
```

Statistics: Merge averages
```{r}

str(midlitmeansNPi2)

NPlit_prepost_means1416<-merge(pretreat0910litmeani2, midlitmeansNPi2, by = c("Site","Stand", "Plot","Species"))

NPlit_prepost_means1416$Age<-ifelse(NPlit_prepost_means1416$Stand=="HBM"|NPlit_prepost_means1416$Stand=="JBM"|NPlit_prepost_means1416$Stand=="C6"|NPlit_prepost_means1416$Stand=="C4"|NPlit_prepost_means1416$Stand=="C2"|NPlit_prepost_means1416$Stand=="C1","Successional","Mature")
NPlit_prepost_means1416$Age<-as.factor(NPlit_prepost_means1416$Age)

NPlit_prepost_means1416$Ntrt<-ifelse(NPlit_prepost_means1416$Treatment=="N" | NPlit_prepost_means1416$Treatment=="NP",1,0)
NPlit_prepost_means1416$Ptrt<-ifelse(NPlit_prepost_means1416$Treatment=="P" | NPlit_prepost_means1416$Treatment=="NP",1,0)

NPlit_prepost_means1416$Ntrt<-as.factor(NPlit_prepost_means1416$Ntrt)
NPlit_prepost_means1416$Ptrt<-as.factor(NPlit_prepost_means1416$Ptrt)
```

Species-Specific Models: Beech 2014-16
```{r}
NPlit_prepost_BE1416<- subset(NPlit_prepost_means1416, Species == "BE")
NPlit_prepost_BE1416<- subset(NPlit_prepost_BE1416, Stand !="JBM")

BE_Nlit1416<-lmer(Nmid~Ntrt*Ptrt+Age+Nlitpre + Site +(1|Stand),data=NPlit_prepost_BE1416)
plot(BE_Nlit1416)
hist(resid(BE_Nlit1416))
shapiro.test(resid(BE_Nlit1416))
anova(BE_Nlit1416, type=3)
fixef(BE_Nlit1416)
se.fixef(BE_Nlit1416)
plot(allEffects(BE_Nlit1416))

#Not normal - needs transformation  
NPlit_prepost_BE$logP<-log(NPlit_prepost_BE$P)
BE_Plit1416<-lmer(Pmid~Ntrt*Ptrt+Age + Plitpre+Site+(1|Stand),data=NPlit_prepost_BE1416)
plot(BE_Plit1416)
hist(resid(BE_Plit1416))
shapiro.test(resid(BE_Plit1416))
anova(BE_Plit1416, type=3)
fixef(BE_Plit1416)
se.fixef(BE_Plit1416)
ranef(BE_Plit1416)
plot(allEffects(BE_Plit1416))
difflsmeans(BE_Plit1416)

BE_Calit1416<-lmer(Camid~Ntrt*Ptrt+Age+ Calitpre+Site+ (1|Stand),data=NPlit_prepost_BE1416)
plot(BE_Calit1416)
hist(resid(BE_Calit1416))
shapiro.test(resid(BE_Calit1416))
fixef(BE_Calit1416)
se.fixef(BE_Calit1416)
anova(BE_Calit1416, type=3)
ranef(BE_Calit1416)
plot(allEffects(BE_Calit1416))

BE_K_lit1416<-lmer(Kmid~Ntrt*Ptrt+Age+Klitpre+Site+(1|Stand),data=NPlit_prepost_BE1416)
plot(BE_K_lit1416)
hist(resid(BE_K_lit1416))
shapiro.test(resid(BE_K_lit1416))
fixef(BE_K_lit1416)
se.fixef(BE_K_lit1416)
anova(BE_K_lit1416, type=3)
plot(allEffects(BE_K_lit1416))

BE_Mglit1416<-lmer(Mgmid~Ntrt*Ptrt+Age +Mglitpre+ Site+ (1|Stand),data=NPlit_prepost_BE1416)
plot(BE_Mglit1416)
hist(resid(BE_Mglit1416))
shapiro.test(resid(BE_Mglit1416))
fixef(BE_Mglit1416)
se.fixef(BE_Mglit1416)
anova(BE_Mglit1416, type=3)
plot(allEffects(BE_Mglit1416))
```

Species-Specific Models: Sugar Maple 2014-16
```{r}
NPlit_prepost_SM1416<- subset(NPlit_prepost_means1416, Species == "SM")

SM_Nlit1416<-lmer(Nmid~Ntrt*Ptrt+Nlitpre +Site+(1|Stand),data=NPlit_prepost_SM1416)
plot(SM_Nlit1416)
hist(resid(SM_Nlit1416))
shapiro.test(resid(SM_Nlit1416))
anova(SM_Nlit1416, type=3)
fixef(SM_Nlit1416)
se.fixef(SM_Nlit1416)
plot(allEffects(SM_Nlit1416))

SM_Plit1416<-lmer(Pmid~Ntrt*Ptrt +Plitpre+Site+  (1|Stand),data=NPlit_prepost_SM1416)
plot(SM_Plit1416)
hist(resid(SM_Plit1416))
shapiro.test(resid(SM_Plit1416))
anova(SM_Plit1416, type=3)
fixef(SM_Plit1416)
se.fixef(SM_Plit1416)
plot(allEffects(SM_Plit1416))

SM_Calit1416<-lmer(Camid~Ntrt*Ptrt+Calitpre+Site+ (1|Stand),data=NPlit_prepost_SM1416)
plot(SM_Calit1416)
hist(resid(SM_Calit1416))
shapiro.test(resid(SM_Calit1416))
fixef(SM_Calit1416)
se.fixef(SM_Calit1416)
ranef(SM_Calit1416)
anova(SM_Calit1416, type=3)
plot(allEffects(SM_Calit1416))

SM_K_lit1416<-lmer(Kmid~Ntrt*Ptrt+Klitpre+Site+ (1|Stand),data=NPlit_prepost_SM1416)
plot(SM_K_lit1416)
hist(resid(SM_K_lit1416))
shapiro.test(resid(SM_K_lit1416))
fixef(SM_K_lit1416)
se.fixef(SM_K_lit1416)
anova(SM_K_lit1416, type=3)
plot(allEffects(SM_K_lit1416))

SM_Mglit1416<-lmer(Mgmid~Ntrt*Ptrt+Mglitpre+Site+(1|Stand),data=NPlit_prepost_SM1416)
plot(SM_Mglit1416)
hist(resid(SM_Mglit1416))
shapiro.test(resid(SM_Mglit1416))
fixef(SM_Mglit1416)
se.fixef(SM_Mglit1416)
anova(SM_Mglit1416, type=3)
plot(allEffects(SM_Mglit1416))
```

Species-Specific Models: Yellow Birch 2014-16
```{r}
NPlit_prepost_1416YB<- subset(NPlit_prepost_means1416, Species == "YB")

YB_Nlit1416<-lmer(Nmid~Ntrt*Ptrt+Age+ Nlitpre+Site+(1|Stand),data=NPlit_prepost_1416YB)
plot(YB_Nlit1416)
hist(resid(YB_Nlit1416))
shapiro.test(resid(YB_Nlit1416))
fixef(YB_Nlit1416)
se.fixef(YB_Nlit1416)
anova(YB_Nlit1416, type=3)
plot(allEffects(YB_Nlit1416))

NPlit_prepost_1416YB$loglitP<-log(NPlit_prepost_1416YB$Pmid)
YB_Plit1416<-lmer(loglitP~Ntrt*Ptrt+Age +Plitpre+(1|Stand),data=NPlit_prepost_1416YB)
plot(YB_Plit1416)
hist(resid(YB_Plit1416))
shapiro.test(resid(YB_Plit1416))
anova(YB_Plit1416, type=3)
fixef(YB_Plit1416)
se.fixef(YB_Plit1416)
ranef(YB_Plit1416)
plot(allEffects(YB_Plit1416))

YB_Calit1416<-lmer(Camid~Ntrt*Ptrt+Age +Calitpre+Site+(1|Stand),data=NPlit_prepost_1416YB)
plot(YB_Calit1416)
hist(resid(YB_Calit1416))
shapiro.test(resid(YB_Calit1416))
fixef(YB_Calit1416)
se.fixef(YB_Calit1416)
ranef(YB_Calit1416)
anova(YB_Calit1416, type=3)
plot(allEffects(YB_Calit1416))

YB_K_lit1416<-lmer(Kmid~Ntrt*Ptrt+Age +Klitpre + Site+(1|Stand),data=NPlit_prepost_1416YB)
plot(YB_K_lit1416)
hist(resid(YB_K_lit1416))
shapiro.test(resid(YB_K_lit1416))
fixef(YB_K_lit1416)
se.fixef(YB_K_lit1416)
anova(YB_K_lit1416, type=3)
plot(allEffects(YB_K_lit1416))

YB_Mglit1416<-lmer(Mgmid~Ntrt*Ptrt+Age +Mglitpre +Site+(1|Stand),data=NPlit_prepost_1416YB)
plot(YB_Mglit1416)
hist(resid(YB_Mglit1416))
shapiro.test(resid(YB_Mglit1416))
fixef(YB_Mglit1416)
se.fixef(YB_Mglit1416)
anova(YB_Mglit1416, type=3)
plot(allEffects(YB_Mglit1416))
```

Species-Specific Models: White Birch 2014-16
```{r}
NPlit_prepost_WB1416<- subset(NPlit_prepost_means1416, Species == "WB")

WB_Nlit1416<-lmer(Nmid~Ntrt*Ptrt+Site + Nlitpre+(1|Stand),data=NPlit_prepost_WB1416)
plot(WB_Nlit1416)
hist(resid(WB_Nlit1416))
shapiro.test(resid(WB_Nlit1416))
anova(WB_Nlit1416, type=3)
fixef(WB_Nlit1416)
se.fixef(WB_Nlit1416)
plot(allEffects(WB_Nlit1416))

WB_Plit1416<-lmer(Pmid~Ntrt*Ptrt + Plitpre+(1|Stand),data=NPlit_prepost_WB1416)
plot(WB_Plit1416)
hist(resid(WB_Plit1416))
shapiro.test(resid(WB_Plit1416))
fixef(WB_Plit1416)
se.fixef(WB_Plit1416)
anova(WB_Plit1416, type=3)
ranef(WB_Plit1416)
plot(allEffects(WB_Plit1416))

WB_Calit1416<-lmer(Camid~Ntrt*Ptrt+Calitpre+ Site+(1|Stand),data=NPlit_prepost_WB1416)
plot(WB_Calit1416)
hist(resid(WB_Calit1416))
shapiro.test(resid(WB_Calit1416))
fixef(WB_Calit1416)
se.fixef(WB_Calit1416)
anova(WB_Calit1416, type=3)
plot(allEffects(WB_Calit1416))

WB_K_lit1416<-lmer(Kmid~Ntrt*Ptrt+Klitpre  +Site+ (1|Stand),data=NPlit_prepost_WB1416)
plot(WB_K_lit1416)
hist(resid(WB_K_lit1416))
shapiro.test(resid(WB_K_lit1416))
fixef(WB_K_lit1416)
se.fixef(WB_K_lit1416)
anova(WB_K_lit1416, type=3)
plot(allEffects(WB_K_lit1416))

WB_Mglit1416<-lmer(Mgmid~Ntrt*Ptrt+Mglitpre +Site+ (1|Stand),data=NPlit_prepost_WB1416)
plot(WB_Mglit1416)
hist(resid(WB_Mglit1416))
shapiro.test(resid(WB_Mglit1416))
fixef(WB_Mglit1416)
se.fixef(WB_Mglit1416)
anova(WB_Mglit1416, type=3)
plot(allEffects(WB_Mglit1416))
```

```{r}
NPlit_prepost_RM1416<-subset(NPlit_prepost_means1416, Species =="RM")
NPlit_prepost_PC1416<-subset(NPlit_prepost_means1416, Species =="PC")

#Plot with treatment across stands
plot<-ggplot(NPlit_prepost_RM1416,aes(x=Stand, y = Camid, color=Treatment))+
  geom_point(size=3, aes(shape = Species))+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("N")+
  theme_bw(base_size=16)
print(plot)
```

```{r}
litNP$Age<-ifelse(litNP$Stand=="C8"|litNP$Stand=="C9"|litNP$Stand=="HBO"|litNP$Stand=="JBO","Mature","Mid")
#Merge with different datasets
CWM_NP_chemlit_species_2022<-merge(plot_sumba, litNP)
CWM_chemlit_species_2015<-merge(plot_sumba,midlitmeansNPi2)
CWM_chemlit_species_pre<-merge(plot_sumba,pretreat0910litmeani2)
CWM_NP_chemlit_species_pre<-subset(CWM_chemlit_species_pre, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")

#Calculate total basal area given the species sampled
total_sumba_2022lit<-ddply(CWM_NP_chemlit_species_2022,.(Site, Age, Stand, Plot,Treatment), summarize,
        BA2019tot = sum(BA2019m2sum, na.rm=T))
total_sumba_2015lit<-ddply(CWM_chemlit_species_2015,.(Site, Age, Stand, Plot,Treatment), summarize,
        BA2015tot = sum(BA2015m2sum, na.rm=T))
total_sumba_prelit<-ddply(CWM_NP_chemlit_species_pre,.(Site, Age, Stand, Plot,Treatment), summarize,
        BA2011tot = sum(BA2011m2sum, na.rm=T))

write.csv(total_sumba_2015lit, "total_sumba_2015lit.csv")
#Calculate proportion of basal area per species given the species sampled
CWM_NP_chemlit_species_2022_ba<-full_join(total_sumba_2022lit, CWM_NP_chemlit_species_2022)
CWM_NP_chemlit_species_2022_ba$prop2019<-CWM_NP_chemlit_species_2022_ba$BA2019m2sum/CWM_NP_chemlit_species_2022_ba$BA2019tot

CWM_NP_chemlit_species_2015_ba<-full_join(total_sumba_2015lit, CWM_chemlit_species_2015)
CWM_NP_chemlit_species_2015_ba<-subset(CWM_NP_chemlit_species_2015_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chemlit_species_2015_ba<-subset(CWM_NP_chemlit_species_2015_ba, Plot !="7")
CWM_NP_chemlit_species_2015_ba$prop2015<-CWM_NP_chemlit_species_2015_ba$BA2015m2sum/CWM_NP_chemlit_species_2015_ba$BA2015tot

CWM_NP_chemlit_species_pre_ba<-full_join(total_sumba_prelit, CWM_NP_chemlit_species_pre)
CWM_NP_chemlit_species_pre_ba<-subset(CWM_NP_chemlit_species_pre_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chemlit_species_pre_ba$prop2011<-CWM_NP_chemlit_species_pre_ba$BA2011m2sum/CWM_NP_chemlit_species_pre_ba$BA2011tot


#Check to make sure proportions add up to 1
propcheck_2022lit<-ddply(CWM_NP_chemlit_species_2022_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2019, na.rm=T))
propcheck_2015<-ddply(CWM_NP_chemlit_species_2015_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
      Check = sum(prop2015, na.rm=T))
propcheck_prelit<-ddply(CWM_NP_chemlit_species_pre_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2011, na.rm=T))
        propcheck_2022lit
```

Calculate CWM:
```{r}
#2022
CWM_NP_chemlit<-ddply(CWM_NP_chemlit_species_2022_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
     Nlitcwm= sum(N*prop2019, na.rm=T),
     Plitcwm = sum(P*prop2019, na.rm=T),
     Calitcwm=sum(Ca*prop2019, na.rm=T),
     Klitcwm = sum(K*prop2019, na.rm=T),
     Mglitcwm = sum(Mg*prop2019, na.rm=T),
     Mnlitcwm = sum(Mn*prop2019, na.rm=T),
     Slitcwm = sum(S*prop2019, na.rm=T))

CWM_NP_chemlit_mid<-ddply(CWM_NP_chemlit_species_2015_ba, c("Site","Stand","Treatment","Plot"),summarize,
     Nlitmidcwm= sum(Nmid*prop2015, na.rm=T),
     Plitmidcwm = sum(Pmid*prop2015, na.rm=T),
     Calitmidcwm=sum(Camid*prop2015, na.rm=T),
     Klitmidcwm = sum(Kmid*prop2015, na.rm=T),
     Mglitmidcwm = sum(Mgmid*prop2015, na.rm=T))

CWM_NP_chemlit_pre<-ddply(CWM_NP_chemlit_species_pre_ba, c("Site","Stand","Plot"),summarize,
     Nlitprecwm= sum(Nlitpre*prop2011, na.rm=T),
     Plitprecwm = sum(Plitpre*prop2011, na.rm=T),
     Calitprecwm=sum(Calitpre*prop2011, na.rm=T),
     Klitprecwm = sum(Klitpre*prop2011, na.rm=T),
     Mglitprecwm = sum(Mglitpre*prop2011, na.rm=T),
     Mnlitprecwm = sum(Mnlitpre*prop2011, na.rm=T))
    
CWM_NP_chemlit$Sampling<-"2021-22"
CWM_NP_chemlit$Age<-ifelse(CWM_NP_chemlit$Stand=="JBO"|CWM_NP_chemlit$Stand=="HBO"|CWM_NP_chemlit$Stand=="C8"|CWM_NP_chemlit$Stand=="C8","Mature","Mid")

CWM_NP_chemlit_model<-merge(CWM_NP_chemlit_pre, CWM_NP_chemlit)
CWM_NP_chemlit_model$Age<-ifelse(CWM_NP_chemlit_model$Stand=="C8"|CWM_NP_chemlit_model$Stand=="C9"|CWM_NP_chemlit_model$Stand=="HBO"|CWM_NP_chemlit_model$Stand=="JBO","Mature","Mid")

CWM_NP_chemlit_modelmid<-merge(CWM_NP_chemlit_pre, CWM_NP_chemlit_mid)
CWM_NP_chemlit_modelmid$Age<-ifelse(CWM_NP_chemlit_modelmid$Stand=="C8"|CWM_NP_chemlit_modelmid$Stand=="C9"|CWM_NP_chemlit_modelmid$Stand=="HBO"|CWM_NP_chemlit_modelmid$Stand=="JBO","Mature","Mid")
CWM_NP_chemlit_modelmid$Ntrt<-ifelse(CWM_NP_chemlit_modelmid$Treatment=="N"|CWM_NP_chemlit_modelmid$Treatment=="NP",1,0)
CWM_NP_chemlit_modelmid$Ptrt<-ifelse(CWM_NP_chemlit_modelmid$Treatment=="P"|CWM_NP_chemlit_modelmid$Treatment=="NP",1,0)
CWM_NP_chemlit_modelmid$Ntrt<-as.factor(CWM_NP_chemlit_modelmid$Ntrt)
CWM_NP_chemlit_modelmid$Ptrt<-as.factor(CWM_NP_chemlit_modelmid$Ptrt)
CWM_NP_chemlit_model$Site<-as.factor(CWM_NP_chemlit_model$Site)
CWM_NP_chemlit_modelmid$Site<-as.factor(CWM_NP_chemlit_modelmid$Site)
```

Models:
```{r}
#N
CWM_Nlit<-lmer(Nlitcwm~Ntrt*Ptrt+Age + Nlitprecwm+ Site+(1|Stand),data=CWM_NP_chemlit_model)
plot(CWM_Nlit)
fixef(CWM_Nlit)
se.fixef(CWM_Nlit)
hist(resid(CWM_Nlit))
shapiro.test(resid(CWM_Nlit))
anova(CWM_Nlit, type=3)
plot(allEffects(CWM_Nlit))
difflsmeans(CWM_Nlit, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")
contrast(ls)

#N 2014-16
CWM_Nlitmid<-lmer(Nlitmidcwm~Ntrt*Ptrt+Age + Nlitprecwm+ Site+(1|Stand),data=CWM_NP_chemlit_modelmid)
plot(CWM_Nlitmid)
fixef(CWM_Nlitmid)
se.fixef(CWM_Nlitmid)
hist(resid(CWM_Nlitmid))
shapiro.test(resid(CWM_Nlitmid))
anova(CWM_Nlitmid, type=3)
plot(allEffects(CWM_Nlitmid))
difflsmeans(CWM_Nlitmid, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")
contrast(ls)

#P
CWM_Plit<-lmer(Plitcwm~Ntrt*Ptrt+Age+ Plitprecwm+Site+ (1|Stand),data=CWM_NP_chemlit_model)
plot(CWM_Plit)
hist(resid(CWM_Plit))
shapiro.test(resid(CWM_Plit))
fixef(CWM_Plit)
se.fixef(CWM_Plit)
anova(CWM_Plit, type=3)
plot(allEffects(CWM_Plit))
difflsmeans(CWM_Plit, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")

#P 2014-16
CWM_Plitmid<-lmer(Plitmidcwm~Ntrt*Ptrt+Age +Plitprecwm+(1|Stand),data=CWM_NP_chemlit_modelmid)
plot(CWM_Plitmid)
fixef(CWM_Plitmid)
se.fixef(CWM_Plitmid)
hist(resid(CWM_Plitmid))
shapiro.test(resid(CWM_Plitmid))
anova(CWM_Plitmid, type=3)
plot(allEffects(CWM_Plitmid))
difflsmeans(CWM_Plitmid, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")

#Ca
CWM_Calit<-lmer(Calitcwm~Ntrt*Ptrt+Age+Calitprecwm+(1|Stand),data=CWM_NP_chemlit_model)
plot(CWM_Calit)
hist(resid(CWM_Calit))
shapiro.test(resid(CWM_Calit))
fixef(CWM_Calit)
se.fixef(CWM_Calit)
anova(CWM_Calit, type=3)
ranef(CWM_Calit)
difflsmeans(CWM_Calit, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")
plot(allEffects(CWM_Calit))
difflsmeans(CWM_Calit)
lsmeans(CWM_Calit, specs=~Site)

# Ca 2014-16
CWM_Calitmid<-lmer(Calitmidcwm~Ntrt*Ptrt+Age+Calitprecwm+(1|Stand),data=CWM_NP_chemlit_modelmid)
plot(CWM_Calitmid)
fixef(CWM_Calitmid)
se.fixef(CWM_Calitmid)
hist(resid(CWM_Calitmid))
shapiro.test(resid(CWM_Calitmid))
anova(CWM_Calitmid, type=3)
difflsmeans(CWM_Calitmid, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")
plot(allEffects(CWM_Calitmid))

#K
CWM_K_lit<-lmer(Klitcwm~Ntrt*Ptrt+Age + Klitprecwm+ Site+(1|Stand),data=CWM_NP_chemlit_model)
plot(CWM_K_lit)
hist(resid(CWM_K_lit))
shapiro.test(resid(CWM_K_lit))
fixef(CWM_K_lit)
se.fixef(CWM_K_lit)
anova(CWM_K_lit, type=3)
ranef(CWM_K_lit)
difflsmeans(CWM_K_lit, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")
plot(allEffects(CWM_K_lit))

#K 2014-16
CWM_NP_chemlit_modelmid$lnK<-log(CWM_NP_chemlit_modelmid$Klitmidcwm)
CWM_Klitmid<-lmer(lnK~Ntrt*Ptrt+Age + Klitprecwm+Site+(1|Stand),data=CWM_NP_chemlit_modelmid)
plot(CWM_Klitmid)
fixef(CWM_Klitmid)
se.fixef(CWM_Klitmid)
hist(resid(CWM_Klitmid))
shapiro.test(resid(CWM_Klitmid))
anova(CWM_Klitmid, type=3)
plot(allEffects(CWM_Klitmid))
difflsmeans(CWM_Klitmid, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")
contrast(lsmeans(CWM_Klitmid, specs=~Age, ddf = "Satterthwaite"))

#Mg
CWM_Mg_lit<-lmer(Mglitcwm~Ntrt*Ptrt+Age + Mglitprecwm+ Site+ (1|Stand),data=CWM_NP_chemlit_model)
plot(CWM_Mg_lit)
hist(resid(CWM_Mg_lit))
shapiro.test(resid(CWM_Mg_lit))
fixef(CWM_Mg_lit)
se.fixef(CWM_Mg_lit)
anova(CWM_Mg_lit, type=3)
ranef(CWM_Mg_lit)
contrast(lsmeans(CWM_Mg_lit, specs=~Site, ddf = "Satterthwaite"))
difflsmeans(CWM_Mg_lit, specs=~Ntrt:Ptrt, ddf = "Satterthwaite")
plot(allEffects(CWM_Mg_lit))
 
#2014-16
CWM_Mglitmid<-lmer(Mglitmidcwm~Ntrt*Ptrt+Age + Mglitprecwm+Site+(1|Stand),data=CWM_NP_chemlit_modelmid)
plot(CWM_Mglitmid)
fixef(CWM_Mglitmid)
se.fixef(CWM_Mglitmid)
hist(resid(CWM_Mglitmid))
shapiro.test(resid(CWM_Mglitmid))
anova(CWM_Mglitmid, type=3)
contrast(lsmeans(CWM_Mglitmid, specs=~Site, ddf = "Satterthwaite"))
plot(allEffects(CWM_Mglitmid))
difflsmeans(CWM_Mglitmid, specs=~Site, ddf = "Satterthwaite")
lsmeans(CWM_Mglitmid, specs=~Site, ddf = "Satterthwaite")

plot<-ggplot(CWM_NP_chemlit_modelmid,aes(x=Stand, y = Nlitmidcwm, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("Community-Weighted S")+
  theme_bw(base_size=16)
print(plot)
```

Graphs including mid information (pre vs. mid + now)
```{r}
#Create a file merging 2022 and 2015 data

CWM_NP_chemlit_mid$Sampling <- "2014-16"

CWM_NP_chemlit_mid$Nlitcwm <-CWM_NP_chemlit_mid$Nlitmidcwm
CWM_NP_chemlit_mid$Plitcwm <-CWM_NP_chemlit_mid$Plitmidcwm
CWM_NP_chemlit_mid$Calitcwm <-CWM_NP_chemlit_mid$Calitmidcwm
CWM_NP_chemlit_mid$Klitcwm <-CWM_NP_chemlit_mid$Klitmidcwm
CWM_NP_chemlit_mid$Mglitcwm <-CWM_NP_chemlit_mid$Mglitmidcwm

CWM_NP_chem_mid2<-CWM_NP_chem_mid[,c(1:6,14:21)]

CWM_NP_chemlit_graph<-full_join(CWM_NP_chemlit, CWM_NP_chemlit_mid)

CWM_NP_chemlit_prepost_graph<-merge(CWM_NP_chemlit_graph, CWM_NP_chemlit_pre)
CWM_NP_chemlit_prepost_graph$Treatment<-factor(CWM_NP_chemlit_prepost_graph$Treatment, levels = c("Control","N","P","NP"), ordered=T)
CWM_NP_chemlit_prepost_graph$Shape<-paste(CWM_NP_chemlit_prepost_graph$Site, CWM_NP_chemlit_prepost_graph$Sampling, sep="_")
CWM_NP_chemlit_prepost_graph$Group<-paste(CWM_NP_chemlit_prepost_graph$Treatment, CWM_NP_chemlit_prepost_graph$Sampling, sep="_")
unique(CWM_NP_chemlit_prepost_graph$Group)
```

Graphs:
```{r}
#Litter N
litcwmN<-CWM_NP_chemlit_prepost_graph%>% ggplot(aes(x= Nlitprecwm, y = Nlitcwm,  col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(5,16))+
scale_x_continuous(expand=c(0,0), limits = c(5,17))+
  scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre N (mg/g)")+
  ylab("Post N (mg/g)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
#plot(litcwmN)

CWM_NP_chemlit_model$Group<-paste(CWM_NP_chemlit_model$Treatment, CWM_NP_chemlit_model$Sampling, sep="_")
unique(CWM_NP_chemlit_prepost_graph$Group)

litcwmN2<-CWM_NP_chemlit_model%>% ggplot(aes(x= Group, y = Nlitcwm, col = Treatment))+geom_boxplot()+
  scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Treatment and Year")+
  ylab("Litter N (mg/g)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
#plot(litcwmN2)


#Litter P
litcwmP<-CWM_NP_chemlit_prepost_graph%>% ggplot(aes(x= Plitprecwm, y = Plitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0,3.5))+
scale_x_continuous(expand=c(0,0), limits = c(0,1.9))+
  scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre P (mg/g)")+
  ylab("Post P (mg/g)")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
#plot(litcwmP)

#Litter Ca
litcwmCa<-CWM_NP_chemlit_prepost_graph%>% ggplot(aes(x= Calitprecwm, y = Calitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(5,17))+
scale_x_continuous(expand=c(0,0), limits = c(5,17))+
  scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre Ca (mg/g)")+
  ylab("Post Ca (mg/g)")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
#plot(litcwmCa)

#Litter Mg
litcwmMg<-CWM_NP_chemlit_prepost_graph%>% ggplot(aes(x= Mglitprecwm, y = Mglitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0,3.1))+
scale_x_continuous(expand=c(0,0), limits = c(0,3.1))+
  scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre Mg (mg/g)")+
  ylab("Post Mg (mg/g)")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
#plot(litcwmMg)

#Litter K
litcwmK<-CWM_NP_chemlit_prepost_graph%>% ggplot(aes(x= Klitprecwm, y = Klitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0.5,10))+
 scale_x_continuous(expand=c(0,0), limits = c(0.5,10))+
  scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre K (mg/g)")+
  ylab("Post K (mg/g)")+
  theme_bw()+
 theme(legend.position="none")+
  theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
#plot(litcwmK)

library(cowplot)
#plot_grid(litcwmN, litcwmP, litcwmCa, litcwmK, litcwmMg, labels="auto")

TreatmentLabel <- c(
                    `Control` = "Control",
                    `N` = "N",
                    `P` = "P",
                    `NP` = "N+P"
                    )

facetlitN<-litcwmN+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetlitP<-litcwmP+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetlitCa<-litcwmCa+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetlitK<-litcwmK+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetlitMg<-litcwmMg+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))

plot_grid(facetlitN, facetlitP,facetlitCa, facetlitK, facetlitMg, nrow=5)
```

```{r}

CWM_NP_chemlit_prepost_graphN<-filter(CWM_NP_chemlit_prepost_graph, Treatment=="N"|Treatment=="NP")
CWM_NP_chemlit_prepost_graphP<-filter(CWM_NP_chemlit_prepost_graph, Treatment=="P"|Treatment=="NP")

CWM_NP_chemlit_prepost_graphN1<-filter(CWM_NP_chemlit_prepost_graph, Treatment=="N")
CWM_NP_chemlit_prepost_graphP1<-filter(CWM_NP_chemlit_prepost_graph, Treatment=="P")
CWM_NP_chemlit_prepost_graphNP1<-filter(CWM_NP_chemlit_prepost_graph, Treatment=="NP")
CWM_NP_chemlit_prepost_graphC1<-filter(CWM_NP_chemlit_prepost_graph, Treatment=="Control")


#####################
#Litter N - N
litcwmN_N<-CWM_NP_chemlit_prepost_graphN1%>% ggplot(aes(x= Nlitprecwm, y = Nlitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(5,15))+
scale_x_continuous(expand=c(0,0), limits = c(5,15))+
  scale_color_manual(values = c("blue"))+
  xlab("")+
  ylab("")+
  theme_bw()+
  theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmN_N)

#Litter N - P
litcwmN_P<-CWM_NP_chemlit_prepost_graphP1%>% ggplot(aes(x= Nlitprecwm, y = Nlitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(5,15))+
scale_x_continuous(expand=c(0,0), limits = c(5,15))+
  scale_color_manual(values = c("red"))+
  xlab("")+
  ylab("")+
  theme_bw()+
  theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmN_P)


#Litter N - NP
litcwmN_NP<-CWM_NP_chemlit_prepost_graphNP1%>% ggplot(aes(x= Nlitprecwm, y = Nlitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(5,15))+
scale_x_continuous(expand=c(0,0), limits = c(5,15))+
  scale_color_manual(values = c("purple"))+
  xlab("")+
  ylab("")+
  theme_bw()+
  theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmN_NP)

#Litter N - Ctrl
litcwmN_C<-CWM_NP_chemlit_prepost_graphC1%>% ggplot(aes(x= Nlitprecwm, y = Nlitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(5,15))+
scale_x_continuous(expand=c(0,0), limits = c(5,15))+
  scale_color_manual(values = c("gray"))+
  xlab("")+
  ylab("Post-treatment Litter N (mg/g)")+
  theme_bw()+
  theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmN_C)


#Litter P-N
litcwmP_N<-CWM_NP_chemlit_prepost_graphN1%>% ggplot(aes(x= Plitprecwm, y = Plitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0,3.5))+
scale_x_continuous(expand=c(0,0), limits = c(0,1.55))+
  scale_color_manual(values = c("blue"))+
  xlab("")+
  ylab("")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmP_N)

#Litter P-P
litcwmP_P<-CWM_NP_chemlit_prepost_graphP1%>% ggplot(aes(x= Plitprecwm, y = Plitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0,3.5))+
scale_x_continuous(expand=c(0,0), limits = c(0,1.55))+
  scale_color_manual(values = c("red"))+
  xlab("")+
  ylab("")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmP_P)


#Litter P-NP
litcwmP_NP<-CWM_NP_chemlit_prepost_graphNP1%>% ggplot(aes(x= Plitprecwm, y = Plitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0,3.5))+
scale_x_continuous(expand=c(0,0), limits = c(0,1.55))+
  scale_color_manual(values = c("purple"))+
  xlab("")+
  ylab("")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmP_NP)

#Litter P-C
litcwmP_C<-CWM_NP_chemlit_prepost_graphC1%>% ggplot(aes(x= Plitprecwm, y = Plitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0,3.5))+
scale_x_continuous(expand=c(0,0), limits = c(0,1.55))+
  scale_color_manual(values = c("gray"))+
  xlab("Pre-treatment (mg/g)")+
  ylab("Post-treatment Litter P (mg/g)")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmP_C)

plot_grid(litcwmN_C,litcwmN_N, litcwmN_P, litcwmN_NP,  litcwmP_C,litcwmP_N, litcwmP_P, litcwmP_NP, nrow=2,labels="auto")

#Litter Ca
litcwmCa<-CWM_NP_chemlit_prepost_graph%>% ggplot(aes(x= Calitprecwm, y = Calitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(5,17))+
scale_x_continuous(expand=c(0,0), limits = c(5,17))+
  scale_color_manual(values = c("gray", "blue", "red","purple"))+
  xlab("Pre-treatment Litter Ca (mg/g)")+
  ylab("Post-treatment Litter Ca (mg/g)")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmCa)

#Litter Mg
litcwmMg<-CWM_NP_chemlit_prepost_graph%>% ggplot(aes(x= Mglitprecwm, y = Mglitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0,3))+
scale_x_continuous(expand=c(0,0), limits = c(0,3))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Pre-treatment Litter Mg (mg/g)")+
  ylab("Post-treatment Litter Mg (mg/g)")+
  theme_bw()+
    theme(legend.position="none")+
    theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmMg)

#Litter K
litcwmK<-CWM_NP_chemlit_prepost_graph%>% ggplot(aes(x= Klitprecwm, y = Klitcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(0.5,10))+
 scale_x_continuous(expand=c(0,0), limits = c(0.5,10))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Pre-treatment Litter K (mg/g)")+
  ylab("Post-treatment Litter K (mg/g)")+
  theme_bw()+
 theme(legend.position="none")+
  theme(axis.text=element_text(size=15), axis.title=element_text(size=17), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(litcwmK)

library(cowplot)
plot_grid(litcwmN, litcwmP, litcwmCa, litcwmK, litcwmMg, labels="auto")
```







CWM inter for litter:
```{r}
NP_lit_2122mean_fixed<-ddply(litNP, c("Species"), summarise,
      Nf= mean(N, na.rm=T),
      Pf = mean(P, na.rm=T),
      Caf = mean(Ca, na.rm=T),
      Mgf = mean(Mg, na.rm=T),
      Kf = mean(K, na.rm=T))

NP_lit_1416mean_fixed<-ddply(midlitmeans, c("Species"), summarise,
      Nmidf= mean(Nmid, na.rm=T),
      Pmidf = mean(Pmid, na.rm=T),
      Camidf = mean(Camid, na.rm=T),
      Mgmidf = mean(Mgmid, na.rm=T),
      Kmidf = mean(Kmid, na.rm=T))

NP_lit_0910_mean_fixed<-ddply(pretreat0910litmeani2, c("Species"), summarise,
      Nlitpref = mean(Nlitpre, na.rm=T),
      Plitpref = mean(Plitpre, na.rm=T),
      Calitpref = mean(Calitpre, na.rm=T),
      Mglitpref = mean(Mglitpre, na.rm=T),
      Klitpref = mean(Klitpre, na.rm=T))

CWM_NP_chemlit_species_2022f<-merge(plot_sumba, NP_lit_2122mean_fixed)
CWM_NP_chemlit_species_2022f<-subset(CWM_NP_chemlit_species_2022f, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chemlit_species_2022f<-subset(CWM_NP_chemlit_species_2022f, Treatment !="Ca")
CWM_NP_chemlit_species_2022f<-subset(CWM_NP_chemlit_species_2022f, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_NP_chemlit_species_2022f$ID<-paste(CWM_NP_chemlit_species_2022f$Site,CWM_NP_chemlit_species_2022f$Stand, CWM_NP_chemlit_species_2022f$Plot, CWM_NP_chemlit_species_2022f$Species, sep = "_")

CWM_NP_chemlit_species_2022$ID<-paste(CWM_NP_chemlit_species_2022$Site,CWM_NP_chemlit_species_2022$Stand, CWM_NP_chemlit_species_2022$Plot, CWM_NP_chemlit_species_2022$Species, sep = "_")


CWM_NP_chemlit_species_2022f_merge<-merge(CWM_NP_chemlit_species_2022, CWM_NP_chemlit_species_2022f, by = c("Site","Stand","Plot","Species","Age","ID","Treatment","BA2019m2sum","BA2015m2sum","BA2011m2sum"))

CWM_NP_chemlit_species_2022f<-CWM_NP_chemlit_species_2022f_merge[,c(1:12, 33:37)]


CWM_NP_chemlit_species_2015f<-merge(plot_sumba, NP_lit_1416mean_fixed)
CWM_NP_chemlit_species_2015f<-subset(CWM_NP_chemlit_species_2015f, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chemlit_species_2015f<-subset(CWM_NP_chemlit_species_2015f, Treatment !="Ca")
CWM_NP_chemlit_species_2015f<-subset(CWM_NP_chemlit_species_2015f, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_NP_chemlit_species_2015f$ID<-paste(CWM_NP_chemlit_species_2015f$Site,CWM_NP_chemlit_species_2015f$Stand, CWM_NP_chemlit_species_2015f$Plot, CWM_NP_chemlit_species_2015f$Species, sep = "_")

CWM_chemlit_species_2015$ID<-paste(CWM_chemlit_species_2015$Site,CWM_chemlit_species_2015$Stand, CWM_chemlit_species_2015$Plot, CWM_chemlit_species_2015$Species, sep = "_")


CWM_NP_chemlit_species_2015f_merge<-merge(CWM_chemlit_species_2015, CWM_NP_chemlit_species_2015f, by = c("Site","Stand","Plot","Species","Age","ID","Treatment","BA2019m2sum","BA2015m2sum","BA2011m2sum"))
CWM_NP_chemlit_species_2015f_merge


CWM_chemlit_species_pref<-merge(plot_sumba,pretreat0910litmeani2)
CWM_chemlit_species_pref<-merge(CWM_chemlit_species_pref, NP_lit_0910_mean_fixed)
CWM_chemlit_species_pref<-subset(CWM_chemlit_species_pref, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_chemlit_species_pref<-subset(CWM_chemlit_species_pref, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_chemlit_species_pref$ID<-paste(CWM_chemlit_species_pref$Site,CWM_chemlit_species_pref$Stand, CWM_chemlit_species_pref$Plot, CWM_chemlit_species_pref$Species, sep = "_")
CWM_chemlit_species_pre$ID<-paste(CWM_chemlit_species_pre$Site,CWM_chemlit_species_pre$Stand, CWM_chemlit_species_pre$Plot, CWM_chemlit_species_pre$Species, sep = "_")
CWM_NP_chemlit_species_pref_merge<-merge(CWM_NP_chemlit_species_pre, CWM_chemlit_species_pref)
CWM_NP_chemlit_species_pref<-CWM_NP_chemlit_species_pref_merge[,c(1:9,16:22)]

#Calculate proportion of basal area per species given the species sampled
CWM_NP_chemlit_species_2022f_ba<-full_join(total_sumba_2022lit, CWM_NP_chemlit_species_2022f)
CWM_NP_chemlit_species_2022f_ba$prop2019<-CWM_NP_chemlit_species_2022f_ba$BA2019m2sum/CWM_NP_chemlit_species_2022f_ba$BA2019tot

CWM_NP_chemlit_species_2015f_ba<-full_join(total_sumba_2015lit, CWM_NP_chemlit_species_2015f_merge)
CWM_NP_chemlit_species_2015f_ba$prop2015<-CWM_NP_chemlit_species_2015f_ba$BA2015m2sum/CWM_NP_chemlit_species_2015f_ba$BA2015tot

CWM_NP_chemlit_species_pref_ba<-full_join(total_sumba_prelit, CWM_NP_chemlit_species_pref)
CWM_NP_chemlit_species_pref_ba<-subset(CWM_NP_chemlit_species_pref_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_chemlit_species_pref_ba$prop2011<-CWM_NP_chemlit_species_pref_ba$BA2011m2sum/CWM_NP_chemlit_species_pref_ba$BA2011tot

write.csv(CWM_NP_chemlit_species_2015f_ba, "CWM_NP_chemlit_species_2015f_ba.csv")

#Check to make sure proportions add up to 1
propcheck_2022litf<-ddply(CWM_NP_chemlit_species_2022f_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2019, na.rm=T))
propcheck_2015litf<-ddply(CWM_NP_chemlit_species_2015f_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2015, na.rm=T))
propcheck_prelitf<-ddply(CWM_NP_chemlit_species_pref_ba,.(Site, Age, Stand, Plot), summarize,
        Check = sum(prop2011, na.rm=T))
```
Calculate CWMinter:

Calculate CWM:
```{r}
#2022
CWM_NP_chemlitf<-ddply(CWM_NP_chemlit_species_2022f_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
     Nlitcwmf= sum(Nf*prop2019, na.rm=T),
     Plitcwmf = sum(Pf*prop2019, na.rm=T),
     Calitcwmf=sum(Caf*prop2019, na.rm=T),
     Klitcwmf = sum(Kf*prop2019, na.rm=T),
     Mglitcwmf = sum(Mgf*prop2019, na.rm=T))

CWM_NP_chemlit_midf<-ddply(CWM_NP_chemlit_species_2015f_ba, c("Site","Stand","Treatment","Plot"),summarize,
     Nlitcwmmidf= sum(Nmidf*prop2015, na.rm=T),
     Plitcwmmidf = sum(Pmidf*prop2015, na.rm=T),
     Calitcwmmidf=sum(Camidf*prop2015, na.rm=T),
     Klitcwmmidf = sum(Kmidf*prop2015, na.rm=T),
     Mglitcwmmidf = sum(Mgmidf*prop2015, na.rm=T))

CWM_NP_chemlit_pref<-ddply(CWM_NP_chemlit_species_pref_ba, c("Site","Stand","Plot"),summarize,
     Nlitprecwmf= sum(Nlitpref*prop2011, na.rm=T),
     Plitprecwmf = sum(Plitpref*prop2011, na.rm=T),
     Calitprecwmf=sum(Calitpref*prop2011, na.rm=T),
     Klitprecwmf = sum(Klitpref*prop2011, na.rm=T),
     Mglitprecwmf = sum(Mglitpref*prop2011, na.rm=T))

CWM_NP_chemlitf$Age<-ifelse(CWM_NP_chemlitf$Stand=="JBO"|CWM_NP_chemlitf$Stand=="HBO"|CWM_NP_chemlitf$Stand=="C8"|CWM_NP_chemlitf$Stand=="C8","Mature","Mid")
CWM_NP_chemlit_midf$Age<-ifelse(CWM_NP_chemlit_midf$Stand=="JBO"|CWM_NP_chemlit_midf$Stand=="HBO"|CWM_NP_chemlit_midf$Stand=="C8"|CWM_NP_chemlit_midf$Stand=="C8","Mature","Mid")

CWM_NP_chemlit_midf$Ntrt<-ifelse(CWM_NP_chemlit_midf$Treatment=="N"|CWM_NP_chemlit_midf$Treatment=="NP",1,0)
CWM_NP_chemlit_midf$Ptrt<-ifelse(CWM_NP_chemlit_midf$Treatment=="P"|CWM_NP_chemlit_midf$Treatment=="NP",1,0)

CWM_NP_chemlit_modelf<-merge(CWM_NP_chemlit_pref, CWM_NP_chemlitf)
CWM_NP_chemlit_modelf$Age<-ifelse(CWM_NP_chemlit_modelf$Stand=="C8"|CWM_NP_chemlit_modelf$Stand=="C9"|CWM_NP_chemlit_modelf$Stand=="HBO"|CWM_NP_chemlit_modelf$Stand=="JBO","Mature","Mid")

CWM_NP_chemlit_modelmidf<-merge(CWM_NP_chemlit_pref, CWM_NP_chemlit_midf)
CWM_NP_chemlit_modelmidf$Age<-ifelse(CWM_NP_chemlit_modelmidf$Stand=="C8"|CWM_NP_chemlit_modelmidf$Stand=="C9"|CWM_NP_chemlit_modelmidf$Stand=="HBO"|CWM_NP_chemlit_modelmidf$Stand=="JBO","Mature","Mid")
```

CWM inter models for N, P, Ca
```{r}
CWM_NP_chemlit_modelmidf<-subset(CWM_NP_chemlit_modelmidf, Stand !="HBCa")
CWM_NP_chemlit_modelmidf<-subset(CWM_NP_chemlit_modelmidf, Plot !=7)
CWM_NP_chemlit_modelmidf$Ntrt<-as.factor(CWM_NP_chemlit_modelmidf$Ntrt)
CWM_NP_chemlit_modelmidf$Ptrt<-as.factor(CWM_NP_chemlit_modelmidf$Ptrt)
str(CWM_NP_chemlit_modelf)

#N
CWM_NP_chemlit_modelf$logNlitcwmf<-log(CWM_NP_chemlit_modelf$Nlitcwmf)
CWM_Nmflit<-lmer(Nlitcwmf~Ntrt*Ptrt+Age+Nlitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelf)
plot(CWM_Nmflit)
hist(resid(CWM_Nmflit))
shapiro.test(resid(CWM_Nmflit))
fixef(CWM_Nmflit)
se.fixef(CWM_Nmflit)
anova(CWM_Nmflit, type=3)
contrast(lsmeans(CWM_Nmflit, specs=~Site))
plot(allEffects(CWM_Nmflit))

#Nmid
CWM_NP_chemlit_modelmidf$logNlitcwmmidf<-log(CWM_NP_chemlit_modelmidf$Nlitcwmmidf)
CWM_Nmfmidlit<-lmer(Nlitcwmmidf~Ntrt*Ptrt+Age+Nlitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelmidf)
plot(CWM_Nmfmidlit)
hist(resid(CWM_Nmfmidlit))
shapiro.test(resid(CWM_Nmfmidlit))
fixef(CWM_Nmfmidlit)
se.fixef(CWM_Nmfmidlit)
anova(CWM_Nmfmidlit, type=3)
plot(allEffects(CWM_Nmfmidlit))

#P:
CWM_Pmflit<-lmer(Plitcwmf~Ntrt*Ptrt+Age+Plitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelf)
plot(CWM_Pmflit)
hist(resid(CWM_Pmflit))
shapiro.test(resid(CWM_Pmflit))
fixef(CWM_Pmflit)
se.fixef(CWM_Pmflit)
anova(CWM_Pmflit, type=3)
ranef(CWM_Pmflit)
contrast(lsmeans(CWM_Pmflit, specs=~Site))
plot(allEffects(CWM_Pmflit))

#P mid:
CWM_Pmmidflit<-lmer(Plitcwmmidf~Ntrt*Ptrt+Age+Plitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelmidf)
plot(CWM_Pmmidflit)
hist(resid(CWM_Pmmidflit))
shapiro.test(resid(CWM_Pmmidflit))
fixef(CWM_Pmmidflit)
se.fixef(CWM_Pmmidflit)
anova(CWM_Pmmidflit, type=3)
ranef(CWM_Pmmidflit)
contrast(lsmeans(CWM_Pmflit, specs=~Age, ddf = "Satterthwaite"))

#Ca
CWM_Camflit<-lmer(Calitcwmf~Ntrt*Ptrt+Age+Calitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelf)
plot(CWM_Camflit)
hist(resid(CWM_Camflit))
shapiro.test(resid(CWM_Camflit))
fixef(CWM_Camflit)
se.fixef(CWM_Camflit)
anova(CWM_Camflit, type=3)
ranef(CWM_Camflit)

#Ca-mid
CWM_Cammidflit<-lmer(Calitcwmmidf~Ntrt*Ptrt+Age+Calitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelmidf)
plot(CWM_Cammidflit)
hist(resid(CWM_Cammidflit))
shapiro.test(resid(CWM_Cammidflit))
fixef(CWM_Cammidflit)
se.fixef(CWM_Cammidflit)
anova(CWM_Cammidflit, type=3)
ranef(CWM_Cammidflit)
contrast(lsmeans(CWM_Cammidflit, specs=~Age, ddf = "Satterthwaite"))
plot(allEffects(CWM_Cammidflit))

#K
CWM_Kmflit<-lmer(Klitcwmf~Ntrt*Ptrt+Age+Klitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelf)
plot(CWM_Kmflit)
hist(resid(CWM_Kmflit))
shapiro.test(resid(CWM_Kmflit))
fixef(CWM_Kmflit)
se.fixef(CWM_Kmflit)
anova(CWM_Kmflit, type=3)
ranef(CWM_Kmflit)
plot(allEffects(CWM_Kmflit))

#K mid
CWM_NP_chemlit_modelmidf$logKlitcwmmidf<-log(CWM_NP_chemlit_modelmidf$Klitcwmmidf)
CWM_Kmfmidlit<-lmer(Klitcwmmidf~Ntrt*Ptrt+Age+Klitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelmidf)
plot(CWM_Kmfmidlit)
hist(resid(CWM_Kmfmidlit))
shapiro.test(resid(CWM_Kmfmidlit))
fixef(CWM_Kmfmidlit)
se.fixef(CWM_Kmfmidlit)
anova(CWM_Kmfmidlit, type=3)
ranef(CWM_Kmfmidlit)
contrast(lsmeans(CWM_Kmfmidlit, specs=~Age, ddf = "Satterthwaite"))
plot(allEffects(CWM_Kmfmidlit))

#Mg
CWM_Mgmflit<-lmer(Mglitcwmf~Ntrt*Ptrt+Age+Mglitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelf)
plot(CWM_Mgmflit)
hist(resid(CWM_Mgmflit))
shapiro.test(resid(CWM_Mgmflit))
fixef(CWM_Mgmflit)
se.fixef(CWM_Mgmflit)
anova(CWM_Mgmflit, type=3)
ranef(CWM_Mgmflit)
plot(allEffects(CWM_Mgmflit))
contrast(lsmeans(CWM_Mgmflit, specs=~Ntrt, ddf = "Satterthwaite"))

#Mg mid
CWM_NP_chemlit_modelmidf$logKlitcwmmidf<-log(CWM_NP_chemlit_modelmidf$Klitcwmmidf)
CWM_Mgmfmidlit<-lmer(Mglitcwmmidf~Ntrt*Ptrt+Age+Mglitprecwmf +Site+(1|Stand),data=CWM_NP_chemlit_modelmidf)
plot(CWM_Mgmfmidlit)
hist(resid(CWM_Mgmfmidlit))
shapiro.test(resid(CWM_Mgmfmidlit))
fixef(CWM_Mgmfmidlit)
se.fixef(CWM_Mgmfmidlit)
anova(CWM_Mgmfmidlit, type=3)
ranef(CWM_Mgmfmidlit)
contrast(lsmeans(CWM_Mgmfmidlit, specs=~Age, ddf = "Satterthwaite"))
plot(allEffects(CWM_Mgmfmidlit))
```

CWM intra models for N, P, and Ca

Consolidate data
```{r}
CWM_NP_chem_intralit<-merge(CWM_NP_chemlit_model, CWM_NP_chemlit_modelf)
CWM_NP_chem_intralit$Ncwmint<-CWM_NP_chem_intralit$Nlitcwm-CWM_NP_chem_intralit$Nlitcwmf
CWM_NP_chem_intralit$Pcwmint<-CWM_NP_chem_intralit$Plitcwm-CWM_NP_chem_intralit$Plitcwmf
CWM_NP_chem_intralit$Cacwmint<-CWM_NP_chem_intralit$Calitcwm-CWM_NP_chem_intralit$Calitcwmf
CWM_NP_chem_intralit$Kcwmint<-CWM_NP_chem_intralit$Klitcwm-CWM_NP_chem_intralit$Klitcwmf
CWM_NP_chem_intralit$Mgcwmint<-CWM_NP_chem_intralit$Mglitcwm-CWM_NP_chem_intralit$Mglitcwmf

CWM_NP_chem_intralit$Ncwmintpre<-CWM_NP_chem_intralit$Nlitprecwm-CWM_NP_chem_intralit$Nlitprecwmf
CWM_NP_chem_intralit$Pcwmintpre<-CWM_NP_chem_intralit$Plitprecwm-CWM_NP_chem_intralit$Plitprecwmf
CWM_NP_chem_intralit$Cacwmintpre<-CWM_NP_chem_intralit$Calitprecwm-CWM_NP_chem_intralit$Calitprecwmf
CWM_NP_chem_intralit$Kcwmintpre<-CWM_NP_chem_intralit$Klitprecwm-CWM_NP_chem_intralit$Klitprecwmf
CWM_NP_chem_intralit$Mgcwmintpre<-CWM_NP_chem_intralit$Mglitprecwm-CWM_NP_chem_intralit$Mglitprecwmf


CWM_NP_chem_intralitmid<-merge(CWM_NP_chemlit_modelmid, CWM_NP_chemlit_modelmidf)
CWM_NP_chem_intralitmid$Ncwmint<-CWM_NP_chem_intralitmid$Nlitmidcwm-CWM_NP_chem_intralitmid$Nlitcwmmidf
CWM_NP_chem_intralitmid$Pcwmint<-CWM_NP_chem_intralitmid$Plitmidcwm-CWM_NP_chem_intralitmid$Plitcwmmidf
CWM_NP_chem_intralitmid$Cacwmint<-CWM_NP_chem_intralitmid$Calitmidcwm-CWM_NP_chem_intralitmid$Calitcwmmidf
CWM_NP_chem_intralitmid$Kcwmint<-CWM_NP_chem_intralitmid$Klitmidcwm-CWM_NP_chem_intralitmid$Klitcwmmidf
CWM_NP_chem_intralitmid$Mgcwmint<-CWM_NP_chem_intralitmid$Mglitmidcwm-CWM_NP_chem_intralitmid$Mglitcwmmidf

CWM_NP_chem_intralitmid$Ncwmintpre<-CWM_NP_chem_intralitmid$Nlitprecwm-CWM_NP_chem_intralitmid$Nlitprecwmf
CWM_NP_chem_intralitmid$Pcwmintpre<-CWM_NP_chem_intralitmid$Plitprecwm-CWM_NP_chem_intralitmid$Plitprecwmf
CWM_NP_chem_intralitmid$Cacwmintpre<-CWM_NP_chem_intralitmid$Calitprecwm-CWM_NP_chem_intralitmid$Calitprecwmf
CWM_NP_chem_intralitmid$Kcwmintpre<-CWM_NP_chem_intralitmid$Klitprecwm-CWM_NP_chem_intralitmid$Klitprecwmf
CWM_NP_chem_intralitmid$Mgcwmintpre<-CWM_NP_chem_intralitmid$Mglitprecwm-CWM_NP_chem_intralitmid$Mglitprecwmf

```

Make Models:
```{r}
CWM_NP_chem_intralit$logNcwmint<-log(CWM_NP_chem_intralit$Ncwmint)
str(CWM_NP_chem_intralit)
CWM_NP_chem_intralitmid$Ntrt<-as.factor(CWM_NP_chem_intralitmid$Ntrt)
CWM_NP_chem_intralitmid$Ptrt<-as.factor(CWM_NP_chem_intralitmid$Ptrt)

#N
CWM_Nmintlit<-lmer(Ncwmint~Ntrt*Ptrt+Age+Ncwmintpre +Site+(1|Stand),data=CWM_NP_chem_intralit)
plot(CWM_Nmintlit)
hist(resid(CWM_Nmintlit))
shapiro.test(resid(CWM_Nmintlit))
fixef(CWM_Nmintlit)
se.fixef(CWM_Nmintlit)
anova(CWM_Nmintlit, type=3)
difflsmeans(CWM_Nmintlit, specs=~Ntrt)
plot(allEffects(CWM_Nmintlit))

#Nmid
CWM_Nmintlitmid<-lmer(Ncwmint~Ntrt*Ptrt+Age+Ncwmintpre +Site+(1|Stand),data=CWM_NP_chem_intralitmid)
plot(CWM_Nmintlitmid)
hist(resid(CWM_Nmintlitmid))
shapiro.test(resid(CWM_Nmintlitmid))
fixef(CWM_Nmintlitmid)
se.fixef(CWM_Nmintlitmid)
anova(CWM_Nmintlitmid, type=3)
plot(allEffects(CWM_Nmintlitmid))
difflsmeans(CWM_Nmintlitmid, specs=~Ntrt)

#P:
CWM_Pmintlit<-lmer(Pcwmint~Ntrt*Ptrt+Age+Pcwmintpre+ Site+(1|Stand),data=CWM_NP_chem_intralit)
plot(CWM_Pmintlit)
hist(resid(CWM_Pmintlit))
shapiro.test(resid(CWM_Pmintlit))
fixef(CWM_Pmintlit)
se.fixef(CWM_Pmintlit)
anova(CWM_Pmintlit, type=3)
ranef(CWM_Pmintlit)
difflsmeans(CWM_Pmintlit, specs=~Ntrt:Ptrt)
plot(allEffects(CWM_Pmintlit))

#P mid
CWM_NP_chem_intralitmid$logPcwmint<-log(CWM_NP_chem_intralitmid$Pcwmint)

CWM_Pmintlitmid<-lmer(Pcwmint~Ntrt*Ptrt+Age+Pcwmintpre+(1|Stand),data=CWM_NP_chem_intralitmid)
plot(CWM_Pmintlitmid)
hist(resid(CWM_Pmintlitmid))
shapiro.test(resid(CWM_Pmintlitmid))
fixef(CWM_Pmintlitmid)
se.fixef(CWM_Pmintlitmid)
anova(CWM_Pmintlitmid, type=3)
ranef(CWM_Pmintlitmid)
difflsmeans(CWM_Pmintlitmid, specs=~Ntrt:Ptrt)
plot(allEffects(CWM_Pmintlitmid))

#Ca
CWM_Camintlit<-lmer(Cacwmint~Ntrt*Ptrt+Age+Cacwmintpre+(1|Stand),data=CWM_NP_chem_intralit)
plot(CWM_Camintlit)
hist(resid(CWM_Camintlit))
shapiro.test(resid(CWM_Camintlit))
CWM_Camintlit
fixef(CWM_Camintlit)
se.fixef(CWM_Camintlit)
anova(CWM_Camintlit, type=3)
difflsmeans(CWM_Camintlit, specs=~Ntrt:Ptrt)
plot(allEffects(CWM_Camintlit))

#Ca mid
CWM_Camintlitmid<-lmer(Cacwmint~Ntrt*Ptrt+Age+Cacwmintpre+Site+(1|Stand),data=CWM_NP_chem_intralitmid)
plot(CWM_Camintlitmid)
hist(resid(CWM_Camintlitmid))
shapiro.test(resid(CWM_Camintlitmid))
CWM_Camintlitmid
fixef(CWM_Camintlitmid)
se.fixef(CWM_Camintlitmid)
anova(CWM_Camintlitmid, type=3)
contrast(lsmeans(CWM_Camintlitmid, specs=~Site))
plot(allEffects(CWM_Camintlitmid))
difflsmeans(CWM_Camintlitmid, specs=~Ntrt:Ptrt)

#K
CWM_Kmintlit<-lmer(Kcwmint~Ntrt*Ptrt+Age+Kcwmintpre+(1|Stand),data=CWM_NP_chem_intralit)
plot(CWM_Kmintlit)
hist(resid(CWM_Kmintlit))
shapiro.test(resid(CWM_Kmintlit))
CWM_Kmintlit
fixef(CWM_Kmintlit)
se.fixef(CWM_Kmintlit)
anova(CWM_Kmintlit, type=3)
contrast(lsmeans(CWM_Kmintlit, specs=~Ptrt))
plot(allEffects(CWM_Kmintlit))

#K 2014-16
CWM_Kmintlitmid<-lmer(Kcwmint~Ntrt*Ptrt+Age+Kcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intralitmid)
plot(CWM_Kmintlitmid)
hist(resid(CWM_Kmintlitmid))
shapiro.test(resid(CWM_Kmintlitmid))
CWM_Kmintlitmid
fixef(CWM_Kmintlitmid)
se.fixef(CWM_Kmintlitmid)
anova(CWM_Kmintlitmid, type=3)
difflsmeans(CWM_Kmintlitmid, specs=~Ntrt:Ptrt)
contrast(lsmeans(CWM_Kmintlitmid, specs=~Site))
resid(CWM_Kmintlitmid)

#K 2014-16
CWM_NP_chem_intralitmid_noHBM<-subset(CWM_NP_chem_intralitmid, Stand !="HBM")
CWM_Kmintlitmid2<-lmer(Kcwmint~Ntrt*Ptrt+Age+Kcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intralitmid_noHBM)
plot(CWM_Kmintlitmid2)
hist(resid(CWM_Kmintlitmid2))
shapiro.test(resid(CWM_Kmintlitmid2))
CWM_Kmintlitmid2
fixef(CWM_Kmintlitmid2)
se.fixef(CWM_Kmintlitmid2)
anova(CWM_Kmintlitmid2, type=3)
plot(allEffects(CWM_Kmintlitmid2))

#Mg
CWM_Mgmintlit<-lmer(Mgcwmint~Ntrt*Ptrt+Age+Mgcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intralit)
plot(CWM_Mgmintlit)
hist(resid(CWM_Mgmintlit))
shapiro.test(resid(CWM_Mgmintlit))
CWM_Mgmintlit
fixef(CWM_Mgmintlit)
se.fixef(CWM_Mgmintlit)
anova(CWM_Mgmintlit, type=3)
difflsmeans(CWM_Mgmintlit, specs=~Ntrt)
plot(allEffects(CWM_Mgmintlit))

#Mg 2014-16
CWM_Mgmintlitmid<-lmer(Mgcwmint~Ntrt*Ptrt+Age+Mgcwmintpre+Site+(1|Stand),data=CWM_NP_chem_intralitmid)
plot(CWM_Mgmintlitmid)
hist(resid(CWM_Mgmintlitmid))
shapiro.test(resid(CWM_Mgmintlitmid))
CWM_Mgmintlitmid
fixef(CWM_Mgmintlitmid)
se.fixef(CWM_Mgmintlitmid)
anova(CWM_Mgmintlitmid, type=3)
difflsmeans(CWM_Mgmintlitmid, specs=~Ntrt:Ptrt)
plot(allEffects(CWM_Mgmintlitmid))
```


RESORPTION

Merge foliage and litter
```{r}
fol_lit<-merge(NP_fol_2122mean, litNP, by = c("Site","Stand","Treatment","Species","Ntrt","Ptrt"))
fol_lit$Age<-fol_lit$Age.y

fol_lit$NRE<- (1-fol_lit$N.y/fol_lit$N.x*0.784)*100
fol_lit$PRE<- (1-fol_lit$P.y/fol_lit$P.x*0.784)*100
fol_lit$KRE<- (1-fol_lit$K.y/fol_lit$K.x*0.784)*100
```

Graph Litter vs Green
```{r}
fol_lit%>% ggplot(aes(x= N.x, y = N.y, col = Treatment, shape = Species))+
geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.5, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.6)+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.4)+
      geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
   geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.3, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.7, linetype="dotted")+  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Foliar N")+
  ylab("Litter N")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```


Calculate resorption efficiency using 2008-10 and 2009-10 data
```{r}
NP_fol_lit_0810<-merge(NP_fol_0810mean, pretreat0910litmeani)

NP_fol_lit_0810$NREpre<- (1-NP_fol_lit_0810$Nlitpre/NP_fol_lit_0810$Npre*0.784)*100
NP_fol_lit_0810$PREpre<- (1-NP_fol_lit_0810$Plitpre/NP_fol_lit_0810$Ppre*0.784)*100
NP_fol_lit_0810$KREpre<- (1-NP_fol_lit_0810$Klitpre/NP_fol_lit_0810$Kpre*0.784)*100

NP_fol_lit_0810_res<-NP_fol_lit_0810[,c(1:4,22:24)]

fol_lit_res<-merge(fol_lit,NP_fol_lit_0810_res)
```

Species-Specific Models of Resorption Efficiency: Beech - update with pre-treatment values
```{r}
#fol_lit_res$logPRE<-log(fol_lit_res$PRE)
fol_litBE<-subset(fol_lit_res, Species == "BE")
fol_litBE<-subset(fol_litBE, Stand != "JBM")

#P: singular, not normal, fix
BE_Pres<-lmer(PRE~Ntrt*Ptrt+Age +PREpre+Site+(1|Stand),data=fol_litBE)
plot(BE_Pres)
hist(resid(BE_Pres))
shapiro.test(resid(BE_Pres))
anova(BE_Pres, type=3)
plot(allEffects(BE_Pres))
fixef(BE_Pres)
se.fixef(BE_Pres)

resid(BE_Pres)
#Try without C2
fol_litBE_noC2<-subset(fol_litBE, Stand !="C2")

BE_Pres2<-lmer(PRE~Ntrt*Ptrt+Age +PREpre+Site+(1|Stand),data=fol_litBE_noC2)
plot(BE_Pres2)
hist(resid(BE_Pres2))
shapiro.test(resid(BE_Pres2))
anova(BE_Pres2, type=3)
plot(allEffects(BE_Pres2))
fixef(BE_Pres2)
se.fixef(BE_Pres2)

BE_Nres<-lmer(NRE~Ntrt*Ptrt+Age +NREpre+ Site+(1|Stand),data=fol_litBE)
plot(BE_Nres)
hist(resid(BE_Nres))
shapiro.test(resid(BE_Nres))
anova(BE_Nres, type=3)
plot(allEffects(BE_Nres))
fixef(BE_Nres)
se.fixef(BE_Nres)

plot<-ggplot(fol_litBE,aes(x=Stand, y = PRE, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("P Resorption Efficiency")+
  theme_bw(base_size=16)
print(plot)

fol_litBE%>% ggplot(aes(x= P.x, y = P.y, col = Treatment, shape = Species))+
geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.5, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.6)+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.4)+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
   geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.3, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.7, linetype="dotted")+  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Foliar K")+
  ylab("Litter K")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```

Species-Specific Models of Resorption Efficiency: Sugar Maple
```{r}
fol_litSM<-subset(fol_lit_res, Species == "SM")

#Normality
SM_Pres<-lmer(PRE~Ntrt*Ptrt+Age + PREpre+(1|Stand),data=fol_litSM)
plot(SM_Pres)
hist(resid(SM_Pres))
shapiro.test(resid(SM_Pres))
anova(SM_Pres, type=3)
fixef(SM_Pres)
se.fixef(SM_Pres)
plot(allEffects(SM_Pres))

#Normality issues
SM_Nres<-lmer(NRE~Ntrt*Ptrt+Age + NREpre+(1|Stand),data=fol_litSM)
plot(SM_Nres)
hist(resid(SM_Nres))
shapiro.test(resid(SM_Nres))
anova(SM_Nres, type=3)
fixef(SM_Nres)
se.fixef(SM_Nres)
plot(allEffects(SM_Nres))

#Try with no C9
fol_litSM_noC9<-subset(fol_litSM, Stand !="C9")
SM_Nres2<-lmer(NRE~Ntrt*Ptrt+Age + NREpre+(1|Stand),data=fol_litSM_noC9)
plot(SM_Nres2)
hist(resid(SM_Nres2))
shapiro.test(resid(SM_Nres2))
anova(SM_Nres2, type=3)
fixef(SM_Nres2)
se.fixef(SM_Nres2)
plot(allEffects(SM_Nres2))

plot<-ggplot(fol_litSM,aes(x=Stand, y = PRE, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("P Resorption Efficiency")+
  theme_bw(base_size=16)
print(plot)

fol_litSM%>% ggplot(aes(x= P.x, y = P.y, col = Treatment, shape = Species))+
geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.5, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.6)+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.4)+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
   geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.3, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.7, linetype="dotted")+  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Foliar P")+
  ylab("Litter P")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```

Species-Specific Models of Resorption Efficiency: Yellow Birch
```{r}
fol_litYB<-subset(fol_lit_res, Species == "YB")

YB_Pres<-lmer(PRE~Ntrt*Ptrt+Age+PREpre +Site+ (1|Stand),data=fol_litYB)
plot(YB_Pres)
hist(resid(YB_Pres))
shapiro.test(resid(YB_Pres))
anova(YB_Pres, type=3)
plot(allEffects(YB_Pres))
fixef(YB_Pres)
se.fixef(YB_Pres)

#normality
fol_litYB$logNRE<-log(fol_litYB$NRE)

YB_Nres<-lmer(NRE~Ntrt*Ptrt+Age+NREpre +Site+ (1|Stand),data=fol_litYB)
plot(YB_Nres)
hist(resid(YB_Nres))
shapiro.test(resid(YB_Nres))
anova(YB_Nres, type=3)
plot(allEffects(YB_Nres))
fixef(YB_Nres)
se.fixef(YB_Nres)

fol_litYB_noC1<-subset(fol_litYB, Stand !="C1")
YB_Nres2<-lmer(NRE~Ntrt*Ptrt+Age+NREpre +Site+ (1|Stand),data=fol_litYB_noC1)
plot(YB_Nres2)
hist(resid(YB_Nres2))
shapiro.test(resid(YB_Nres2))
anova(YB_Nres2, type=3)
plot(allEffects(YB_Nres2))
fixef(YB_Nres2)
se.fixef(YB_Nres2)


fol_litYB%>% ggplot(aes(x= K.x, y = K.y, col = Treatment, shape = Species))+
geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.5, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.6)+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.4)+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
   geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.3, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.7, linetype="dotted")+  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Foliar K")+
  ylab("Litter K")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```

Species-Specific Models of Resorption Efficiency: White Birch
```{r}
fol_litWB<-subset(fol_lit_res, Species == "WB")

WB_Pres<-lmer(PRE~Ntrt*Ptrt+PREpre  +Site+ (1|Stand),data=fol_litWB)
plot(WB_Pres)
hist(resid(WB_Pres))
shapiro.test(resid(WB_Pres))
anova(WB_Pres, type=3)
plot(allEffects(WB_Pres))
fixef(WB_Pres)
se.fixef(WB_Pres)

WB_Nres<-lmer(NRE~Ntrt*Ptrt+NREpre +Site+(1|Stand),data=fol_litWB)
plot(WB_Nres)
hist(resid(WB_Nres))
shapiro.test(resid(WB_Nres))
anova(WB_Nres, type=3)
plot(allEffects(WB_Nres))
fixef(WB_Nres)
se.fixef(WB_Nres)

plot<-ggplot(fol_litWB,aes(x=Stand, y = PRE, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("P Resorption Efficiency")+
  theme_bw(base_size=16)
print(plot)

fol_litWB%>% ggplot(aes(x= P.x, y = P.y, col = Treatment, shape = Species))+
geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.5, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.6)+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.4)+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
   geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.3, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.7, linetype="dotted")+  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Foliar P")+
  ylab("Litter P")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```

Species-Specific Models of Resorption Efficiency: Red Maple
```{r}
fol_litRM<-subset(fol_lit_res, Species == "RM")

plot<-ggplot(fol_litRM,aes(x=Stand, y = NRE, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("K Resorption Efficiency")+
  theme_bw(base_size=16)
print(plot)

fol_litRM%>% ggplot(aes(x= P.x, y = P.y, col = Treatment, shape = Species))+
geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.5, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.6)+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.4)+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
   geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.3, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.7, linetype="dotted")+  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Foliar P")+
  ylab("Litter P")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```

Species-Specific Models of Resorption Efficiency: Pin Cherry
```{r}
fol_litPC<-subset(fol_lit_res, Species == "PC")

plot<-ggplot(fol_litPC,aes(x=Stand, y = PRE, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("P Resorption Efficiency")+
  theme_bw(base_size=16)
print(plot)

fol_litPC%>% ggplot(aes(x= P.x, y = P.y, col = Treatment, shape = Species))+
geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.5, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.6)+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.4)+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
   geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.3, linetype="dotted")+
  geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 0.7, linetype="dotted")+  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Foliar P")+
  ylab("Litter P")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```

CWM
2014-16 resorption file
```{r}
fol_litmid<-merge(NP_fol_1416mean, midlitmeansNPi2, by = c("Site","Stand","Treatment","Species"))
fol_litmid<-subset(fol_litmid, Plot !="5")

fol_litmid$NRE<- (1-fol_litmid$Nmid/fol_litmid$N*0.784)*100
fol_litmid$PRE<- (1-fol_litmid$Pmid/fol_litmid$P*0.784)*100
fol_litmid$KRE<- (1-fol_litmid$Kmid/fol_litmid$K*0.784)*100

```

Species 2014-16 
```{r}
fol_lit_res1416<-merge(fol_litmid,NP_fol_lit_0810_res)
fol_lit_res1416$Age<-ifelse(fol_lit_res1416$Stand=="C1"|fol_lit_res1416$Stand=="C2"|fol_lit_res1416$Stand=="C4"|fol_lit_res1416$Stand=="C6"|fol_lit_res1416$Stand=="HBM"|fol_lit_res1416$Stand=="JBM", "Mid", "Mature")
```

Species-Specific Models of Resorption Efficiency: 
Beech - 2014-16
```{r}
fol_litBE1416<-subset(fol_lit_res1416, Species == "BE")
fol_litBE1416<-subset(fol_litBE1416, Stand != "JBM")

#P: singular, not normal, fix
fol_litBE1416$logPRE<-log(fol_litBE1416$PRE)
BE_Pres1416<-lmer(PRE~Ntrt*Ptrt+Age +PREpre+Site+(1|Stand),data=fol_litBE1416)
plot(BE_Pres1416)
hist(resid(BE_Pres1416))
shapiro.test(resid(BE_Pres1416))
anova(BE_Pres1416, BE_Pres1416)
plot(allEffects(BE_Pres1416))
ranef(BE_Pres1416)

resid(BE_Pres1416)
#Try without C2
fol_litBE1416_noC2<-subset(fol_litBE1416, Stand !="C2")

BE_Pres21416<-lmer(PRE~Ntrt*Ptrt+Age +PREpre+Site+(1|Stand),data=fol_litBE1416_noC2)
plot(BE_Pres21416)
hist(resid(BE_Pres21416))
shapiro.test(resid(BE_Pres21416))
anova(BE_Pres21416, type=3)
plot(allEffects(BE_Pres21416))

BE_Nres1416<-lmer(NRE~Ntrt*Ptrt+Age +NREpre+ Site+(1|Stand),data=fol_litBE1416)
plot(BE_Nres1416)
hist(resid(BE_Nres1416))
shapiro.test(resid(BE_Nres1416))
anova(BE_Nres1416, type=3)
plot(allEffects(BE_Nres1416))
fixef(BE_Nres1416)
se.fixef(BE_Nres1416)
```

Species-Specific Models of Resorption Efficiency: Sugar Maple
```{r}
fol_litSM1416<-subset(fol_lit_res1416, Species == "SM")

#Normality
SM_Pres1416<-lmer(PRE~Ntrt*Ptrt + PREpre+Site+(1|Stand),data=fol_litSM1416)
plot(SM_Pres1416)
hist(resid(SM_Pres1416))
shapiro.test(resid(SM_Pres1416))
anova(SM_Pres1416, type=3)
plot(allEffects(SM_Pres1416))

#Normality issues
SM_Nres1416<-lmer(NRE~Ntrt*Ptrt + NREpre+Site+(1|Stand),data=fol_litSM1416)
plot(SM_Nres1416)
hist(resid(SM_Nres1416))
shapiro.test(resid(SM_Nres1416))
anova(SM_Nres1416, type=3)
plot(allEffects(SM_Nres1416))
```

Species-Specific Models of Resorption Efficiency: Yellow Birch
```{r}
fol_litYB1416<-subset(fol_lit_res1416, Species == "YB")

fol_litYB1416$logPRE<-log(fol_litYB1416$PRE)
YB_Pres1416<-lmer(PRE~Ntrt*Ptrt+Age+PREpre + (1|Stand),data=fol_litYB1416)
plot(YB_Pres1416)
hist(resid(YB_Pres1416))
shapiro.test(resid(YB_Pres1416))
anova(YB_Pres1416, type=3)
plot(allEffects(YB_Pres1416))
resid(YB_Pres1416)

fol_litYB1416noC2<-subset(fol_litYB1416, Stand !="C2")
YB_Pres1416noC2<-lmer(PRE~Ntrt*Ptrt+Age+PREpre + (1|Stand),data=fol_litYB1416noC2)
plot(YB_Pres1416noC2)
hist(resid(YB_Pres1416noC2))
shapiro.test(resid(YB_Pres1416noC2))
anova(YB_Pres1416noC2, type=3)
plot(allEffects(YB_Pres1416noC2))
resid(YB_Pres1416noC2)

#normality
fol_litYB$logNRE<-log(fol_litYB$NRE)

YB_Nres1416<-lmer(NRE~Ntrt*Ptrt+Age+NREpre +Site+ (1|Stand),data=fol_litYB1416)
plot(YB_Nres1416)
hist(resid(YB_Nres1416))
shapiro.test(resid(YB_Nres1416))
anova(YB_Nres1416, type=3)
plot(allEffects(YB_Nres1416))
```

Species-Specific Models of Resorption Efficiency: White  Birch
```{r}
fol_litWB1416<-subset(fol_lit_res1416, Species == "WB")

fol_litWB1416$Site<-as.factor(fol_litWB1416$Site)
fol_litWB1416$Ntrt<-as.factor(fol_litWB1416$Ntrt)
fol_litWB1416$Ptrt<-as.factor(fol_litWB1416$Ptrt)

WB_Pres1416<-lmer(PRE~Ntrt*Ptrt+PREpre  +Site+ (1|Stand),data=fol_litWB1416)
plot(WB_Pres1416)
hist(resid(WB_Pres1416))
shapiro.test(resid(WB_Pres1416))
anova(WB_Pres1416, type=3)
plot(allEffects(WB_Pres1416))
difflsmeans(WB_Pres1416)

WB_Nres1416<-lmer(NRE~Ntrt*Ptrt+NREpre +Site+(1|Stand),data=fol_litWB1416)
plot(WB_Nres1416)
hist(resid(WB_Nres1416))
shapiro.test(resid(WB_Nres1416))
anova(WB_Nres1416, type=3)
plot(allEffects(WB_Nres1416))
```

```{r}
fol_litPC1416<-subset(fol_lit_res1416, Species == "PC")

fol_litRM1416<-subset(fol_lit_res1416, Species == "RM")

plot<-ggplot(fol_litRM,aes(x=Stand, y = NRE, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("P Resorption Efficiency")+
  theme_bw(base_size=16)
print(plot)
```

CWM Resorption
```{r}
#Merge with different datasets
CWM_NP_reseff_species_2022<-merge(plot_sumba, fol_lit_res)
CWM_reseff_species_2015<-merge(plot_sumba,fol_litmid)
CWM_reseff_species_pre<-merge(plot_sumba,NP_fol_lit_0810_res)
CWM_NP_reseff_species_pre<-subset(CWM_reseff_species_pre, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")

#Calculate total basal area given the species sampled
total_sumba_2022res<-ddply(CWM_NP_reseff_species_2022,.(Site, Age, Stand, Plot,Treatment), summarize,
        BA2019tot = sum(BA2019m2sum, na.rm=T))
total_sumba_2015res<-ddply(CWM_reseff_species_2015,.(Site, Age, Stand, Plot,Treatment), summarize,
       BA2015tot = sum(BA2015m2sum, na.rm=T))
total_sumba_preres<-ddply(CWM_NP_reseff_species_pre,.(Site, Age, Stand, Plot,Treatment), summarize,
        BA2011tot = sum(BA2011m2sum, na.rm=T))

#Calculate proportion of basal area per species given the species sampled
CWM_NP_reseff_species_2022_ba<-full_join(total_sumba_2022res, CWM_NP_reseff_species_2022)
CWM_NP_reseff_species_2022_ba$prop2019<-CWM_NP_reseff_species_2022_ba$BA2019m2sum/CWM_NP_reseff_species_2022_ba$BA2019tot

CWM_NP_reseff_species_2015_ba<-full_join(total_sumba_2015res, CWM_reseff_species_2015)
CWM_NP_reseff_species_2015_ba<-subset(CWM_NP_reseff_species_2015_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_reseff_species_2015_ba<-subset(CWM_NP_reseff_species_2015_ba, Plot !="7")
CWM_NP_reseff_species_2015_ba$prop2015<-CWM_NP_reseff_species_2015_ba$BA2015m2sum/CWM_NP_reseff_species_2015_ba$BA2015tot

CWM_NP_reseff_species_pre_ba<-full_join(total_sumba_preres, CWM_NP_reseff_species_pre)
CWM_NP_reseff_species_pre_ba<-subset(CWM_NP_reseff_species_pre_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_reseff_species_pre_ba$prop2011<-CWM_NP_reseff_species_pre_ba$BA2011m2sum/CWM_NP_reseff_species_pre_ba$BA2011tot

#Check to make sure proportions add up to 1
propcheck_2022res<-ddply(CWM_NP_reseff_species_2022_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2019, na.rm=T))
propcheck_2015<-ddply(CWM_NP_reseff_species_2015_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2015, na.rm=T))
propcheck_prers<-ddply(CWM_NP_reseff_species_pre_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2011, na.rm=T))
```

Calculate CWM:
```{r}
#2022
CWM_NP_reseff<-ddply(CWM_NP_reseff_species_2022_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
     NREcwm= sum(NRE*prop2019, na.rm=T),
     PREcwm = sum(PRE*prop2019, na.rm=T))

CWM_NP_reseff_mid<-ddply(CWM_NP_reseff_species_2015_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
    NREcwm= sum(NRE*prop2015, na.rm=T),
   PREcwm = sum(PRE*prop2015, na.rm=T))

CWM_NP_reseff_pre<-ddply(CWM_NP_reseff_species_pre_ba, c("Site","Stand","Plot"),summarize,
     NREprecwm= sum(NREpre*prop2011, na.rm=T),
     PREprecwm = sum(PREpre*prop2011, na.rm=T))

CWM_NP_reseff$Sampling<-"Second"

CWM_NP_reseff_model<-merge(CWM_NP_reseff_pre, CWM_NP_reseff)
CWM_NP_reseff_model$Age<-ifelse(CWM_NP_reseff_model$Stand=="C8"|CWM_NP_reseff_model$Stand=="C9"|CWM_NP_reseff_model$Stand=="HBO"|CWM_NP_reseff_model$Stand=="JBO","Mature","Mid")

CWM_NP_reseff_modelmid<-merge(CWM_NP_reseff_pre, CWM_NP_reseff_mid)
CWM_NP_reseff_modelmid$Age<-ifelse(CWM_NP_reseff_modelmid$Stand=="C8"|CWM_NP_reseff_modelmid$Stand=="C9"|CWM_NP_reseff_modelmid$Stand=="HBO"|CWM_NP_reseff_modelmid$Stand=="JBO","Mature","Mid")

CWM_NP_reseff_modelmid$Ntrt<-as.factor(CWM_NP_reseff_modelmid$Ntrt)
CWM_NP_reseff_modelmid$Ptrt<-as.factor(CWM_NP_reseff_modelmid$Ptrt)
```

Models:
```{r}
#N
CWM_NRE<-lmer(NREcwm~Ntrt*Ptrt+Age + NREprecwm+ Site+(1|Stand),data=CWM_NP_reseff_model)
plot(CWM_NRE)
fixef(CWM_NRE)
se.fixef(CWM_NRE)
hist(resid(CWM_NRE))
shapiro.test(resid(CWM_NRE))
anova(CWM_NRE, type=3)
difflsmeans(CWM_NRE, specs=~Ntrt:Ptrt)

#N, no C9
CWM_NP_reseff_modelnoC9<-subset(CWM_NP_reseff_model, Stand !="C9")
CWM_NRE2<-lmer(NREcwm~Ntrt*Ptrt+Age + NREprecwm+ Site+(1|Stand),data=CWM_NP_reseff_modelnoC9)
plot(CWM_NRE2)
fixef(CWM_NRE2)
se.fixef(CWM_NRE2)
hist(resid(CWM_NRE2))
shapiro.test(resid(CWM_NRE2))
anova(CWM_NRE2, type=3)
difflsmeans(CWM_NRE2, specs=~Ntrt:Ptrt)
plot(allEffects(CWM_NRE2))

summary(lmerTest::lmer(NREcwm~Ntrt*Ptrt+Age + NREprecwm+ Site+(1|Stand),CWM_NP_reseff_modelnoC9))$coefficients

#N, no C9 and JBM
CWM_NP_reseff_modelnoC9JBM<-subset(CWM_NP_reseff_modelnoC9, Stand !="JBM")
CWM_NRE3<-lmer(NREcwm~Ntrt*Ptrt+Age + NREprecwm+ Site+(1|Stand),data=CWM_NP_reseff_modelnoC9JBM)
plot(CWM_NRE3)
fixef(CWM_NRE3)
se.fixef(CWM_NRE3)
hist(resid(CWM_NRE3))
shapiro.test(resid(CWM_NRE3))
anova(CWM_NRE3, type=3)

ls_means(CWM_NRE)

#N 2014-16
CWM_NREmid<-lmer(NREcwm~Ntrt*Ptrt+Age + NREprecwm+ Site+(1|Stand),data=CWM_NP_reseff_modelmid)
plot(CWM_NREmid)
fixef(CWM_NREmid)
se.fixef(CWM_NREmid)
hist(resid(CWM_NREmid))
shapiro.test(resid(CWM_NREmid))
anova(CWM_NREmid, type=3)
difflsmeans(CWM_NREmid, specs=~Ntrt:Ptrt)

#PRE
CWM_PRE<-lmer(PREcwm~Ntrt*Ptrt+Age + PREprecwm+Site+(1|Stand),data=CWM_NP_reseff_model)
plot(CWM_PRE)
fixef(CWM_PRE)
se.coef(CWM_PRE)
#exp(coef(CWM_PRE))
se.fixef(CWM_PRE)
hist(resid(CWM_PRE))
shapiro.test(resid(CWM_PRE))
anova(CWM_PRE, type=3)
summary(CWM_PRE)
confint(CWM_PRE, method = "Wald")
difflsmeans(CWM_PRE, specs=~Ntrt:Ptrt)
plot(allEffects(CWM_PRE))

#P with no C2
CWM_NP_reseff_modelnoC2<-subset(CWM_NP_reseff_model, Stand !="C2")
CWM_PRE2<-lmer(PREcwm~Ntrt*Ptrt+Age + PREprecwm+Site+(1|Stand),data=CWM_NP_reseff_modelnoC2)
plot(CWM_PRE2)
fixef(CWM_PRE2)
se.fixef(CWM_PRE2)
hist(resid(CWM_PRE2))
shapiro.test(resid(CWM_PRE2))
anova(CWM_PRE2, type=3)
plot(allEffects(CWM_PRE2))
summary(CWM_PRE2)
difflsmeans(CWM_PRE2, specs=~Ntrt:Ptrt)
plot(allEffects(CWM_PRE2))

#PRE 2014-16
str(CWM_NP_reseff_modelmid)
CWM_PREmid<-lmer(PREcwm~Ntrt*Ptrt+Age + PREprecwm+Site+(1|Stand),data=CWM_NP_reseff_modelmid)
plot(CWM_PREmid)
fixef(CWM_PREmid)
se.fixef(CWM_PREmid)
hist(resid(CWM_PREmid))
shapiro.test(resid(CWM_PREmid))
anova(CWM_PREmid, type=3)
difflsmeans(CWM_PREmid, specs=~Ntrt:Ptrt)
plot(allEffects(CWM_PREmid))
plot(allEffects(CWM_PREmid))

plot<-ggplot(CWM_NP_reseff_modelnoC9JBM,aes(x=Stand, y = PREcwm, color=Treatment))+
  geom_point(size=3)+
     scale_color_manual(values =c("gray","blue","purple","red"))+
   ylab("Community-Weighted NRE")+
  theme_bw(base_size=16)
print(plot)
```

Graphs including mid information (pre vs. mid + now)
```{r}
#Create a file merging 2022 and 2015 data

CWM_NP_reseff_mid$Sampling = "2014-16"
CWM_NP_reseff$Sampling = "2021-22"

CWM_NP_reseff_graph<-full_join(CWM_NP_reseff, CWM_NP_reseff_mid)

CWM_NP_reseff_prepost_graph<-merge(CWM_NP_reseff_graph, CWM_NP_reseff_pre)
CWM_NP_reseff_prepost_graph$Treatment<-factor(CWM_NP_reseff_prepost_graph$Treatment, levels = c("Control","N","P","NP"), ordered=T)
CWM_NP_reseff_prepost_graph$Shape<-paste(CWM_NP_reseff_prepost_graph$Site, CWM_NP_reseff_prepost_graph$Sampling, sep="_")
```

Graphs:
```{r}
#NRE
NREcwm<-CWM_NP_reseff_prepost_graph%>% ggplot(aes(x= NREprecwm, y = NREcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(45,85.5))+
scale_x_continuous(expand=c(0,0), limits = c(45,74.5))+
    scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre NRE (%)")+
  ylab("Post NRE (%)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(NREcwm)

#PRE
PREcwm<-CWM_NP_reseff_prepost_graph%>% ggplot(aes(x= PREprecwm, y = PREcwm, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(-20,89))+
scale_x_continuous(expand=c(0,0), limits = c(30,89))+
      scale_color_manual(values = c("gray30", "blue", "red","purple"))+
  xlab("Pre PRE (%)")+
  ylab("Post PRE (%)")+
  theme_bw()+
   theme(legend.position="none")+
    theme(axis.text=element_text(size=12), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(PREcwm)

plot_grid(NREcwm, PREcwm, labels = "auto")

TreatmentLabel <- c(
                    `Control` = "Control",
                    `N` = "N",
                    `P` = "P",
                    `NP` = "N+P"
                    )

facetNRE<-NREcwm+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))
facetPRE<-PREcwm+facet_wrap(vars(Treatment), nrow=1, labeller=as_labeller(TreatmentLabel))

plot_grid(facetNRE, facetPRE, nrow=2)


```

CWM inter for resorption:
```{r}
NP_reseff_2122mean_fixed<-ddply(fol_lit_res, c("Species"), summarise,
      NREf= mean(NRE, na.rm=T),
      PREf = mean(PRE, na.rm=T))

NP_reseff_1416mean_fixed<-ddply(fol_litmid, c("Species"), summarise,
      NREmidf= mean(NRE, na.rm=T),
      PREmidf = mean(PRE, na.rm=T))

NP_reseff_pre_mean_fixed<-ddply(NP_fol_lit_0810_res, c("Species"), summarise,
      NREpref = mean(NREpre, na.rm=T),
      PREpref = mean(PREpre, na.rm=T))

CWM_NP_reseff_species_2022f<-merge(plot_sumba, NP_reseff_2122mean_fixed)
CWM_NP_reseff_species_2022f<-subset(CWM_NP_reseff_species_2022f, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_reseff_species_2022f<-subset(CWM_NP_reseff_species_2022f, Treatment !="Ca")
CWM_NP_reseff_species_2022f<-subset(CWM_NP_reseff_species_2022f, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_NP_reseff_species_2022f$ID<-paste(CWM_NP_reseff_species_2022f$Site,CWM_NP_reseff_species_2022f$Stand, CWM_NP_reseff_species_2022f$Plot, CWM_NP_reseff_species_2022f$Species, sep = "_")

CWM_NP_reseff_species_2022$ID<-paste(CWM_NP_reseff_species_2022$Site,CWM_NP_reseff_species_2022$Stand, CWM_NP_reseff_species_2022$Plot, CWM_NP_reseff_species_2022$Species, sep = "_")


CWM_NP_reseff_species_2022f_merge<-merge(CWM_NP_reseff_species_2022, CWM_NP_reseff_species_2022f, by = c("Site","Stand","Plot","Species","Age","ID","Treatment","BA2019m2sum","BA2015m2sum","BA2011m2sum"))

CWM_NP_reseff_species_2022f<-CWM_NP_reseff_species_2022f_merge[,c(1:13 ,60:61)]

CWM_NP_reseff_species_2015f<-merge(plot_sumba, NP_reseff_2122mean_fixed)
CWM_NP_reseff_species_2015f<-subset(CWM_NP_reseff_species_2015f, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_reseff_species_2015f<-subset(CWM_NP_reseff_species_2015f, Treatment !="Ca")
CWM_NP_reseff_species_2015f<-subset(CWM_NP_reseff_species_2015f, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_NP_reseff_species_2015f$ID<-paste(CWM_NP_reseff_species_2015f$Site,CWM_NP_reseff_species_2015f$Stand, CWM_NP_reseff_species_2015f$Plot, CWM_NP_reseff_species_2015f$Species, sep = "_")

CWM_reseff_species_2015$ID<-paste(CWM_reseff_species_2015$Site,CWM_reseff_species_2015$Stand, CWM_reseff_species_2015$Plot, CWM_reseff_species_2015$Species, sep = "_")


CWM_NP_reseff_species_2015f<-merge(CWM_reseff_species_2015, CWM_NP_reseff_species_2015f, by = c("Site","Stand","Plot","Species","Age","ID","Treatment","BA2019m2sum","BA2015m2sum","BA2011m2sum"))

CWM_reseff_species_pref<-merge(plot_sumba,NP_fol_lit_0810_res)
CWM_reseff_species_pref<-merge(CWM_reseff_species_pref, NP_reseff_pre_mean_fixed)
CWM_reseff_species_pref<-subset(CWM_reseff_species_pref, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_reseff_species_pref<-subset(CWM_reseff_species_pref, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")
CWM_reseff_species_pref$ID<-paste(CWM_reseff_species_pref$Site,CWM_reseff_species_pref$Stand, CWM_reseff_species_pref$Plot, CWM_reseff_species_pref$Species, sep = "_")
CWM_reseff_species_pre$ID<-paste(CWM_reseff_species_pre$Site,CWM_reseff_species_pre$Stand, CWM_reseff_species_pre$Plot, CWM_reseff_species_pre$Species, sep = "_")
CWM_NP_reseff_species_pref_merge<-merge(CWM_NP_reseff_species_pre, CWM_reseff_species_pref)
CWM_NP_reseff_species_pref<-CWM_NP_reseff_species_pref_merge[,c(1:9,11:14)]


#Calculate proportion of basal area per species given the species sampled
CWM_NP_reseff_species_2022f_ba<-full_join(total_sumba_2022res, CWM_NP_reseff_species_2022f)
CWM_NP_reseff_species_2022f_ba$prop2019<-CWM_NP_reseff_species_2022f_ba$BA2019m2sum/CWM_NP_reseff_species_2022f_ba$BA2019tot

CWM_NP_reseff_species_2015f_ba<-full_join(total_sumba_2015res, CWM_NP_reseff_species_2015f)
CWM_NP_reseff_species_2015f_ba$prop2015<-CWM_NP_reseff_species_2015f_ba$BA2015m2sum/CWM_NP_reseff_species_2015f_ba$BA2015tot

CWM_NP_reseff_species_pref_ba<-full_join(total_sumba_preres, CWM_NP_reseff_species_pref)
CWM_NP_reseff_species_pref_ba<-subset(CWM_NP_reseff_species_pref_ba, Stand =="C1"|Stand=="C2"|Stand=="C4"|Stand=="C6"|Stand=="C8"|Stand=="C9"|Stand=="HBM"|Stand=="HBO"|Stand=="JBM"|Stand=="JBO")
CWM_NP_reseff_species_pref_ba$prop2011<-CWM_NP_reseff_species_pref_ba$BA2011m2sum/CWM_NP_reseff_species_pref_ba$BA2011tot

#Check to make sure proportions add up to 1
propcheck_2022resf<-ddply(CWM_NP_reseff_species_2022f_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2019, na.rm=T))
propcheck_2015resf<-ddply(CWM_NP_reseff_species_2015f_ba,.(Site, Age, Stand, Plot,Treatment), summarize,
        Check = sum(prop2015, na.rm=T))
propcheck_preresf<-ddply(CWM_NP_reseff_species_pref_ba,.(Site, Age, Stand, Plot), summarize,
        Check = sum(prop2011, na.rm=T))
```

Calculate CWMinter:

Calculate CWM:
```{r}
#2022
CWM_NP_reseff_fixed<-ddply(CWM_NP_reseff_species_2022f_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
     NREcwmf= sum(NREf*prop2019, na.rm=T),
     PREcwmf = sum(PREf*prop2019, na.rm=T))

#2015
CWM_NP_reseff_fixedmid<-ddply(CWM_NP_reseff_species_2015f_ba, c("Site","Stand","Treatment","Plot","Ntrt","Ptrt"),summarize,
     NREcwmfmid= sum(NREf*prop2015, na.rm=T),
     PREcwmfmid = sum(PREf*prop2015, na.rm=T))

CWM_NP_reseff_pref<-ddply(CWM_NP_reseff_species_pref_ba, c("Site","Stand","Plot"),summarize,
     NREprecwmf= sum(NREpref*prop2011, na.rm=T),
     PREprecwmf = sum(PREpref*prop2011, na.rm=T))

CWM_NP_reseff_modelf<-merge(CWM_NP_reseff_pref, CWM_NP_reseff_fixed)
CWM_NP_reseff_modelf$Age<-ifelse(CWM_NP_reseff_modelf$Stand=="C8"|CWM_NP_reseff_modelf$Stand=="C9"|CWM_NP_reseff_modelf$Stand=="HBO"|CWM_NP_reseff_modelf$Stand=="JBO","Mature","Mid")

CWM_NP_reseff_modelmidf<-merge(CWM_NP_reseff_pref, CWM_NP_reseff_fixedmid)
CWM_NP_reseff_modelmidf$Age<-ifelse(CWM_NP_reseff_modelmidf$Stand=="C8"|CWM_NP_reseff_modelmidf$Stand=="C9"|CWM_NP_reseff_modelmidf$Stand=="HBO"|CWM_NP_reseff_modelmidf$Stand=="JBO","Mature","Mid")
```

CWM inter models for N, P, Ca
```{r}
#N
CWM_NREf<-lmer(NREcwmf~Ntrt*Ptrt+Age+NREprecwmf +Site+(1|Stand),data=CWM_NP_reseff_modelf)
plot(CWM_NREf)
hist(resid(CWM_NREf))
shapiro.test(resid(CWM_NREf))
fixef(CWM_NREf)
se.fixef(CWM_NREf)
anova(CWM_NREf, type=3)
plot(allEffects(CWM_NREf))

#N mid
CWM_NREfmid<-lmer(NREcwmfmid~Ntrt*Ptrt+Age+NREprecwmf +Site+(1|Stand),data=CWM_NP_reseff_modelmidf)
plot(CWM_NREfmid)
hist(resid(CWM_NREfmid))
shapiro.test(resid(CWM_NREfmid))
fixef(CWM_NREfmid)
se.fixef(CWM_NREfmid)
anova(CWM_NREfmid, type=3)
difflsmeans(CWM_NREfmid, specs=~pairwise~Ntrt:Ptrt)
plot(allEffects(CWM_NREfmid))

#P
CWM_PREf<-lmer(PREcwmf~Ntrt*Ptrt+Age+PREprecwmf +Site+(1|Stand),data=CWM_NP_reseff_modelf)
plot(CWM_PREf)
hist(resid(CWM_PREf))
shapiro.test(resid(CWM_PREf))
fixef(CWM_PREf)
se.fixef(CWM_PREf)
anova(CWM_PREf, type=3)
lsmeans(CWM_PREf, specs=~Site)
plot(allEffects(CWM_PREf))

str(CWM_NP_reseff_modelmidf)

CWM_NP_reseff_modelmidf$Ntrt<-as.factor(CWM_NP_reseff_modelmidf$Ntrt)
CWM_NP_reseff_modelmidf$Ptrt<-as.factor(CWM_NP_reseff_modelmidf$Ptrt)
CWM_NP_reseff_modelmidf$Site<-as.factor(CWM_NP_reseff_modelmidf$Site)

#P mid
CWM_PREfmid<-lmer(PREcwmfmid~Ntrt*Ptrt+Age+PREprecwmf +Site+(1|Stand),data=CWM_NP_reseff_modelmidf)
plot(CWM_PREfmid)
hist(resid(CWM_PREfmid))
shapiro.test(resid(CWM_PREfmid))
fixef(CWM_PREfmid)
se.fixef(CWM_PREfmid)
anova(CWM_PREfmid, type=3)
difflsmeans(CWM_PREfmid, specs = ~Site)
plot(allEffects(CWM_PREfmid))

CWM_NP_reseff_modelf%>% ggplot(aes(x= PREprecwmf, y = PREcwmf, col = Treatment, shape = Site))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=2.5)+
  #scale_y_continuous(expand=c(0,0), limits = c(0,2.5))+
  #scale_x_continuous(expand=c(0,0), limits = c(0,2.5))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  xlab("Pre")+
  ylab("Now")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
```

CWM intra models for N, P, and Ca

Consolidate data
```{r}
CWM_NP_reseff_intra<-merge(CWM_NP_reseff_model, CWM_NP_reseff_modelf)
CWM_NP_reseff_intra$NREcwmint<-CWM_NP_reseff_intra$NREcwm-CWM_NP_reseff_intra$NREcwmf
CWM_NP_reseff_intra$PREcwmint<-CWM_NP_reseff_intra$PREcwm-CWM_NP_reseff_intra$PREcwmf
CWM_NP_reseff_intra$NREcwmintpre<-CWM_NP_reseff_intra$NREprecwm-CWM_NP_reseff_intra$NREprecwmf
CWM_NP_reseff_intra$PREcwmintpre<-CWM_NP_reseff_intra$PREprecwm-CWM_NP_reseff_intra$PREprecwmf

CWM_NP_reseff_intramid<-merge(CWM_NP_reseff_modelmid, CWM_NP_reseff_modelmidf)
CWM_NP_reseff_intramid$NREcwmint<-CWM_NP_reseff_intramid$NREcwm-CWM_NP_reseff_intramid$NREcwmf
CWM_NP_reseff_intramid$PREcwmint<-CWM_NP_reseff_intramid$PREcwm-CWM_NP_reseff_intramid$PREcwmf
CWM_NP_reseff_intramid$NREcwmintpre<-CWM_NP_reseff_intramid$NREprecwm-CWM_NP_reseff_intramid$NREprecwmf
CWM_NP_reseff_intramid$PREcwmintpre<-CWM_NP_reseff_intramid$PREprecwm-CWM_NP_reseff_intramid$PREprecwmf
```

Make Models:
```{r}
str(CWM_NP_reseff_intramid)
CWM_NP_reseff_intramid$Ntrt<-as.factor(CWM_NP_reseff_intramid$Ntrt)
CWM_NP_reseff_intramid$Ptrt<-as.factor(CWM_NP_reseff_intramid$Ptrt)

#N
CWM_NREmint<-lmer(NREcwmint~Ntrt*Ptrt+Age+NREcwmintpre +Site+(1|Stand),data=CWM_NP_reseff_intra)
plot(CWM_NREmint)
hist(resid(CWM_NREmint))
shapiro.test(resid(CWM_NREmint))
fixef(CWM_NREmint)
se.fixef(CWM_NREmint)
anova(CWM_NREmint, type=3)

CWM_NP_reseff_intranoC9<-subset(CWM_NP_reseff_intra, Stand !="C9")
CWM_NREmint2<-lmer(NREcwmint~Ntrt*Ptrt+Age+NREcwmintpre +Site+(1|Stand),data=CWM_NP_reseff_intranoC9)
plot(CWM_NREmint2)
hist(resid(CWM_NREmint2))
shapiro.test(resid(CWM_NREmint2))
fixef(CWM_NREmint2)
se.fixef(CWM_NREmint)
anova(CWM_NREmint2, type=3)
plot(allEffects(CWM_NREmint2))

#NRE 2014-16
CWM_NREmintmid<-lmer(NREcwmint~Ntrt*Ptrt+Age+NREcwmintpre +Site+(1|Stand),data=CWM_NP_reseff_intramid)
plot(CWM_NREmintmid)
hist(resid(CWM_NREmintmid))
shapiro.test(resid(CWM_NREmintmid))
fixef(CWM_NREmintmid)
se.fixef(CWM_NREmintmid)
anova(CWM_NREmintmid, type=3)
difflsmeans(CWM_NREmintmid)

#P:
CWM_PREmint<-lmer(PREcwmint~Ntrt*Ptrt+Age+PREcwmintpre +Site+(1|Stand),data=CWM_NP_reseff_intra)
plot(CWM_PREmint)
hist(resid(CWM_PREmint))
shapiro.test(resid(CWM_PREmint))
fixef(CWM_PREmint) 
se.fixef(CWM_PREmint)
anova(CWM_PREmint, type=3)

#P with no C2
CWM_NP_reseff_intranoC2<-subset(CWM_NP_reseff_intra, Stand !="C2")

CWM_PREmint2<-lmer(PREcwmint~Ntrt*Ptrt+Age+PREcwmintpre +Site+(1|Stand),data=CWM_NP_reseff_intranoC2)
plot(CWM_PREmint2)
hist(resid(CWM_PREmint2))
shapiro.test(resid(CWM_PREmint2))
fixef(CWM_PREmint2)
se.fixef(CWM_PREmint2)
anova(CWM_PREmint2, type=3)
CWM_PREmint2
difflsmeans(CWM_PREmint2)
plot(allEffects(CWM_PREmint2))

#P mid:
CWM_PREmintmid<-lmer(PREcwmint~Ntrt*Ptrt+Age+PREcwmintpre +(1|Stand),data=CWM_NP_reseff_intramid)
plot(CWM_PREmintmid)
hist(resid(CWM_PREmintmid))
shapiro.test(resid(CWM_PREmintmid))
fixef(CWM_PREmintmid) 
se.fixef(CWM_PREmintmid)
anova(CWM_PREmintmid, type=3)
difflsmeans(CWM_PREmintmid)
plot(allEffects(CWM_PREmintmid))
```

Graphs: Species level results

Species-level figures for Appendix
```{r}
NP_fol_1416mean2<-NP_fol_1416mean
NP_fol_2122mean2<-NP_fol_2122mean

NP_fol_1416mean2$Sampling<-"2014-16"
NP_fol_2122mean2$Sampling<-"2021-22"

postMELNHEfol1422_2<-full_join(NP_fol_1416mean2, NP_fol_2122mean2)
postMELNHEfol1422NP2<-subset(postMELNHEfol1422_2, Treatment !="Ca")
postMELNHEfol1422NP2<-subset(postMELNHEfol1422NP2, Stand !="HBCa")

postMELNHEfol1422NP2$Treatment<-replace(postMELNHEfol1422NP2$Treatment, postMELNHEfol1422NP2$Treatment == "CONTROL","Control")

NPfol_prepost_means_graphs2<-merge(NP_fol_0810mean, postMELNHEfol1422NP2, by = c("Site","Stand", "plotID","Species"))
NPfol_prepost_means_graphs2$Shape<-paste(NPfol_prepost_means_graphs2$Site, NPfol_prepost_means_graphs2$Sampling, sep = "_")
```

```{r}
#Red Maple
NPfol_prepost_means_graphsRM<-subset(NPfol_prepost_means_graphs2, Species =="RM")
NPfol_prepost_means_graphsRM<-subset(NPfol_prepost_means_graphsRM, Stand !="HBO")


plotRMfolN<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Npre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
scale_y_continuous(expand=c(0,0), limits = c(14,25))+
 scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar N (mg/g)")+
  ylab("Post-treatment Foliar N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolN)

plotRMfolP<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Ppre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar P (mg/g)")+
  ylab("Post-treatment Foliar P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolP)

plotRMfolCa<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Capre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Ca (mg/g)")+
  ylab("Post-treatment Foliar Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolCa)

plotRMfolK<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Kpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar K (mg/g)")+
  ylab("Post-treatment Foliar K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolK)

plotRMfolMg<-NPfol_prepost_means_graphsRM%>% ggplot(aes(x= Mgpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Mg (mg/g)")+
  ylab("Post-treatment Foliar Mg (mg/g)")+
  theme_bw()+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMfolMg)
plot_grid(plotRMfolN, plotRMfolP, plotRMfolCa, plotRMfolK, plotRMfolMg, labels = "auto")
```

```{r}
#Pin Cherry
NPfol_prepost_means_graphsPC<-subset(NPfol_prepost_means_graphs2, Species =="PC")

plotPCfolN<-NPfol_prepost_means_graphsPC%>% ggplot(aes(x= Npre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar N (mg/g)")+
  ylab("Post-treatment Foliar N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPCfolN)

plotPCfolP<-NPfol_prepost_means_graphsPC%>% ggplot(aes(x= Ppre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar P (mg/g)")+
  ylab("Post-treatment Foliar P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPCfolP)

plotPCfolCa<-NPfol_prepost_means_graphsPC%>% ggplot(aes(x= Capre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Ca (mg/g)")+
  ylab("Post-treatment Foliar Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPCfolCa)

plotPCfolK<-NPfol_prepost_means_graphsPC%>% ggplot(aes(x= Kpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar K (mg/g)")+
  ylab("Post-treatment Foliar K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPCfolK)

plotPCfolMg<-NPfol_prepost_means_graphsPC%>% ggplot(aes(x= Mgpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Mg (mg/g)")+
  ylab("Post-treatment Foliar Mg (mg/g)")+
  theme_bw()+
    #theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPCfolMg)


plot_grid(plotPCfolN, plotPCfolP, plotPCfolCa, plotPCfolK, plotPCfolMg, labels = "auto")
```

```{r}
#Sugar Maple
NPfol_prepost_means_graphsSM<-subset(NPfol_prepost_means_graphs2, Species =="SM")

plotSMfolN<-NPfol_prepost_means_graphsSM%>% ggplot(aes(x= Npre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar N (mg/g)")+
  ylab("Post-treatment Foliar N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMfolN)

plotSMfolP<-NPfol_prepost_means_graphsSM%>% ggplot(aes(x= Ppre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar P (mg/g)")+
  ylab("Post-treatment Foliar P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMfolP)

plotSMfolCa<-NPfol_prepost_means_graphsSM%>% ggplot(aes(x= Capre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Ca (mg/g)")+
  ylab("Post-treatment Foliar Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMfolCa)

plotSMfolK<-NPfol_prepost_means_graphsSM%>% ggplot(aes(x= Kpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar K (mg/g)")+
  ylab("Post-treatment Foliar K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMfolK)

plotSMfolMg<-NPfol_prepost_means_graphsSM%>% ggplot(aes(x= Mgpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Mg (mg/g)")+
  ylab("Post-treatment Foliar Mg (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMfolMg)


plot_grid(plotSMfolN, plotSMfolP, plotSMfolCa, plotSMfolK, plotSMfolMg, labels = "auto")
```

```{r}
#Beech
NPfol_prepost_means_graphsBE<-subset(NPfol_prepost_means_graphs2, Species =="BE")

plotBEfolN<-NPfol_prepost_means_graphsBE%>% ggplot(aes(x= Npre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar N (mg/g)")+
  ylab("Post-treatment Foliar N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBEfolN)

plotBEfolP<-NPfol_prepost_means_graphsBE%>% ggplot(aes(x= Ppre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar P (mg/g)")+
  ylab("Post-treatment Foliar P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBEfolP)

plotBEfolCa<-NPfol_prepost_means_graphsBE%>% ggplot(aes(x= Capre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Ca (mg/g)")+
  ylab("Post-treatment Foliar Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBEfolCa)

plotBEfolK<-NPfol_prepost_means_graphsBE%>% ggplot(aes(x= Kpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar K (mg/g)")+
  ylab("Post-treatment Foliar K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBEfolK)

plotBEfolMg<-NPfol_prepost_means_graphsBE%>% ggplot(aes(x= Mgpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Mg (mg/g)")+
  ylab("Post-treatment Foliar Mg (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBEfolMg)

plot_grid(plotBEfolN, plotBEfolP, plotBEfolCa, plotBEfolK, plotBEfolMg, labels = "auto")
```

```{r}
#Yellow Birch
NPfol_prepost_means_graphsYB<-subset(NPfol_prepost_means_graphs2, Species =="YB")

plotYBfolN<-NPfol_prepost_means_graphsYB%>% ggplot(aes(x= Npre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar N (mg/g)")+
  ylab("Post-treatment Foliar N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBfolN)

plotYBfolP<-NPfol_prepost_means_graphsYB%>% ggplot(aes(x= Ppre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar P (mg/g)")+
  ylab("Post-treatment Foliar P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBfolP)

plotYBfolCa<-NPfol_prepost_means_graphsYB%>% ggplot(aes(x= Capre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Ca (mg/g)")+
  ylab("Post-treatment Foliar Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBfolCa)

plotYBfolK<-NPfol_prepost_means_graphsYB%>% ggplot(aes(x= Kpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar K (mg/g)")+
  ylab("Post-treatment Foliar K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBfolK)

plotYBfolMg<-NPfol_prepost_means_graphsYB%>% ggplot(aes(x= Mgpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Mg (mg/g)")+
  ylab("Post-treatment Foliar Mg (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBfolMg)

plot_grid(plotYBfolN, plotYBfolP, plotYBfolCa, plotYBfolK, plotYBfolMg, labels = "auto")
```

```{r}
#White Birch
NPfol_prepost_means_graphsWB<-subset(NPfol_prepost_means_graphs2, Species =="WB")

plotWBfolN<-NPfol_prepost_means_graphsWB%>% ggplot(aes(x= Npre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar N (mg/g)")+
  ylab("Post-treatment Foliar N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBfolN)

plotWBfolP<-NPfol_prepost_means_graphsWB%>% ggplot(aes(x= Ppre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar P (mg/g)")+
  ylab("Post-treatment Foliar P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBfolP)

plotWBfolCa<-NPfol_prepost_means_graphsWB%>% ggplot(aes(x= Capre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Ca (mg/g)")+
  ylab("Post-treatment Foliar Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBfolCa)

plotWBfolK<-NPfol_prepost_means_graphsWB%>% ggplot(aes(x= Kpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar K (mg/g)")+
  ylab("Post-treatment Foliar K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBfolK)

plotWBfolMg<-NPfol_prepost_means_graphsWB%>% ggplot(aes(x= Mgpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Foliar Mg (mg/g)")+
  ylab("Post-treatment Foliar Mg (mg/g)")+
  theme_bw()+
 theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBfolMg)

plot_grid(plotWBfolN, plotWBfolP, plotWBfolCa, plotWBfolK, plotWBfolMg, labels = "auto")
```

```{r}
MELNHElit2<-MELNHElit
midlitmeansNPi2_22<-midlitmeansNPi2

midlitmeansNPi2_22$Sampling<-"2014-16"
MELNHElit2$Sampling<-"2021-22"

midlitmeansNPi2_22$N<-midlitmeansNPi2_22$Nmid
midlitmeansNPi2_22$P<-midlitmeansNPi2_22$Pmid
midlitmeansNPi2_22$Ca<-midlitmeansNPi2_22$Camid
midlitmeansNPi2_22$K<-midlitmeansNPi2_22$Kmid
midlitmeansNPi2_22$Mg<-midlitmeansNPi2_22$Mgmid

postMELNHElit1422_2<-full_join(midlitmeansNPi2_22, MELNHElit2)
postMELNHElit1422_2<-subset(postMELNHElit1422_2, Treatment !="Ca")
postMELNHElit1422_2<-subset(postMELNHElit1422_2, Stand !="HBCa")

postMELNHElit1422_2$Treatment<-replace(postMELNHElit1422_2$Treatment, postMELNHElit1422_2$Treatment == "CONTROL","Control")

NPlit_prepost_means_graphs2<-merge(pretreat0910litmeani, postMELNHElit1422_2, by = c("Site","Stand", "Plot","Species"))
NPlit_prepost_means_graphs2$Shape<-paste(NPlit_prepost_means_graphs2$Site, NPlit_prepost_means_graphs2$Sampling, sep = "_")
```

```{r}
#Red Maple
NPlit_prepost_means_graphs2RM<-subset(NPlit_prepost_means_graphs2, Species =="RM")
NPlit_prepost_means_graphs2RM<-subset(NPlit_prepost_means_graphs2RM, Stand !="HBO")


plotRMlitN<-NPlit_prepost_means_graphs2RM%>% ggplot(aes(x= Nlitpre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter N (mg/g)")+
  ylab("Post-treatment Litter N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMlitN)

plotRMlitP<-NPlit_prepost_means_graphs2RM%>% ggplot(aes(x= Plitpre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter P (mg/g)")+
  ylab("Post-treatment Litter P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMlitP)

plotRMlitCa<-NPlit_prepost_means_graphs2RM%>% ggplot(aes(x= Calitpre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Ca (mg/g)")+
  ylab("Post-treatment Litter Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMlitCa)

plotRMlitK<-NPlit_prepost_means_graphs2RM%>% ggplot(aes(x= Klitpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter K (mg/g)")+
  ylab("Post-treatment Litter K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMlitK)

plotRMlitMg<-NPlit_prepost_means_graphs2RM%>% ggplot(aes(x= Mglitpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Mg (mg/g)")+
  ylab("Post-treatment Litter Mg (mg/g)")+
  theme_bw()+
      theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRMlitMg)

plot_grid(plotRMlitN, plotRMlitP, plotRMlitCa, plotRMlitK, plotRMlitMg, labels = "auto")
```

```{r}
#Pin Cherry
NPlit_prepost_means_graphsPC<-subset(NPlit_prepost_means_graphs2, Species =="PC")

plotPClitN<-NPlit_prepost_means_graphsPC%>% ggplot(aes(x= Nlitpre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter N (mg/g)")+
  ylab("Post-treatment Litter N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPClitN)

plotPClitP<-NPlit_prepost_means_graphsPC%>% ggplot(aes(x= Plitpre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter P (mg/g)")+
  ylab("Post-treatment Litter P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPClitP)

plotPClitCa<-NPlit_prepost_means_graphsPC%>% ggplot(aes(x= Calitpre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Ca (mg/g)")+
  ylab("Post-treatment Litter Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPClitCa)

plotPClitK<-NPlit_prepost_means_graphsPC%>% ggplot(aes(x= Klitpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter K (mg/g)")+
  ylab("Post-treatment Litter K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPClitK)

plotPClitMg<-NPlit_prepost_means_graphsPC%>% ggplot(aes(x= Mglitpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Mg (mg/g)")+
  ylab("Post-treatment Litter Mg (mg/g)")+
  theme_bw()+
 #     theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPClitMg)

plot_grid(plotPClitN, plotPClitP, plotPClitCa, plotPClitK, plotPClitMg, labels = "auto")
```

```{r}
#Sugar Maple
NPlit_prepost_means_graphsSM<-subset(NPlit_prepost_means_graphs2, Species =="SM")

plotSMlitN<-NPlit_prepost_means_graphsSM%>% ggplot(aes(x= Nlitpre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter N (mg/g)")+
  ylab("Post-treatment Litter N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMlitN)

plotSMlitP<-NPlit_prepost_means_graphsSM%>% ggplot(aes(x= Plitpre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter P (mg/g)")+
  ylab("Post-treatment Litter P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMlitP)

plotSMlitCa<-NPlit_prepost_means_graphsSM%>% ggplot(aes(x= Calitpre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Ca (mg/g)")+
  ylab("Post-treatment Litter Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMlitCa)

plotSMlitK<-NPlit_prepost_means_graphsSM%>% ggplot(aes(x= Klitpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter K (mg/g)")+
  ylab("Post-treatment Litter K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMlitK)

plotSMlitMg<-NPlit_prepost_means_graphsSM%>% ggplot(aes(x= Mglitpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Mg (mg/g)")+
  ylab("Post-treatment Litter Mg (mg/g)")+
  theme_bw()+
      theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSMlitMg)

plot_grid(plotSMlitN, plotSMlitP, plotSMlitCa, plotSMlitK, plotSMlitMg, labels = "auto")
```

```{r}
#Beech
NPlit_prepost_means_graphsBE<-subset(NPlit_prepost_means_graphs2, Species =="BE")

plotBElitN<-NPlit_prepost_means_graphsBE%>% ggplot(aes(x= Nlitpre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter N (mg/g)")+
  ylab("Post-treatment Litter N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBElitN)

plotBElitP<-NPlit_prepost_means_graphsBE%>% ggplot(aes(x= Plitpre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter P (mg/g)")+
  ylab("Post-treatment Litter P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBElitP)

plotBElitCa<-NPlit_prepost_means_graphsBE%>% ggplot(aes(x= Calitpre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Ca (mg/g)")+
  ylab("Post-treatment Litter Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBElitCa)

plotBElitK<-NPlit_prepost_means_graphsBE%>% ggplot(aes(x= Klitpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter K (mg/g)")+
  ylab("Post-treatment Litter K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBElitK)

plotBElitMg<-NPlit_prepost_means_graphsBE%>% ggplot(aes(x= Mglitpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Mg (mg/g)")+
  ylab("Post-treatment Litter Mg (mg/g)")+
  theme_bw()+
      theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBElitMg)

plot_grid(plotBElitN, plotBElitP, plotBElitCa, plotBElitK, plotBElitMg, labels = "auto")
```

```{r}
#Yellow Birch
NPlit_prepost_means_graphsYB<-subset(NPlit_prepost_means_graphs2, Species =="YB")

plotYBlitN<-NPlit_prepost_means_graphsYB%>% ggplot(aes(x= Nlitpre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter N (mg/g)")+
  ylab("Post-treatment Litter N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBlitN)

plotYBlitP<-NPlit_prepost_means_graphsYB%>% ggplot(aes(x= Plitpre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter P (mg/g)")+
  ylab("Post-treatment Litter P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBlitP)

plotYBlitCa<-NPlit_prepost_means_graphsYB%>% ggplot(aes(x= Calitpre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Ca (mg/g)")+
  ylab("Post-treatment Litter Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBlitCa)

plotYBlitK<-NPlit_prepost_means_graphsYB%>% ggplot(aes(x= Klitpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter K (mg/g)")+
  ylab("Post-treatment Litter K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBlitK)

plotYBlitMg<-NPlit_prepost_means_graphsYB%>% ggplot(aes(x= Mglitpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Mg (mg/g)")+
  ylab("Post-treatment Litter Mg (mg/g)")+
  theme_bw()+
      theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYBlitMg)

plot_grid(plotYBlitN, plotYBlitP, plotYBlitCa, plotYBlitK, plotYBlitMg, labels = "auto")
```

```{r}
#White Birch
NPlit_prepost_means_graphsWB<-subset(NPlit_prepost_means_graphs2, Species =="WB")

plotWBlitN<-NPlit_prepost_means_graphsWB%>% ggplot(aes(x= Nlitpre, y = N, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter N (mg/g)")+
  ylab("Post-treatment Litter N (mg/g)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBlitN)

plotWBlitP<-NPlit_prepost_means_graphsWB%>% ggplot(aes(x= Plitpre, y = P, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter P (mg/g)")+
  ylab("Post-treatment Litter P (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBlitP)

plotWBlitCa<-NPlit_prepost_means_graphsWB%>% ggplot(aes(x= Calitpre, y = Ca, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Ca (mg/g)")+
  ylab("Post-treatment Litter Ca (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBlitCa)

plotWBlitK<-NPlit_prepost_means_graphsWB%>% ggplot(aes(x= Klitpre, y = K, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter K (mg/g)")+
  ylab("Post-treatment Litter K (mg/g)")+
  theme_bw()+
    theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBlitK)

plotWBlitMg<-NPlit_prepost_means_graphsWB%>% ggplot(aes(x= Mglitpre, y = Mg, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
    scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment Litter Mg (mg/g)")+
  ylab("Post-treatment Litter Mg (mg/g)")+
  theme_bw()+
      theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWBlitMg)

plot_grid(plotWBlitN, plotWBlitP, plotWBlitCa, plotWBlitK, plotWBlitMg, labels = "auto")
```

```{r}
fol_lit2<-fol_lit
fol_litmid2<-fol_litmid

fol_litmid2$Sampling<-"2014-16"
fol_lit_res$Sampling<-"2021-22"

fol_lit_res1422<-full_join(fol_litmid2, fol_lit2)
fol_lit_res1422<-subset(fol_lit_res1422, Treatment !="Ca")
fol_lit_res1422<-subset(fol_lit_res1422, Stand !="HBCa")

fol_lit_res1422$Treatment<-replace(fol_lit_res1422$Treatment, fol_lit_res1422$Treatment == "CONTROL","Control")

NPres_prepost_means_graphs2<-merge(NP_fol_lit_0810_res, fol_lit_res1422, by = c("Site","Stand", "Plot","Species"))
NPres_prepost_means_graphs2$Shape<-paste(NPres_prepost_means_graphs2$Site, NPres_prepost_means_graphs2$Sampling, sep = "_")
```

```{r}
#Red Maple
NPres_prepost_means_graphs2RM<-subset(NPres_prepost_means_graphs2, Species =="RM")
NPres_prepost_means_graphs2RM<-subset(NPres_prepost_means_graphs2RM, Stand !="HBO")


plotRM_NRE<-NPres_prepost_means_graphs2RM%>% ggplot(aes(x= NREpre, y = NRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment N Resorption Efficiency (%)")+
  ylab("Post-treatment N Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRM_NRE)

plotRM_PRE<-NPres_prepost_means_graphs2RM%>% ggplot(aes(x= PREpre, y = PRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment P Resorption Efficiency (%)")+
  ylab("Post-treatment P Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotRM_PRE)

plot_grid(plotRM_NRE, plotRM_PRE, labels = "auto")
```

```{r}
#Pin Cherry
NPres_prepost_means_graphsPC<-subset(NPres_prepost_means_graphs2, Species =="PC")

plotPC_NRE<-NPres_prepost_means_graphsPC%>% ggplot(aes(x= NREpre, y = NRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment N Resorption Efficiency (%)")+
  ylab("Post-treatment N Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPC_NRE)

plotPC_PRE<-NPres_prepost_means_graphsPC%>% ggplot(aes(x= PREpre, y = PRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment P Resorption Efficiency (%)")+
  ylab("Post-treatment P Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotPC_PRE)

plot_grid(plotPC_NRE, plotPC_PRE, labels = "auto")
```

```{r}
#Sugar Maple
NPres_prepost_means_graphsSM<-subset(NPres_prepost_means_graphs2, Species =="SM")

plotSM_NRE<-NPres_prepost_means_graphsSM%>% ggplot(aes(x= NREpre, y = NRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment N Resorption Efficiency (%)")+
  ylab("Post-treatment N Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSM_NRE)

plotSM_PRE<-NPres_prepost_means_graphsSM%>% ggplot(aes(x= PREpre, y = PRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment P Resorption Efficiency (%)")+
  ylab("Post-treatment P Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotSM_PRE)

plot_grid(plotSM_NRE, plotSM_PRE, labels = "auto")
```

```{r}
#Beech
NPres_prepost_means_graphsBE<-subset(NPres_prepost_means_graphs2, Species =="BE")

plotBE_NRE<-NPres_prepost_means_graphsBE%>% ggplot(aes(x= NREpre, y = NRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment N Resorption Efficiency (%)")+
  ylab("Post-treatment N Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBE_NRE)

plotBE_PRE<-NPres_prepost_means_graphsBE%>% ggplot(aes(x= PREpre, y = PRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment P Resorption Efficiency (%)")+
  ylab("Post-treatment P Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotBE_PRE)

plot_grid(plotBE_NRE, plotBE_PRE, labels = "auto")
```

```{r}
#Yellow Birch
NPres_prepost_means_graphsYB<-subset(NPres_prepost_means_graphs2, Species =="YB")

plotYB_NRE<-NPres_prepost_means_graphsYB%>% ggplot(aes(x= NREpre, y = NRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment N Resorption Efficiency (%)")+
  ylab("Post-treatment N Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYB_NRE)

plotYB_PRE<-NPres_prepost_means_graphsYB%>% ggplot(aes(x= PREpre, y = PRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment P Resorption Efficiency (%)")+
  ylab("Post-treatment P Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotYB_PRE)

plot_grid(plotYB_NRE, plotYB_PRE, labels = "auto")
```

```{r}
#White Birch
NPres_prepost_means_graphsWB<-subset(NPres_prepost_means_graphs2, Species =="WB")

plotWB_NRE<-NPres_prepost_means_graphsWB%>% ggplot(aes(x= NREpre, y = NRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment N Resorption Efficiency (%)")+
  ylab("Post-treatment N Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWB_NRE)

plotWB_PRE<-NPres_prepost_means_graphsWB%>% ggplot(aes(x= PREpre, y = PRE, col = Treatment, shape = Shape))+
    geom_abline(mapping = NULL, data = NULL, intercept = 0, slope = 1)+
  geom_point(size=4)+
  scale_shape_manual(values = c(1,16,0,15,2,17))+
#scale_y_continuous(expand=c(0,0), limits = c(14,25))+
# scale_x_continuous(expand=c(0,0), limits = c(14,25))+
  scale_color_manual(values = c("gray", "blue", "purple","red"))+
  scale_fill_manual(values = c("white", "gray"))+
  xlab("Pre-treatment P Resorption Efficiency (%)")+
  ylab("Post-treatment P Resorption Efficiency (%)")+
  theme_bw()+
  theme(legend.position = "none")+
    theme(axis.text=element_text(size=13), axis.title=element_text(size=15), legend.text = element_text(size=11), legend.title=element_text(size=12))
plot(plotWB_PRE)

plot_grid(plotWB_NRE, plotWB_PRE, labels = "auto")
```

Paired Wilcoxon Tests:
```{r}
CWM_NP_chem_model_ctr<-subset(CWM_NP_chem_model, Treatment == "Control")
NCWM<-CWM_NP_chem_model_ctr$Ncwm
wilcox.test(CWM_NP_chem_model_ctr$Ncwm, CWM_NP_chem_model_ctr$Nprecwm, paired = TRUE)
wilcox.test(CWM_NP_chem_model_ctr$Pcwm, CWM_NP_chem_model_ctr$Pprecwm, paired = TRUE)
wilcox.test(CWM_NP_chem_model_ctr$Cacwm, CWM_NP_chem_model_ctr$Caprecwm, paired = TRUE)
wilcox.test(CWM_NP_chem_model_ctr$Mgcwm, CWM_NP_chem_model_ctr$Mgprecwm, paired = TRUE)
wilcox.test(CWM_NP_chem_model_ctr$Kcwm, CWM_NP_chem_model_ctr$Kprecwm, paired = TRUE)

mean(CWM_NP_chem_model_ctr$Ncwm)
```

Make Stand basal area graphs
```{r}
treedbhMELNHEgraph<-subset(treedbhMELNHE, treedbhMELNHE$Stand=="C1"|treedbhMELNHE$Stand=="C2"|treedbhMELNHE$Stand=="C4"|treedbhMELNHE$Stand=="C6"|treedbhMELNHE$Stand=="C8"|treedbhMELNHE$Stand=="C9"|treedbhMELNHE$Stand=="HBM"|treedbhMELNHE$Stand=="HBO"|treedbhMELNHE$Stand=="JBM"|treedbhMELNHE$Stand=="JBO")

treedbhMELNHEgraph2<-subset(treedbhMELNHEgraph, Plot=="1"|Plot=="2"|Plot=="3"|Plot=="4")

BAgraph<-ddply(treedbhMELNHEgraph2, .(Site, Age, Stand, Plot, Treatment, Species), summarize,
      BA2019m2sum = sum(BA2019, na.rm=T),
      BA2015m2sum = sum(BA2015, na.rm=T),
      BA2011m2sum = sum(BA2011, na.rm=T))
      
library(RColorBrewer)
n <- 20 # 19 is for 19 'species'
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))

# nice way to visualize the colors.
pie(rep(1,n), col=sample(col_vector, n))
litcol<-col_vector #for convenience.

m1<-ggplot(BAgraph, aes(x=Treatment, y=BA2019m2sum, fill=Species))+geom_bar(stat="identity", col="black")+ theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  facet_wrap(~Stand, scales="fixed", nrow=2)+
    scale_fill_manual( values= litcol)+
  theme(axis.text.x = element_text(angle = 90, vjust =.5))+
  ggtitle("Stand C2 over the years")
m1

BAgraph2<-ddply(treedbhMELNHEgraph2, .(Site, Age, Stand, Species), summarize,
      BA2019m2sum = sum(BA2019, na.rm=T),
      BA2015m2sum = sum(BA2015, na.rm=T),
      BA2011m2sum = sum(BA2011, na.rm=T))

BAgraphTot<-ddply(treedbhMELNHEgraph2, .(Site, Age, Stand), summarize,
      TotBA2019m2 = sum(BA2019, na.rm=T),
      TotBA2015m2 = sum(BA2015, na.rm=T),
      TotBA2011m2 = sum(BA2011, na.rm=T))

BAgraphstand<-merge(BAgraph2,BAgraphTot, by = c("Site","Age","Stand"))

BAgraphstandprop<-ddply(BAgraphstand, .(Site,Age,Stand,Species),summarize,
        prop2019=BA2019m2sum/TotBA2019m2,
        prop2015=BA2015m2sum/TotBA2015m2,
        prop2011=BA2011m2sum/TotBA2011m2)

BAgraphstandprop$Stand<-factor(BAgraphstandprop$Stand, levels = c("C1","C2","C4","C6","C8","C9","HBM","HBO","JBM","JBO"),ordered=T)


BAgraph2overall<-ddply(treedbhMELNHEgraph2, .(Species), summarize,
      BA2019m2sum = sum(BA2019, na.rm=T),
      BA2015m2sum = sum(BA2015, na.rm=T),
      BA2011m2sum = sum(BA2011, na.rm=T))
BAgraph2overall

write.csv(BAgraph2overall, "BAgraph2overall.csv")

#Change species names
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "Ash","FRAM2")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "ASH","FRAM2")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "BA","POGR4")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "BASS","TIAM")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "BC","PRSE2")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "BE","FAGR")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "FIR","ABBA")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "HEM","TSCA")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "MTASH","SOAM3")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "PC","PRPE2")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "QA","POTR5")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "RM","ACRU")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "RO","QURU")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "RS","PIRU")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "SM","ACSA3")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "Stm","ACPE")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "STM","ACPE")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "UNK","Unknown")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "WB","BEPA")
BAgraphstandprop$Species<-replace(BAgraphstandprop$Species, BAgraphstandprop$Species == "YB","BEAL2")

BAgraphstandprop$Species<-factor(BAgraphstandprop$Species, levels = c("ACSA3","BEAL2","FAGR","BEPA","ACRU","POGR4","PRPE2","FRAM2","TSCA","POTR5","PIRU","TIAM","QURU","ACPE","PRSE2","ABBA","SOAM3","Unknown"), ordered=T)

mycolors2 = c("#CC6677", "#DDCC77", "#888888","#999933","#661100","#117733","#AA4499", "#332288", "#D55E00","#44AA99","#E69F00","#0072B2", "#882255", "#CC79A7", "#000000","#009E73","#F0E442", "56B4E9")

mycolors3 = c("#E69F00", "#0072B2", "#999999","#56B4E9","#D55E00","#117733","#CC79A7", "#332288", "#44AA99","#999933","#661100", "#6699CC", "#AA4499", "#F0E442", "#000000","#88CCEE","#882255", "56B4E9","#44AA99")

m1<-ggplot(BAgraphstandprop, aes(x=Stand, y=prop2019, fill=Species))+geom_bar(stat="identity", col="black")+
  geom_vline(xintercept = c(6.5, 8.5),lty=1)+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
    scale_fill_manual(values = mycolors3)+
    ylab("Proportion of Basal Area")+
  theme(axis.text.x = element_text(angle = 90, vjust =.5, size=14))+
  theme(axis.text.y=element_text(size=24))+
  theme(axis.title.y = element_text(size=24))+
  theme(axis.title.x=element_text(size=24))
m1


#Version of graph with species ordered by shade tolerance and stands by year

mycolors4 = c("#56B4E9","#117733","#CC79A7","#999933","#000000","#0072B2","#D55E00","#332288","#AA4499","#882255","#E69F00","#00CD00","#661100","#6699CC","#F0E442","lightpink","#FFFFFF")

BAgraphstandprop2<-BAgraphstandprop

#Order by year
BAgraphstandprop2$Stand<-factor(BAgraphstandprop2$Stand, levels = c("C1","C2","C4","C6","JBM","HBM","JBO","HBO","C9","C8"),ordered=T)

#order by shade tolerance and abundance
BAgraphstandprop2$Species<-factor(BAgraphstandprop2$Species, levels = c("BEPA","POGR4","PRPE2","POTR5","PRSE2","BEAL2","ACRU","FRAM2","QURU","SOAM3", "ACSA3","FAGR","TSCA","PIRU","TIAM","ACPE","ABBA", "NA"), ordered=T)

p1<-ggplot(BAgraphstandprop2, aes(x=Stand, y=prop2019, fill=Species))+geom_bar(stat="identity", col="black")+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
    scale_fill_manual(values = mycolors4)+
  scale_y_continuous(expand = c(0,0), limits = c(0,1.1))+
    ylab("Proportion of Basal Area")+
    theme_classic() +
  theme(axis.text.x = element_text(angle = 90, vjust =.5, size=25))+
  theme(axis.text.y=element_text(size=25))+
  theme(axis.title.y = element_text(size=25))+
  theme(axis.title.x=element_text(size=25))+
  theme(legend.title =element_text(size=20))+
  theme(legend.text=element_text(size=20))
p1
```

